<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dream Date Designer - Couples Game Hub</title>
    <link rel="stylesheet" href="../css/style.css">
    <style>
        .player-indicator {
            text-align: center;
            font-size: 1.5em;
            font-weight: bold;
            color: #764ba2;
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9ff;
            border-radius: 10px;
        }

        .mode-selection {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .mode-card {
            background: #f8f9ff;
            padding: 30px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s;
            border: 3px solid transparent;
            text-align: center;
        }

        .mode-card:hover {
            transform: translateY(-3px);
            border-color: #667eea;
        }

        .mode-card.selected {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #764ba2;
        }

        .mode-card h3 {
            color: #667eea;
            margin-bottom: 12px;
            font-size: 1.5em;
        }

        .mode-card.selected h3 {
            color: white;
        }

        .mode-card p {
            color: #666;
            line-height: 1.5;
        }

        .mode-card.selected p {
            color: rgba(255,255,255,0.95);
        }

        .instructions {
            background: #f8f9ff;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .instructions h3 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .card-hand {
            margin-bottom: 30px;
        }

        .card-category {
            margin-bottom: 25px;
        }

        .category-title {
            color: #667eea;
            font-weight: bold;
            margin-bottom: 12px;
            font-size: 1.1em;
        }

        .cards-row {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 12px;
            margin-bottom: 10px;
        }

        .game-card-item {
            background: white;
            border: 3px solid #ddd;
            border-radius: 10px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            position: relative;
        }

        .game-card-item:hover {
            transform: translateY(-5px);
            border-color: #667eea;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .game-card-item.selected {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #764ba2;
        }

        .game-card-item.disabled {
            opacity: 0.3;
            cursor: not-allowed;
            pointer-events: none;
        }

        .game-card-item.selected .card-emoji {
            filter: brightness(1.2);
        }

        .card-emoji {
            font-size: 2em;
            margin-bottom: 8px;
        }

        .card-text {
            font-size: 0.9em;
            font-weight: 500;
            color: #333;
        }

        .game-card-item.selected .card-text {
            color: white;
        }

        .selected-cards-display {
            background: #f8f9ff;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
            border: 3px solid #667eea;
        }

        .selected-category {
            margin-bottom: 15px;
        }

        .selected-category-title {
            color: #764ba2;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .selected-card-badge {
            display: inline-block;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            margin-right: 8px;
            margin-bottom: 8px;
            font-size: 0.9em;
        }

        .date-reveal {
            max-width: 600px;
            margin: 0 auto 20px;
        }

        .date-design {
            background: #f8f9ff;
            padding: 25px;
            border-radius: 15px;
            border: 3px solid #667eea;
        }

        .date-design h3 {
            color: #667eea;
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.5em;
        }

        .date-section {
            margin-bottom: 20px;
        }

        .date-section-title {
            color: #764ba2;
            font-weight: bold;
            margin-bottom: 8px;
            font-size: 0.9em;
            text-transform: uppercase;
        }

        .date-section-content {
            background: white;
            padding: 12px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
            color: #333;
        }

        .mash-up-container {
            text-align: center;
            padding: 40px 20px;
        }

        .mash-up-container h3 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.8em;
        }

        .generate-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 20px 40px;
            font-size: 1.3em;
            border-radius: 15px;
            cursor: pointer;
            font-weight: bold;
            transition: transform 0.2s;
            margin: 10px;
        }

        .generate-btn:hover {
            transform: scale(1.05);
        }

        button {
            width: 100%;
            padding: 15px;
            font-size: 1.2em;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: transform 0.2s;
            font-weight: bold;
            margin-top: 10px;
        }

        button:hover {
            transform: translateY(-2px);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        button.secondary {
            background: white;
            color: #667eea;
            border: 3px solid #667eea;
        }

        button.secondary:hover {
            background: #f8f9ff;
        }

        .start-screen, .build-screen, .mashup-screen, .reveal-screen {
            display: none;
        }

        .start-screen.active, .build-screen.active, .mashup-screen.active, .reveal-screen.active {
            display: block;
        }

        @media (max-width: 768px) {
            .mode-selection {
                grid-template-columns: 1fr;
            }

            .cards-row {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            }

            .game-card-item {
                padding: 12px;
            }

            .card-emoji {
                font-size: 1.5em;
            }

            .card-text {
                font-size: 0.85em;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <a href="../index.html" class="back-link">‚Üê Back to Games</a>
        <h1 class="game-title">üíù Dream Date Designer</h1>
        <p class="game-subtitle">Build your perfect date together</p>

        <!-- Start Screen -->
        <div class="start-screen active">
            <div class="instructions">
                <h3>Welcome to Dream Date Designer!</h3>
                <p>Design your dream date by choosing cards from different categories. Create dates you can actually do in real life!</p>
            </div>

            <div class="mode-selection">
                <div class="mode-card" onclick="selectMode('standard')">
                    <h3>üé® Standard Mode</h3>
                    <p>Both players pick from the same cards to design their dream date. Then reveal and compare - maybe even do one for real!</p>
                </div>
                <div class="mode-card" onclick="selectMode('mashup')">
                    <h3>üé≤ Mash-Up Mode</h3>
                    <p>Automatically generate a random date combination! Perfect for when you want instant inspiration with zero decision fatigue.</p>
                </div>
            </div>

            <button id="startBtn" disabled onclick="startGame()">Select a Mode to Continue</button>
        </div>

        <!-- Build Screen (Standard Mode) -->
        <div class="build-screen">
            <div class="player-indicator" id="buildIndicator">Player 1: Design Your Dream Date</div>

            <div class="selected-cards-display" id="selectedDisplay">
                <h3 style="color: #667eea; margin-bottom: 15px;">Your Date So Far:</h3>
                <div id="selectedSummary">
                    <p style="color: #999; font-style: italic;">Select cards below to build your date...</p>
                </div>
            </div>

            <div class="card-hand" id="cardHand"></div>

            <button id="confirmDateBtn" disabled onclick="confirmDate()">Confirm This Date ‚úì</button>
        </div>

        <!-- Mash-Up Screen -->
        <div class="mashup-screen">
            <div class="player-indicator">üé≤ Mash-Up Mode: Random Date Generator</div>

            <div class="mash-up-container">
                <h3>Generate a Random Dream Date!</h3>
                <p style="color: #666; margin-bottom: 30px; font-size: 1.1em;">
                    Click the button below to instantly create a random date idea.
                </p>
                <button class="generate-btn" onclick="generateMashupDate()">‚ú® Generate Random Date ‚ú®</button>
            </div>

            <div id="mashupResults" style="display: none;">
                <div class="date-reveal" id="mashupReveal"></div>
                <button onclick="generateMashupDate()">üîÑ Generate Another Date</button>
                <button class="secondary" onclick="location.reload()">Back to Mode Selection</button>
            </div>
        </div>

        <!-- Reveal Screen -->
        <div class="reveal-screen">
            <div class="player-indicator">‚ú® Dream Date Reveals ‚ú®</div>

            <div class="date-reveal" id="dateReveal"></div>

            <button class="secondary" onclick="location.reload()">Design New Dates</button>
        </div>
    </div>

    <script>
        // Card Database with tags for smart filtering
        const cardDatabase = {
            location: [
                { emoji: '‚òï', text: 'Cozy caf√©', tags: ['indoor', 'anytime'] },
                { emoji: 'üå≥', text: 'Scenic park or waterfront', tags: ['outdoor', 'daytime'] },
                { emoji: 'üé®', text: 'Local museum or gallery', tags: ['indoor', 'daytime'] },
                { emoji: 'üõí', text: "Farmer's market", tags: ['outdoor', 'morning'] },
                { emoji: 'üèôÔ∏è', text: 'Rooftop patio or lounge', tags: ['outdoor', 'anytime'] },
                { emoji: 'üìö', text: 'Bookstore or record shop', tags: ['indoor', 'daytime'] },
                { emoji: 'üèñÔ∏è', text: 'Beach or lakeside', tags: ['outdoor', 'daytime'] },
                { emoji: 'üöó', text: 'Nearby small town', tags: ['outdoor', 'daytime'] },
                { emoji: 'üè†', text: 'Cozy home date', tags: ['indoor', 'anytime'] },
                { emoji: 'üåâ', text: 'Downtown area walk', tags: ['outdoor', 'anytime'] },
                { emoji: 'üé°', text: 'Local fair or festival', tags: ['outdoor', 'evening'] },
                { emoji: 'üèûÔ∏è', text: 'Nature trail or hiking spot', tags: ['outdoor', 'daytime'] },
                { emoji: 'üé≠', text: 'Theater or comedy club', tags: ['indoor', 'evening'] },
                { emoji: 'üåÜ', text: 'Scenic overlook or viewpoint', tags: ['outdoor', 'evening'] },
                { emoji: 'üèõÔ∏è', text: 'Historic landmark', tags: ['outdoor', 'daytime'] },
                { emoji: 'üåÖ', text: 'Sunrise or sunset spot', tags: ['outdoor', 'golden-hour'] }
            ],
            activity: [
                { emoji: 'üç≥', text: 'Cook a new cuisine together', tags: ['indoor', 'anytime'] },
                { emoji: 'üßÅ', text: 'Baking competition', tags: ['indoor', 'anytime'] },
                { emoji: 'üëï', text: 'Thrift store treasure hunt', tags: ['indoor', 'daytime'] },
                { emoji: 'üé≤', text: 'Board game marathon', tags: ['indoor', 'anytime'] },
                { emoji: 'üß†', text: 'Trivia night', tags: ['indoor', 'evening'] },
                { emoji: 'üì∏', text: 'Photo walk adventure', tags: ['outdoor', 'daytime'] },
                { emoji: 'üö∂', text: 'Neighborhood exploration', tags: ['outdoor', 'daytime'] },
                { emoji: 'üé®', text: 'Paint or pottery session', tags: ['indoor', 'anytime'] },
                { emoji: 'üîê', text: 'Escape room challenge', tags: ['indoor', 'anytime'] },
                { emoji: 'üé≥', text: 'Bowling or mini golf', tags: ['indoor', 'anytime'] },
                { emoji: 'üß©', text: 'Puzzle building together', tags: ['indoor', 'anytime'] },
                { emoji: '‚úÇÔ∏è', text: 'DIY craft project', tags: ['indoor', 'anytime'] },
                { emoji: 'üé§', text: 'Karaoke session', tags: ['indoor', 'evening'] },
                { emoji: '‚ù§Ô∏è', text: 'Volunteer together', tags: ['outdoor', 'daytime'] },
                { emoji: 'üé¨', text: 'Movie marathon with theme', tags: ['indoor', 'anytime'] },
                { emoji: 'üéÆ', text: 'Video game co-op night', tags: ['indoor', 'anytime'] },
                { emoji: 'üìñ', text: 'Book club for two', tags: ['indoor', 'anytime'] },
                { emoji: 'üéµ', text: 'Create a shared playlist', tags: ['indoor', 'anytime'] },
                { emoji: 'üèÉ', text: 'Fun fitness activity', tags: ['outdoor', 'daytime'] },
                { emoji: 'üåü', text: 'Stargazing session', tags: ['outdoor', 'night'] },
                { emoji: 'üé∫', text: 'Live music or concert', tags: ['indoor', 'evening'] },
                { emoji: 'üßò', text: 'Yoga or meditation class', tags: ['indoor', 'daytime'] }
            ],
            twist: [
                { emoji: 'üíµ', text: 'Budget cap: $25 total', tags: ['budget'] },
                { emoji: 'üìµ', text: 'Phones off entire date', tags: ['neutral'] },
                { emoji: 'ü§ù', text: 'Each person plans half', tags: ['neutral'] },
                { emoji: 'üéÅ', text: 'Surprise element midway', tags: ['neutral'] },
                { emoji: 'üëî', text: 'Dress code required', tags: ['neutral'] },
                { emoji: '‚è∞', text: '2-hour time limit', tags: ['neutral'] },
                { emoji: 'üö´', text: 'No reservations allowed', tags: ['neutral'] },
                { emoji: 'üéÄ', text: 'Must include small gift', tags: ['neutral'] },
                { emoji: 'üí∞', text: 'Only cash allowed', tags: ['neutral'] },
                { emoji: 'üé≤', text: 'Dice decides next activity', tags: ['neutral'] },
                { emoji: 'üìù', text: 'Document everything', tags: ['neutral'] },
                { emoji: 'üé≠', text: 'Act like first date again', tags: ['neutral'] },
                { emoji: 'üîÑ', text: 'Recreate an old memory', tags: ['neutral'] },
                { emoji: 'üåô', text: 'After sunset only', tags: ['night'] },
                { emoji: '‚òÄÔ∏è', text: 'Before 2pm only', tags: ['morning'] },
                { emoji: 'üé®', text: 'Make something together', tags: ['neutral'] },
                { emoji: 'üìç', text: 'Stay within 5 miles', tags: ['neutral'] }
            ],
            vibe: [
                { emoji: 'üòå', text: 'Chill and cozy' },
                { emoji: 'üíï', text: 'Romantic and intimate' },
                { emoji: 'üèÜ', text: 'Competitive and fun' },
                { emoji: 'üåü', text: 'Adventurous and bold' },
                { emoji: 'üòÑ', text: 'Silly and playful' },
                { emoji: 'üí≠', text: 'Nostalgic and sweet' },
                { emoji: 'üí¨', text: 'Deep conversation focused' },
                { emoji: '‚ö°', text: 'High-energy and active' },
                { emoji: 'üé®', text: 'Creative and artsy' },
                { emoji: 'üõãÔ∏è', text: 'Low-effort, high-connection' },
                { emoji: 'üåà', text: 'Spontaneous and carefree' },
                { emoji: 'üßò', text: 'Calm and mindful' },
                { emoji: 'üéâ', text: 'Celebratory and festive' },
                { emoji: 'üå∫', text: 'Peaceful and relaxing' }
            ],
            food: [
                { emoji: 'üç∞', text: 'Dessert crawl', tags: ['anytime', 'normal-budget'] },
                { emoji: '‚òï', text: 'Coffee shop hopping', tags: ['morning', 'daytime', 'budget'] },
                { emoji: 'üçπ', text: 'Mocktail or cocktail tasting', tags: ['evening', 'normal-budget'] },
                { emoji: 'üåÆ', text: 'Street food adventure', tags: ['evening', 'budget'] },
                { emoji: 'üçù', text: 'Home-cooked meal', tags: ['anytime', 'budget'] },
                { emoji: 'ü•ê', text: 'Bakery hopping', tags: ['morning', 'budget'] },
                { emoji: 'üçï', text: 'Late-night pizza', tags: ['night', 'budget'] },
                { emoji: 'üç¶', text: 'Ice cream taste test', tags: ['daytime', 'budget'] },
                { emoji: 'üßÄ', text: 'Charcuterie board at home', tags: ['anytime', 'budget'] },
                { emoji: 'ü•¢', text: 'Try new cuisine together', tags: ['anytime', 'normal-budget'] },
                { emoji: 'üçø', text: 'Snack board movie night', tags: ['evening', 'budget'] },
                { emoji: 'ü•ó', text: 'Healthy cooking challenge', tags: ['anytime', 'budget'] },
                { emoji: 'üçî', text: 'Burger joint taste-off', tags: ['anytime', 'budget'] },
                { emoji: 'üç©', text: 'Donut shop tour', tags: ['morning', 'budget'] },
                { emoji: 'ü•ô', text: 'Food truck exploration', tags: ['evening', 'budget'] },
                { emoji: 'üçú', text: 'Ramen or noodle night', tags: ['evening', 'budget'] }
            ]
        };

        let gameMode = null;
        let currentPlayer = 1;
        let player1Date = { location: null, activity: [], twist: null, vibe: null, food: null };
        let player2Date = { location: null, activity: [], twist: null, vibe: null, food: null };
        let currentDate = player1Date;

        function selectMode(mode) {
            gameMode = mode;
            document.querySelectorAll('.mode-card').forEach(card => {
                card.classList.remove('selected');
            });
            event.target.closest('.mode-card').classList.add('selected');

            document.getElementById('startBtn').disabled = false;
            const modeNames = { standard: 'Standard', mashup: 'Mash-Up' };
            document.getElementById('startBtn').textContent = `Start ${modeNames[mode]} Mode`;
        }

        function startGame() {
            document.querySelector('.start-screen').classList.remove('active');

            if (gameMode === 'mashup') {
                document.querySelector('.mashup-screen').classList.add('active');
            } else {
                document.querySelector('.build-screen').classList.add('active');
                document.getElementById('buildIndicator').textContent = 'Player 1: Design Your Dream Date';
                renderCardHand();
            }
        }

        function getTimeConstraints() {
            let constraints = [];

            // Check twist for time constraints
            if (currentDate.twist) {
                if (currentDate.twist.tags.includes('morning')) {
                    constraints.push('morning', 'daytime');
                } else if (currentDate.twist.tags.includes('night')) {
                    constraints.push('night', 'evening');
                }
            }

            // Check location for time hints
            if (currentDate.location) {
                if (currentDate.location.tags.includes('morning')) {
                    constraints.push('morning', 'daytime');
                } else if (currentDate.location.tags.includes('golden-hour')) {
                    constraints.push('morning', 'evening', 'golden-hour');
                } else if (currentDate.location.tags.includes('evening')) {
                    constraints.push('evening', 'night');
                }
            }

            return constraints;
        }

        function getBudgetConstraints() {
            if (currentDate.twist && currentDate.twist.tags.includes('budget')) {
                return true;
            }
            return false;
        }

        function isCardCompatible(card, category) {
            if (!card.tags) return true; // Vibes don't have tags

            const timeConstraints = getTimeConstraints();
            const budgetConstrained = getBudgetConstraints();

            // If we have time constraints, check compatibility
            if (timeConstraints.length > 0) {
                const cardTags = card.tags;

                // Check if card has 'anytime' tag - always compatible
                if (cardTags.includes('anytime')) return true;

                // Check if card has any matching time tags
                const hasMatchingTime = timeConstraints.some(constraint =>
                    cardTags.includes(constraint)
                );

                if (!hasMatchingTime) return false;
            }

            // Budget constraints for food
            if (budgetConstrained && category === 'food') {
                if (!card.tags.includes('budget')) return false;
            }

            return true;
        }

        function renderCardHand() {
            const container = document.getElementById('cardHand');
            container.innerHTML = '';

            const categories = [
                { key: 'location', title: 'üìç Location (Pick 1)', limit: 1, cards: cardDatabase.location },
                { key: 'twist', title: '‚ú® Twist (Pick 1)', limit: 1, cards: cardDatabase.twist },
                { key: 'activity', title: 'üéØ Activity (Pick 1-2)', limit: 2, cards: cardDatabase.activity },
                { key: 'food', title: 'üçΩÔ∏è Food/Treat (Pick 1)', limit: 1, cards: cardDatabase.food },
                { key: 'vibe', title: 'üí´ Vibe (Pick 1)', limit: 1, cards: cardDatabase.vibe }
            ];

            categories.forEach(category => {
                const categoryDiv = document.createElement('div');
                categoryDiv.className = 'card-category';
                categoryDiv.innerHTML = `<div class="category-title">${category.title}</div>`;

                const cardsRow = document.createElement('div');
                cardsRow.className = 'cards-row';

                category.cards.forEach((card, index) => {
                    const cardDiv = document.createElement('div');
                    cardDiv.className = 'game-card-item';
                    cardDiv.dataset.category = category.key;
                    cardDiv.dataset.cardText = card.text;

                    // Check if card is compatible with current selections
                    const isCompatible = isCardCompatible(card, category.key);
                    if (!isCompatible) {
                        cardDiv.classList.add('disabled');
                    }

                    cardDiv.innerHTML = `
                        <div class="card-emoji">${card.emoji}</div>
                        <div class="card-text">${card.text}</div>
                    `;

                    if (isCompatible) {
                        cardDiv.onclick = () => selectCard(category.key, card, cardDiv, category.limit);
                    }

                    cardsRow.appendChild(cardDiv);
                });

                categoryDiv.appendChild(cardsRow);
                container.appendChild(categoryDiv);
            });
        }

        function selectCard(category, card, element, limit) {
            // Handle selection limits
            if (category === 'activity') {
                const isSelected = currentDate.activity.some(c => c.text === card.text);
                if (isSelected) {
                    currentDate.activity = currentDate.activity.filter(c => c.text !== card.text);
                    element.classList.remove('selected');
                } else if (currentDate.activity.length < limit) {
                    currentDate.activity.push(card);
                    element.classList.add('selected');
                }
            } else {
                const categoryCards = document.querySelectorAll(`[data-category="${category}"]`);
                categoryCards.forEach(c => c.classList.remove('selected'));

                if (currentDate[category] && currentDate[category].text === card.text) {
                    currentDate[category] = null;
                } else {
                    currentDate[category] = card;
                    element.classList.add('selected');
                }
            }

            updateSelectedDisplay();
            checkDateComplete();

            // Re-render to apply new filters
            renderCardHand();

            // Restore selections visually
            restoreSelections();
        }

        function restoreSelections() {
            // Restore location selection
            if (currentDate.location) {
                const locationCard = document.querySelector(`[data-category="location"][data-card-text="${currentDate.location.text}"]`);
                if (locationCard) locationCard.classList.add('selected');
            }

            // Restore activity selections
            currentDate.activity.forEach(act => {
                const actCard = document.querySelector(`[data-category="activity"][data-card-text="${act.text}"]`);
                if (actCard) actCard.classList.add('selected');
            });

            // Restore twist selection
            if (currentDate.twist) {
                const twistCard = document.querySelector(`[data-category="twist"][data-card-text="${currentDate.twist.text}"]`);
                if (twistCard) twistCard.classList.add('selected');
            }

            // Restore vibe selection
            if (currentDate.vibe) {
                const vibeCard = document.querySelector(`[data-category="vibe"][data-card-text="${currentDate.vibe.text}"]`);
                if (vibeCard) vibeCard.classList.add('selected');
            }

            // Restore food selection
            if (currentDate.food) {
                const foodCard = document.querySelector(`[data-category="food"][data-card-text="${currentDate.food.text}"]`);
                if (foodCard) foodCard.classList.add('selected');
            }
        }

        function updateSelectedDisplay() {
            const summary = document.getElementById('selectedSummary');
            let html = '';

            if (currentDate.location) {
                html += `<div class="selected-category">
                    <div class="selected-category-title">üìç Location:</div>
                    <span class="selected-card-badge">${currentDate.location.emoji} ${currentDate.location.text}</span>
                </div>`;
            }

            if (currentDate.twist) {
                html += `<div class="selected-category">
                    <div class="selected-category-title">‚ú® Twist:</div>
                    <span class="selected-card-badge">${currentDate.twist.emoji} ${currentDate.twist.text}</span>
                </div>`;
            }

            if (currentDate.activity.length > 0) {
                html += `<div class="selected-category">
                    <div class="selected-category-title">üéØ Activities:</div>`;
                currentDate.activity.forEach(act => {
                    html += `<span class="selected-card-badge">${act.emoji} ${act.text}</span>`;
                });
                html += `</div>`;
            }

            if (currentDate.food) {
                html += `<div class="selected-category">
                    <div class="selected-category-title">üçΩÔ∏è Food:</div>
                    <span class="selected-card-badge">${currentDate.food.emoji} ${currentDate.food.text}</span>
                </div>`;
            }

            if (currentDate.vibe) {
                html += `<div class="selected-category">
                    <div class="selected-category-title">üí´ Vibe:</div>
                    <span class="selected-card-badge">${currentDate.vibe.emoji} ${currentDate.vibe.text}</span>
                </div>`;
            }

            summary.innerHTML = html || '<p style="color: #999; font-style: italic;">Select cards below to build your date...</p>';
        }

        function checkDateComplete() {
            const isComplete = currentDate.location &&
                             currentDate.activity.length > 0 &&
                             currentDate.twist &&
                             currentDate.vibe &&
                             currentDate.food;

            document.getElementById('confirmDateBtn').disabled = !isComplete;
        }

        function confirmDate() {
            if (currentPlayer === 1) {
                currentPlayer = 2;
                currentDate = player2Date;

                document.getElementById('buildIndicator').textContent = 'Player 2: Design Your Dream Date';
                document.getElementById('selectedSummary').innerHTML = '<p style="color: #999; font-style: italic;">Select cards below to build your date...</p>';
                document.getElementById('confirmDateBtn').disabled = true;

                renderCardHand();
                window.scrollTo(0, 0);
            } else {
                showReveal();
            }
        }

        function generateMashupDate() {
            // Generate one random compatible date
            let date = {
                location: null,
                activity: [],
                twist: null,
                vibe: null,
                food: null
            };

            // Pick random cards ensuring compatibility
            date.location = getRandomCard('location');
            date.twist = getRandomCard('twist');

            // Now filter activities and food based on constraints
            currentDate = date; // Temporarily set for constraint checking

            const compatibleActivities = cardDatabase.activity.filter(card =>
                isCardCompatible(card, 'activity')
            );
            const compatibleFood = cardDatabase.food.filter(card =>
                isCardCompatible(card, 'food')
            );

            date.activity = [getRandomFromArray(compatibleActivities)];
            if (Math.random() > 0.5 && compatibleActivities.length > 1) {
                const secondActivity = getRandomFromArray(compatibleActivities.filter(a => a.text !== date.activity[0].text));
                if (secondActivity) date.activity.push(secondActivity);
            }

            date.food = getRandomFromArray(compatibleFood);
            date.vibe = getRandomCard('vibe');

            player1Date = date;

            // Display the result
            const resultsDiv = document.getElementById('mashupResults');
            const revealContainer = document.getElementById('mashupReveal');
            revealContainer.innerHTML = '';

            revealContainer.appendChild(createDateCard('Your Random Date Idea', player1Date));

            resultsDiv.style.display = 'block';
        }

        function getRandomCard(category) {
            const cards = cardDatabase[category];
            return cards[Math.floor(Math.random() * cards.length)];
        }

        function getRandomFromArray(array) {
            if (array.length === 0) return null;
            return array[Math.floor(Math.random() * array.length)];
        }

        function showReveal() {
            document.querySelector('.build-screen').classList.remove('active');
            document.querySelector('.reveal-screen').classList.add('active');

            const revealContainer = document.getElementById('dateReveal');
            revealContainer.innerHTML = '';

            const wrapper = document.createElement('div');
            wrapper.style.display = 'grid';
            wrapper.style.gridTemplateColumns = window.innerWidth > 768 ? '1fr 1fr' : '1fr';
            wrapper.style.gap = '20px';
            wrapper.style.marginBottom = '20px';

            wrapper.appendChild(createDateCard('Player 1\'s Dream Date', player1Date));
            wrapper.appendChild(createDateCard('Player 2\'s Dream Date', player2Date));

            revealContainer.appendChild(wrapper);
        }

        function createDateCard(title, dateData) {
            const card = document.createElement('div');
            card.className = 'date-design';

            let html = `<h3>${title}</h3>`;

            if (dateData.location) {
                html += `<div class="date-section">
                    <div class="date-section-title">üìç Location</div>
                    <div class="date-section-content">${dateData.location.emoji} ${dateData.location.text}</div>
                </div>`;
            }

            if (dateData.twist) {
                html += `<div class="date-section">
                    <div class="date-section-title">‚ú® Twist</div>
                    <div class="date-section-content">${dateData.twist.emoji} ${dateData.twist.text}</div>
                </div>`;
            }

            if (dateData.activity.length > 0) {
                html += `<div class="date-section">
                    <div class="date-section-title">üéØ Activities</div>
                    <div class="date-section-content">`;
                dateData.activity.forEach(act => {
                    html += `${act.emoji} ${act.text}<br>`;
                });
                html += `</div></div>`;
            }

            if (dateData.food) {
                html += `<div class="date-section">
                    <div class="date-section-title">üçΩÔ∏è Food/Treat</div>
                    <div class="date-section-content">${dateData.food.emoji} ${dateData.food.text}</div>
                </div>`;
            }

            if (dateData.vibe) {
                html += `<div class="date-section">
                    <div class="date-section-title">üí´ Vibe</div>
                    <div class="date-section-content">${dateData.vibe.emoji} ${dateData.vibe.text}</div>
                </div>`;
            }

            card.innerHTML = html;
            return card;
        }
    </script>
</body>
</html>
