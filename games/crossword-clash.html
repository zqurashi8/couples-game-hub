<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crossword Clash - Couples Game Hub</title>
    <link rel="stylesheet" href="../css/style.css">
    <style>
        /* Shared Game Styles */
        .player-indicator {
            text-align: center; font-size: 1.5em; font-weight: bold; color: #764ba2;
            margin-bottom: 20px; padding: 15px; background: #f8f9ff; border-radius: 10px;
        }
        .stats { display: flex; justify-content: space-around; margin-bottom: 20px; gap: 15px; }
        .stat-box { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 15px; border-radius: 10px; text-align: center; flex: 1; }
        .stat-label { font-size: 0.9em; opacity: 0.9; margin-bottom: 5px; }
        .stat-value { font-size: 1.5em; font-weight: bold; }

        /* Crossword Specific Styles */
        .crossword-container {
            display: flex; flex-direction: column; gap: 20px; align-items: center;
        }

        .crossword-grid {
            display: grid;
            background: #333;
            gap: 1px;
            border: 4px solid #333;
            user-select: none;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        .cw-cell {
            background: white;
            position: relative;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2em;
            text-transform: uppercase;
            cursor: pointer;
            transition: background 0.2s;
        }

        /* FIXED: Black boxes are now strictly immutable */
        .cw-cell.black {
            background: #222 !important;
            border-color: #222 !important;
            cursor: default !important;
            pointer-events: none !important;
        }

        /* Selection Colors */
        .cw-cell.selected {
            background: #fff9c4; /* Yellow for focused cell */
        }

        .cw-cell.active-word {
            background: #e3f2fd; /* Light Blue for current word */
        }

        /* Validation Colors - Instant Green */
        .cw-cell.correct {
            background: #c8e6c9 !important; /* Green background */
            color: #2e7d32 !important;     /* Green text */
        }

        /* Ensure selection is still visible even if correct */
        .cw-cell.correct.selected {
            background: #a5d6a7 !important;
            border: 2px solid #2e7d32;
        }

        .cw-number {
            position: absolute;
            top: 2px;
            left: 2px;
            font-size: 0.6em;
            color: #666;
            line-height: 1;
            pointer-events: none;
        }

        .cw-input {
            width: 100%;
            height: 100%;
            border: none;
            text-align: center;
            background: transparent;
            font-size: inherit;
            font-weight: inherit;
            color: inherit;
            padding: 0;
            outline: none;
            caret-color: transparent;
            cursor: pointer;
        }

        .clues-container {
            width: 100%;
            background: #f8f9ff;
            padding: 20px;
            border-radius: 15px;
            max-height: 400px;
            overflow-y: auto;
            border: 2px solid #e0e4ff;
        }

        .clue-section h3 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 1.1em;
            border-bottom: 2px solid #e0e4ff;
            padding-bottom: 5px;
        }

        .clue-list {
            list-style: none;
            margin-bottom: 20px;
        }

        .clue-item {
            padding: 8px;
            cursor: pointer;
            border-radius: 5px;
            margin-bottom: 4px;
            font-size: 0.95em;
            color: #555;
            transition: background 0.2s;
        }

        .clue-item:hover {
            background: #e0e4ff;
        }

        .clue-item.active {
            background: #667eea;
            color: white;
            font-weight: bold;
        }

        .clue-item.correct-clue {
            text-decoration: line-through;
            opacity: 0.5;
        }

        /* Mode Selection Buttons */
        .mode-selection {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .mode-btn-game {
            padding: 20px;
            background: white;
            border: 2px solid #ddd;
            border-radius: 15px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s;
        }
        
        .mode-btn-game:hover {
            border-color: #667eea;
            transform: translateY(-3px);
        }
        
        .mode-btn-game.selected {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #764ba2;
        }

        @media (min-width: 768px) {
            .crossword-container {
                flex-direction: row;
                align-items: flex-start;
                justify-content: center;
            }
            .clues-container {
                width: 320px;
                height: 380px; 
            }
        }

        /* Screens */
        .start-screen, .game-screen, .end-screen, .lobby-screen { display: none; }
        .active { display: block; }
        
        /* Buttons */
        button {
            width: 100%; padding: 15px; font-size: 1.2em;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white; border: none; border-radius: 10px; 
            cursor: pointer; margin-top: 10px; font-weight: bold;
        }
        
        .hint-btn {
            background: #ffb74d; 
            color: white;
            margin-top: 10px;
        }
        .hint-btn:disabled {
            background: #e0e0e0;
            cursor: not-allowed;
        }

        .secondary-btn { background: white; color: #667eea; border: 2px solid #667eea; }
        .leave-game-btn { background: transparent; border: 2px solid #e74c3c; color: #e74c3c; }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="game-header">
            <a href="../index.html" class="back-link">‚Üê Back to Games</a>
            <div class="mode-toggle" role="group" aria-label="Play mode">
                <button type="button" class="mode-btn" data-mode="local">üè† Local</button>
                <button type="button" class="mode-btn" data-mode="online">üåê Online</button>
            </div>
        </div>
        <p class="mode-status">Mode: <span id="modeBadge">Local</span></p>
        <h1 class="game-title">üß© Crossword Clash</h1>
        <p class="game-subtitle">Solve together or race to finish!</p>

        <div id="onlineScreens">
            <div class="online-lobby-screen lobby-screen">
                <h2 style="text-align: center; color: #764ba2; margin-bottom: 20px;">Play Online</h2>
                <div style="display: grid; gap: 15px;">
                    <button onclick="showCreateGame()">‚ûï Create Game</button>
                    <button class="secondary-btn" onclick="showJoinGame()">üîó Join Game</button>
                </div>
            </div>

            <div class="create-game-screen lobby-screen">
                <h2>Create Game</h2>
                <input type="text" id="p1Name" placeholder="Your Name" style="width: 100%; padding: 15px; margin: 15px 0; border: 2px solid #ddd; border-radius: 8px;">
                <button onclick="createGameSession()">Get Code</button>
                <button class="secondary-btn" onclick="backToLobby()">Back</button>
            </div>

            <div class="join-game-screen lobby-screen">
                <h2>Join Game</h2>
                <input type="text" id="p2Name" placeholder="Your Name" style="width: 100%; padding: 15px; margin: 10px 0; border: 2px solid #ddd; border-radius: 8px;">
                <input type="text" id="joinCode" placeholder="Game Code" style="width: 100%; padding: 15px; margin-bottom: 15px; border: 2px solid #ddd; border-radius: 8px; text-transform: uppercase;">
                <button onclick="joinGameSession()">Join</button>
                <button class="secondary-btn" onclick="backToLobby()">Back</button>
            </div>

            <div class="waiting-screen lobby-screen">
                <h2 style="text-align: center;">Waiting for Player 2...</h2>
                <div style="background: #f8f9ff; padding: 20px; border-radius: 10px; text-align: center; margin: 20px 0; border: 2px solid #667eea;">
                    <p style="color: #666;">Code:</p>
                    <h1 id="codeDisplay" style="color: #667eea; letter-spacing: 5px; font-size: 2.5em;">------</h1>
                </div>
                <button class="secondary-btn" onclick="location.reload()">Cancel</button>
            </div>

            <div class="connecting-screen lobby-screen">
                <h2 style="text-align: center;">Connected!</h2>
                <p style="text-align: center; margin-top: 20px;">Playing with <strong id="partnerName">...</strong></p>
            </div>
        </div>

        <div class="start-screen active">
            <div class="instructions">
                <h3>Choose Grid Size:</h3>
                <div class="mode-selection" style="grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 30px;">
                    <div class="mode-btn-game" onclick="selectPuzzleSize(4, this)">
                        <div style="font-size: 1.5em;">üéØ</div>
                        <strong>4x4</strong>
                        <p style="font-size: 0.8em; color: #666;">Quick</p>
                    </div>
                    <div class="mode-btn-game selected" onclick="selectPuzzleSize(5, this)">
                        <div style="font-size: 1.5em;">üé≤</div>
                        <strong>5x5</strong>
                        <p style="font-size: 0.8em; color: #666;">Easy</p>
                    </div>
                    <div class="mode-btn-game" onclick="selectPuzzleSize(6, this)">
                        <div style="font-size: 1.5em;">üé™</div>
                        <strong>6x6</strong>
                        <p style="font-size: 0.8em; color: #666;">Medium</p>
                    </div>
                    <div class="mode-btn-game" onclick="selectPuzzleSize(7, this)">
                        <div style="font-size: 1.5em;">üé≠</div>
                        <strong>7x7</strong>
                        <p style="font-size: 0.8em; color: #666;">Hard</p>
                    </div>
                </div>

                <h3>Choose Your Mode:</h3>
                <div class="mode-selection">
                    <div class="mode-btn-game selected" onclick="selectGameMode('race', this)">
                        <div style="font-size: 2em;">‚ö°</div>
                        <strong>Speed Clash</strong>
                        <p style="font-size: 0.8em; color: #666;">Race to finish your own board first!</p>
                    </div>
                    <div class="mode-btn-game" onclick="selectGameMode('coop', this)">
                        <div style="font-size: 2em;">ü§ù</div>
                        <strong>Co-op</strong>
                        <p style="font-size: 0.8em; color: #666;">Solve the same board together.</p>
                    </div>
                </div>
                <p id="modeDescription" style="text-align: center; color: #666;">Local: Play solo against the clock.<br>Online: Race your partner!</p>
            </div>
            <button onclick="startGame()">Start Puzzle</button>
        </div>

        <div class="game-screen">
            <div class="player-indicator" id="gameStatus">Solving...</div>

            <div class="stats">
                <div class="stat-box">
                    <div class="stat-label">Progress</div>
                    <div class="stat-value" id="progressDisplay">0%</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Time</div>
                    <div class="stat-value" id="timerDisplay">00:00</div>
                </div>
                <div class="stat-box" id="opponentStatBox" style="display: none; background: #95a5a6;">
                    <div class="stat-label">Opponent</div>
                    <div class="stat-value" id="opponentProgress">0%</div>
                </div>
            </div>

            <div class="crossword-container">
                <div id="gridContainer" class="crossword-grid">
                    </div>

                <div class="clues-container">
                    <div class="clue-section">
                        <h3>‚û°Ô∏è Across</h3>
                        <ul id="acrossClues" class="clue-list"></ul>
                    </div>
                    <div class="clue-section">
                        <h3>‚¨áÔ∏è Down</h3>
                        <ul id="downClues" class="clue-list"></ul>
                    </div>
                </div>
            </div>

            <button class="hint-btn" id="hintBtn" onclick="useHint()">üí° Hint (3 left)</button>
            <button class="secondary-btn" onclick="checkPuzzle()">Check Puzzle</button>
            <button class="leave-game-btn" onclick="leaveGame()">Leave Game</button>
        </div>

        <div class="end-screen">
            <div class="score-display">Puzzle Complete! üéâ</div>
            <h2 id="winnerText" style="text-align: center; color: #667eea; margin-bottom: 20px;"></h2>
            <div class="stats">
                <div class="stat-box">
                    <div class="stat-label">Final Time</div>
                    <div class="stat-value" id="finalTime">00:00</div>
                </div>
            </div>
            <button onclick="location.reload()">Play Another</button>
        </div>
    </div>

    <script src="../js/mode-toggle.js"></script>
    <script type="module">
        import MultiplayerSession from '../js/multiplayer.js';

        // --- CROSSWORD GENERATOR ---
        // Dense Crossword Generator using Backtracking with Prefix Checking

        // Word dictionaries for each size
        const wordDictionaries = {
            4: ["ABLE", "ACID", "AGED", "ALSO", "AREA", "ARMY", "AWAY", "BABY", "BACK", "BALL", "BAND", "BANK", "BASE", "BATH", "BEAR", "BEAT", "BEEN", "BEER", "BELL", "BELT", "BEST", "BILL", "BIRD", "BLOW", "BLUE", "BOAT", "BODY", "BOMB", "BOND", "BONE", "BOOK", "BOOM", "BORN", "BOSS", "BOTH", "BOWL", "BULK", "BURN", "BUSH", "BUSY", "CALL", "CALM", "CAME", "CAMP", "CARD", "CARE", "CASE", "CASH", "CAST", "CELL", "CHAT", "CHEF", "CHIP", "CITY", "CLUB", "COAL", "COAT", "CODE", "COLD", "COME", "COOK", "COOL", "COPE", "COPY", "CORE", "CORN", "COST", "CREW", "CROP", "DARK", "DATA", "DATE", "DAWN", "DEAD", "DEAL", "DEAN", "DEAR", "DEBT", "DEEP", "DENY", "DESK", "DIET", "DISC", "DISK", "DOES", "DONE", "DOOR", "DOSE", "DOWN", "DRAG", "DRAW", "DREW", "DROP", "DRUG", "DRUM", "DUAL", "DUCK", "DUKE", "DUST", "DUTY", "EACH", "EARL", "EARN", "EASE", "EAST", "EASY", "EDGE", "ELSE", "EVEN", "EVER", "EVIL", "EXIT", "FACE", "FACT", "FAIL", "FAIR", "FALL", "FARM", "FAST", "FATE", "FEAR", "FEED", "FEEL", "FEET", "FELL", "FELT", "FILE", "FILL", "FILM", "FIND", "FINE", "FIRE", "FIRM", "FISH", "FIVE", "FLAT", "FLED", "FLEW", "FLOW", "FOLK", "FOOD", "FOOT", "FORD", "FORM", "FORT", "FOUR", "FREE", "FROM", "FUEL", "FULL", "FUND", "GAIN", "GAME", "GATE", "GAVE", "GEAR", "GENE", "GIFT", "GIRL", "GIVE", "GLAD", "GOAL", "GOES", "GOLD", "GOLF", "GONE", "GOOD", "GRAY", "GREW", "GREY", "GRIP", "GROW", "GULF", "HAIR", "HALF", "HALL", "HAND", "HANG", "HARD", "HARM", "HATE", "HAVE", "HEAD", "HEAR", "HEAT", "HELD", "HELL", "HELP", "HERE", "HERO", "HIGH", "HILL", "HIRE", "HOLD", "HOLE", "HOME", "HOPE", "HOST", "HOUR", "HUGE", "HUNG", "HUNT", "HURT", "IDEA", "INCH", "INTO", "IRON", "ITEM", "JACK", "JANE", "JULY", "JUNE", "JURY", "JUST", "KEEP", "KENT", "KEPT", "KICK", "KILL", "KIND", "KING", "KNEE", "KNEW", "KNOW", "LACK", "LADY", "LAID", "LAKE", "LAND", "LANE", "LAST", "LATE", "LEAD", "LEFT", "LESS", "LIFE", "LIFT", "LIKE", "LINE", "LINK", "LIST", "LIVE", "LOAD", "LOAN", "LOCK", "LONG", "LOOK", "LORD", "LOSE", "LOSS", "LOST", "LOVE", "LUCK", "LUNCH", "LUNG", "MADE", "MAIL", "MAIN", "MAKE", "MALE", "MALL", "MANY", "MARK", "MASS", "MATE", "MATH", "MEAL", "MEAN", "MEAT", "MEET", "MENU", "MERE", "MILE", "MILK", "MILL", "MIND", "MINE", "MISS", "MODE", "MOOD", "MOON", "MORE", "MOST", "MOVE", "MUCH", "MUST", "NAME", "NAVY", "NEAR", "NECK", "NEED", "NEWS", "NEXT", "NICE", "NICK", "NINE", "NONE", "NOON", "NORM", "NOSE", "NOTE", "OATH", "OBEY", "ODDS", "OKAY", "ONCE", "ONLY", "ONTO", "OPEN", "ORAL", "OVER", "PACE", "PACK", "PAGE", "PAID", "PAIN", "PAIR", "PALE", "PALM", "PARK", "PART", "PASS", "PAST", "PATH", "PEAK", "PICK", "PILE", "PILL", "PINE", "PINK", "PIPE", "PLAN", "PLAY", "PLOT", "PLUG", "PLUS", "POEM", "POET", "POLE", "POLL", "POND", "POOL", "POOR", "POPE", "PORK", "PORT", "POST", "POUR", "PRAY", "PREP", "PREY", "PURE", "PUSH", "RACE", "RAIL", "RAIN", "RANK", "RARE", "RATE", "READ", "REAL", "REAR", "RELY", "RENT", "REST", "RICE", "RICH", "RIDE", "RING", "RISE", "RISK", "ROAD", "ROCK", "ROLE", "ROLL", "ROOF", "ROOM", "ROOT", "ROPE", "ROSE", "RULE", "RUSH", "RUTH", "SAFE", "SAID", "SAKE", "SALE", "SALT", "SAME", "SAND", "SAVE", "SEAT", "SEED", "SEEK", "SEEM", "SEEN", "SELF", "SELL", "SEND", "SENT", "SEPT", "SHIP", "SHOP", "SHOT", "SHOW", "SHUT", "SICK", "SIDE", "SIGN", "SILK", "SING", "SINK", "SITE", "SIZE", "SKIN", "SLIP", "SLOW", "SNOW", "SOFT", "SOIL", "SOLD", "SOLE", "SOME", "SONG", "SOON", "SORT", "SOUL", "SPOT", "STAR", "STAY", "STEP", "STOP", "SUCH", "SUIT", "SURE", "TAKE", "TALE", "TALK", "TALL", "TANK", "TAPE", "TASK", "TEAM", "TEAR", "TECH", "TELL", "TEND", "TERM", "TEST", "TEXT", "THAN", "THAT", "THEM", "THEN", "THEY", "THIN", "THIS", "THUS", "TIDE", "TIED", "TIER", "TILL", "TIME", "TINY", "TIRE", "TONE", "TOOK", "TOOL", "TORN", "TOUR", "TOWN", "TREE", "TRIP", "TRUE", "TUNE", "TURN", "TWIN", "TYPE", "UNIT", "UPON", "USED", "USER", "VARY", "VAST", "VERY", "VICE", "VIEW", "VISA", "VOTE", "WAGE", "WAIT", "WAKE", "WALK", "WALL", "WANT", "WARD", "WARM", "WARN", "WASH", "WAVE", "WAYS", "WEAK", "WEAR", "WEEK", "WELL", "WENT", "WERE", "WEST", "WHAT", "WHEN", "WHOM", "WIDE", "WIFE", "WILD", "WILL", "WIND", "WINE", "WING", "WIRE", "WISE", "WISH", "WITH", "WOOD", "WORD", "WORE", "WORK", "WORN", "YARD", "YEAH", "YEAR", "YOUR", "ZERO", "ZONE"],
            5: ["ABOUT", "ABOVE", "ABUSE", "ADMIT", "ADOPT", "ADULT", "AFTER", "AGAIN", "AGENT", "AGREE", "AHEAD", "ALARM", "ALBUM", "ALERT", "ALIEN", "ALIGN", "ALIKE", "ALIVE", "ALLOW", "ALONE", "ALONG", "ALTER", "ANGEL", "ANGER", "ANGLE", "ANGRY", "APART", "APPLE", "APPLY", "ARENA", "ARGUE", "ARISE", "ARRAY", "ARROW", "ASIDE", "ASSET", "AUDIO", "AVOID", "AWARD", "AWARE", "BADLY", "BAKER", "BASES", "BASIC", "BASIN", "BASIS", "BEACH", "BEGAN", "BEGIN", "BEING", "BELOW", "BENCH", "BILLY", "BIRTH", "BLACK", "BLADE", "BLAME", "BLANK", "BLIND", "BLOCK", "BLOOD", "BLOOM", "BOARD", "BOOST", "BOOTH", "BOUND", "BRAIN", "BRAND", "BREAD", "BREAK", "BREED", "BRIEF", "BRING", "BROAD", "BROKE", "BROWN", "BUILD", "BUILT", "BUYER", "CABLE", "CALIF", "CARRY", "CATCH", "CAUSE", "CHAIN", "CHAIR", "CHAOS", "CHARM", "CHART", "CHASE", "CHEAP", "CHECK", "CHEST", "CHIEF", "CHILD", "CHINA", "CHOSE", "CIVIL", "CLAIM", "CLASS", "CLEAN", "CLEAR", "CLICK", "CLIMB", "CLOCK", "CLOSE", "COACH", "COAST", "COULD", "COUNT", "COURT", "COVER", "CRAFT", "CRASH", "CRAZY", "CREAM", "CRIME", "CROSS", "CROWD", "CROWN", "CRUDE", "CURVE", "CYCLE", "DAILY", "DANCE", "DATED", "DEALT", "DEATH", "DEBUT", "DELAY", "DELTA", "DENSE", "DEPTH", "DOING", "DOUBT", "DOZEN", "DRAFT", "DRAMA", "DRANK", "DRAWN", "DREAM", "DRESS", "DRILL", "DRINK", "DRIVE", "DROVE", "DYING", "EAGER", "EARLY", "EARTH", "EIGHT", "EIGHT", "ELECT", "ELITE", "EMPTY", "ENEMY", "ENJOY", "ENTER", "ENTRY", "EQUAL", "ERROR", "ESSAY", "EVENT", "EVERY", "EXACT", "EXIST", "EXTRA", "FAITH", "FALSE", "FAULT", "FENCE", "FIBER", "FIELD", "FIFTH", "FIFTY", "FIGHT", "FINAL", "FIRST", "FIXED", "FLASH", "FLEET", "FLOOR", "FLUID", "FOCUS", "FORCE", "FORTH", "FORTY", "FORUM", "FOUND", "FRAME", "FRANK", "FRAUD", "FRESH", "FRONT", "FRUIT", "FULLY", "FUNNY", "GIANT", "GIVEN", "GLASS", "GLOBE", "GOING", "GRACE", "GRADE", "GRAND", "GRANT", "GRASS", "GRAVE", "GREAT", "GREEN", "GROSS", "GROUP", "GROWN", "GUARD", "GUESS", "GUEST", "GUIDE", "GUILD", "GUILTY", "HAPPY", "HARRY", "HARSH", "HEART", "HEAVY", "HENCE", "HENRY", "HORSE", "HOTEL", "HOUSE", "HUMAN", "IDEAL", "IMAGE", "INDEX", "INNER", "INPUT", "ISSUE", "JAPAN", "JIMMY", "JOINT", "JONES", "JUDGE", "KNOWN", "LABEL", "LARGE", "LASER", "LATER", "LAUGH", "LAYER", "LEARN", "LEASE", "LEAST", "LEAVE", "LEGAL", "LEMON", "LEVEL", "LEWIS", "LIGHT", "LIMIT", "LINKS", "LIVED", "LOCAL", "LOGIC", "LOOSE", "LOWER", "LUCKY", "LUNCH", "LYING", "MAGIC", "MAJOR", "MAKER", "MARCH", "MARIA", "MATCH", "MAYBE", "MAYOR", "MEANT", "MEDIA", "METAL", "MIGHT", "MINOR", "MINUS", "MIXED", "MODEL", "MONEY", "MONTH", "MORAL", "MOTOR", "MOUNT", "MOUSE", "MOUTH", "MOVED", "MOVIE", "MUSIC", "NEEDS", "NEVER", "NEWLY", "NIGHT", "NOBLE", "NOISE", "NORTH", "NOTED", "NOVEL", "NURSE", "OCCUR", "OCEAN", "OFFER", "OFTEN", "ORDER", "OTHER", "OUGHT", "PAINT", "PANEL", "PANIC", "PAPER", "PARTY", "PEACE", "PETER", "PHASE", "PHONE", "PHOTO", "PIANO", "PIECE", "PILOT", "PITCH", "PLACE", "PLAIN", "PLANE", "PLANT", "PLATE", "POINT", "POUND", "POWER", "PRESS", "PRICE", "PRIDE", "PRIME", "PRINT", "PRIOR", "PRIZE", "PROOF", "PROUD", "PROVE", "QUEEN", "QUERY", "QUEST", "QUICK", "QUIET", "QUITE", "RADIO", "RAISE", "RANGE", "RAPID", "RATIO", "REACH", "READY", "REFER", "RIGHT", "RIVAL", "RIVER", "ROBIN", "ROGER", "ROMAN", "ROUGH", "ROUND", "ROUTE", "ROYAL", "RURAL", "SCALE", "SCENE", "SCOPE", "SCORE", "SENSE", "SERVE", "SEVEN", "SHALL", "SHAPE", "SHARE", "SHARP", "SHEET", "SHELF", "SHELL", "SHIFT", "SHINE", "SHIRT", "SHOCK", "SHOOT", "SHORT", "SHOWN", "SIGHT", "SINCE", "SIXTH", "SIZED", "SKILL", "SLEEP", "SLIDE", "SMALL", "SMART", "SMILE", "SMITH", "SMOKE", "SOLID", "SOLVE", "SORRY", "SOUND", "SOUTH", "SPACE", "SPARE", "SPEAK", "SPEED", "SPEND", "SPENT", "SPLIT", "SPOKE", "SPORT", "STAFF", "STAGE", "STAKE", "STAND", "START", "STATE", "STEAM", "STEEL", "STEEP", "STICK", "STILL", "STOCK", "STONE", "STOOD", "STORE", "STORM", "STORY", "STRIP", "STUCK", "STUDY", "STUFF", "STYLE", "SUGAR", "SUITE", "SUNNY", "SUPER", "SWEET", "TABLE", "TAKEN", "TASTE", "TAXES", "TEACH", "TERRY", "TEXAS", "THANK", "THEFT", "THEIR", "THEME", "THERE", "THESE", "THICK", "THING", "THINK", "THIRD", "THOSE", "THREE", "THREW", "THROW", "TIGHT", "TIMES", "TITLE", "TODAY", "TOPIC", "TOTAL", "TOUCH", "TOUGH", "TOWER", "TRACK", "TRADE", "TRAIL", "TRAIN", "TRAIT", "TREAT", "TREND", "TRIAL", "TRIBE", "TRICK", "TRIED", "TROOP", "TRUCK", "TRULY", "TRUNK", "TRUST", "TRUTH", "TWICE", "UNDER", "UNDUE", "UNION", "UNITY", "UNTIL", "UPPER", "UPSET", "URBAN", "USAGE", "USUAL", "VALID", "VALUE", "VIDEO", "VIRUS", "VISIT", "VITAL", "VOCAL", "VOICE", "WASTE", "WATCH", "WATER", "WHEEL", "WHERE", "WHICH", "WHILE", "WHITE", "WHOLE", "WHOSE", "WOMAN", "WOMEN", "WORLD", "WORRY", "WORSE", "WORST", "WORTH", "WOULD", "WOUND", "WRITE", "WRONG", "WROTE", "YIELD", "YOUNG", "YOUTH"],
            6: ["ACCEPT", "ACCESS", "ACROSS", "ACTION", "ACTUAL", "ADVICE", "AFFAIR", "AFFECT", "AFFORD", "AFRAID", "AGENCY", "AGENDA", "ALMOST", "ALWAYS", "AMOUNT", "ANIMAL", "ANNUAL", "ANSWER", "ANYONE", "ANYWAY", "APPEAL", "APPEAR", "AROUND", "ARRIVE", "ARTIST", "ASPECT", "ASSIGN", "ASSIST", "ASSUME", "ATTACK", "ATTEND", "AUGUST", "AUTHOR", "AVENUE", "BACKED", "BARELY", "BARREL", "BASKET", "BATTLE", "BEAUTY", "BECAME", "BECOME", "BEFORE", "BEHALF", "BEHIND", "BELIEF", "BELONG", "BENEFIT", "BESIDE", "BETTER", "BEYOND", "BISHOP", "BORDER", "BOTTLE", "BOTTOM", "BRANCH", "BREATH", "BRIDGE", "BRIGHT", "BRING", "BROKEN", "BUDGET", "BURDEN", "BUREAU", "BUTTON", "CAMERA", "CANCER", "CANNOT", "CARBON", "CAREER", "CASTLE", "CASUAL", "CAUGHT", "CENTER", "CENTRE", "CENTURY", "CHAIN", "CHANCE", "CHANGE", "CHARGE", "CHOICE", "CHOOSE", "CHOSEN", "CHURCH", "CIRCLE", "CLIENT", "CLOSED", "CLOSER", "COFFEE", "COLUMN", "COMBAT", "COMMON", "COMPLY", "COPPER", "CORNER", "COSTLY", "COUNTY", "COUPLE", "COURSE", "COVERS", "CREATE", "CREDIT", "CRISIS", "CUSTOM", "DAMAGE", "DANGER", "DEALER", "DEBATE", "DECADE", "DECIDE", "DEFEAT", "DEFEND", "DEFINE", "DEGREE", "DEMAND", "DEPEND", "DEPUTY", "DERIVE", "DESIGN", "DESIRE", "DETAIL", "DETECT", "DEVICE", "DIFFER", "DINNER", "DIRECT", "DOCTOR", "DOLLAR", "DOMAIN", "DOUBLE", "DRIVEN", "DRIVER", "DURING", "EASILY", "EATING", "EDITOR", "EFFECT", "EFFORT", "EIGHTH", "EITHER", "ELEVEN", "EMERGE", "EMPIRE", "EMPLOY", "ENABLE", "ENDING", "ENERGY", "ENGAGE", "ENGINE", "ENOUGH", "ENSURE", "ENTIRE", "ENTITY", "EQUITY", "ESCAPE", "ESTATE", "ETHNIC", "EUROPE", "EVEN", "EXCESS", "EXPAND", "EXPECT", "EXPERT", "EXPORT", "EXTEND", "EXTENT", "FABRIC", "FACIAL", "FACTOR", "FAILED", "FAIRLY", "FALLEN", "FAMILY", "FAMOUS", "FATHER", "FELLOW", "FEMALE", "FIGURE", "FILING", "FINGER", "FINISH", "FISCAL", "FLIGHT", "FLYING", "FOLLOW", "FORCED", "FOREIGN", "FOREST", "FORGET", "FORMAL", "FORMAT", "FORMER", "FOSTER", "FOUGHT", "FOURTH", "FRENCH", "FRIEND", "FUTURE", "GARDEN", "GATHER", "GENDER", "GERMAN", "GLOBAL", "GOLDEN", "GROUND", "GROWTH", "GUILTY", "HANDED", "HANDLE", "HAPPEN", "HARDLY", "HEADED", "HEALTH", "HEAVEN", "HEIGHT", "HIDDEN", "HIGHLY", "HOLDER", "HONEST", "IMPACT", "IMPORT", "IMPOSE", "IMPROVE", "INCOME", "INDEED", "INJURY", "INSIDE", "INTEND", "INTENT", "INVEST", "ISLAND", "ITSELF", "JERSEY", "JOSEPH", "JUNIOR", "KILLED", "LABOUR", "LATEST", "LATTER", "LAUNCH", "LAWYER", "LEADER", "LEAGUE", "LEAVES", "LEGACY", "LENGTH", "LESSON", "LETTER", "LIGHTS", "LIKELY", "LINKED", "LIQUID", "LISTEN", "LITTLE", "LIVING", "LOSING", "LOVELY", "LUXURY", "MAINLY", "MAKING", "MANAGE", "MANNER", "MANUAL", "MARGIN", "MARINE", "MARKED", "MARKET", "MARRIED", "MASTER", "MATTER", "MATURE", "MEDIUM", "MEMBER", "MEMORY", "MENTAL", "MERELY", "MERGER", "METHOD", "MIDDLE", "MILLER", "MINUTE", "MIRROR", "MOBILE", "MODERN", "MODEST", "MODIFY", "MODULE", "MOMENT", "MORRIS", "MOSTLY", "MOTHER", "MOTION", "MOVING", "MURDER", "MUSEUM", "MUTUAL", "MYSELF", "NARROW", "NATION", "NATIVE", "NATURE", "NEARBY", "NEARLY", "NEEDLE", "NEITHER", "NOTICE", "NOTION", "NUMBER", "OBJECT", "OBTAIN", "OFFICE", "OFFICER", "ONLINE", "OPTION", "ORANGE", "ORIGIN", "OUTPUT", "OXFORD", "PACKED", "PALACE", "PARENT", "PARTLY", "PASSED", "PATENT", "PERIOD", "PERMIT", "PERSON", "PHRASE", "PICKED", "PLANET", "PLAYER", "PLEASE", "PLENTY", "POCKET", "POLICE", "POLICY", "PREFER", "PRETTY", "PRIEST", "PRIMARILY", "PRINCE", "PRISON", "PROFIT", "PROPER", "PROVEN", "PUBLIC", "PURSUE", "RAISED", "RANDOM", "RARELY", "RATHER", "RATING", "READER", "REALLY", "REASON", "RECALL", "RECENT", "RECORD", "REDUCE", "REFORM", "REFUSE", "REGARD", "REGIME", "REGION", "RELATE", "RELIEF", "REMAIN", "REMARK", "REMOTE", "REMOVE", "RENDER", "REPAIR", "REPEAT", "REPLY", "REPORT", "RESORT", "RESULT", "RETAIN", "RETURN", "REVEAL", "REVIEW", "REWARD", "RIDING", "RISING", "ROBUST", "RULING", "SAFETY", "SALARY", "SAMPLE", "SAVING", "SAYING", "SCHEME", "SCHOOL", "SCREEN", "SEARCH", "SEASON", "SECOND", "SECRET", "SECTOR", "SECURE", "SEEING", "SEEK", "SELECT", "SELLER", "SENIOR", "SERIES", "SERIOUS", "SERVED", "SETTLE", "SEVERE", "SEXUAL", "SHOULD", "SIGNAL", "SIGNED", "SILENT", "SILVER", "SIMPLE", "SIMPLY", "SINGLE", "SISTER", "SLIGHT", "SMOOTH", "SOCIAL", "SOLELY", "SOUGHT", "SOURCE", "SOVIET", "SPEECH", "SPIRIT", "SPOKEN", "SPREAD", "SPRING", "SQUARE", "STABLE", "STATUS", "STEADY", "STOLEN", "STRAIN", "STRAND", "STREAM", "STREET", "STRESS", "STRICT", "STRIKE", "STRING", "STRONG", "STRUCK", "STRUGGLE", "STUDIO", "SUBMIT", "SUDDEN", "SUFFER", "SUMMER", "SUMMIT", "SUPPLY", "SURELY", "SURVEY", "SWITCH", "SYMBOL", "SYSTEM", "TAKING", "TALENT", "TARGET", "TAUGHT", "TEMPLE", "TENANT", "TEND", "TENNIS", "THANKS", "THEORY", "THIRTY", "THOUGH", "THREAT", "THROWN", "TICKET", "TIMELY", "TIMING", "TISSUE", "TOWARD", "TRADER", "TRAVEL", "TREATY", "TRYING", "TUNNEL", "TURNED", "TWELVE", "TWENTY", "TYPICAL", "UNABLE", "UNIQUE", "UNITED", "UNLIKE", "UNLIKELY", "UNWANT", "UPLOAD", "URBAN", "USEFUL", "VALLEY", "VARIED", "VENDOR", "VERSUS", "VESSEL", "VICTIM", "VISION", "VISUAL", "VOLUME", "WALKER", "WEALTH", "WEAPON", "WEEKLY", "WEIGHT", "WHOLLY", "WINDOW", "WINNER", "WINTER", "WITHIN", "WONDER", "WORKER", "WORKING", "WORTHY", "WRITER", "YELLOW"],
            7: ["ABILITY", "ABSENCE", "ACADEMY", "ACCOUNT", "ACCUSED", "ACHIEVE", "ACQUIRE", "ADDRESS", "ADVANCE", "ADVERSE", "ADVISED", "ADVISER", "AGAINST", "AIRCRAFT", "AIRPORT", "ALCOHOL", "ALLEGED", "ALREADY", "ANALYST", "ANCIENT", "ANOTHER", "ANXIETY", "ANYBODY", "APPLIED", "APPOINT", "APPROVE", "ARRANGE", "ARRIVAL", "ARTICLE", "ARTIST", "ASSAULT", "ASSUMED", "ATTEMPT", "ATTRACT", "AVERAGE", "BACKING", "BALANCE", "BANKING", "BARRIER", "BATTERY", "BEARING", "BEATING", "BECAUSE", "BEDROOM", "BEHAVIOUR", "BELIEVE", "BENEATH", "BENEFIT", "BESIDES", "BETWEEN", "BILLION", "BINDING", "BROTHER", "BROUGHT", "BURNING", "CABINET", "CALIBER", "CALLING", "CAPABLE", "CAPITAL", "CAPTAIN", "CAPTURE", "CAREFUL", "CARRIER", "CENTRAL", "CENTURY", "CERTAIN", "CHAIRMAN", "CHAMBER", "CHANNEL", "CHAPTER", "CHARITY", "CHARLIE", "CHARTER", "CHICKEN", "CIRCUIT", "CITIZEN", "CLASSIC", "CLIMATE", "CLOSING", "CLOSURE", "CLOTHES", "COLLECT", "COLLEGE", "COMBINE", "COMFORT", "COMMAND", "COMMENT", "COMMERCE", "COMMISSION", "COMMON", "COMPANY", "COMPARE", "COMPETE", "COMPLEX", "CONCEPT", "CONCERN", "CONCERT", "CONDUCT", "CONFIRM", "CONFLICT", "CONNECT", "CONSENT", "CONSIST", "CONTACT", "CONTAIN", "CONTENT", "CONTEST", "CONTEXT", "CONTROL", "CONVERT", "CORRECT", "COUNCIL", "COUNSEL", "COUNTER", "COUNTRY", "COURAGE", "CRICKET", "CRITICAL", "CRUCIAL", "CRYSTAL", "CULTURE", "CURRENT", "CUSTODY", "CUTTING", "DEALING", "DECLINE", "DEFAULT", "DEFENCE", "DEFICIT", "DELIVER", "DENSITY", "DEPOSIT", "DESKTOP", "DESPITE", "DESTROY", "DEVELOP", "DIGITAL", "DISEASE", "DISPLAY", "DISPUTE", "DISTANT", "DIVORCE", "DOCTOR", "DOUBT", "DRAWING", "DRESSED", "DRIVING", "DURATION", "DYNAMIC", "EASTERN", "ECONOMY", "EDITION", "ELDERLY", "ELEMENT", "EMBRACE", "EMERGED", "EMOTION", "EMPEROR", "EMPHASIS", "EMPIRE", "EMPLOYEE", "EMPLOYER", "EMPTY", "ENABLING", "ENGAGED", "ENGINE", "ENHANCE", "ENQUIRY", "EPISODE", "EQUALLY", "EVENING", "EVIDENT", "EXACTLY", "EXAMINE", "EXAMPLE", "EXCITED", "EXCLUDE", "EXERCISE", "EXHIBIT", "EXPENSE", "EXPLAIN", "EXPLODE", "EXPLOIT", "EXPLORE", "EXPOSED", "EXPRESS", "EXTEND", "EXTREME", "FACILITY", "FACTORY", "FACULTY", "FAILING", "FAILURE", "FALLING", "FASHION", "FEATURE", "FEDERAL", "FEELING", "FICTION", "FIFTEEN", "FIGHTER", "FIGHTING", "FINANCE", "FINDING", "FITNESS", "FOREIGN", "FOREVER", "FORMULA", "FORTUNE", "FORWARD", "FOUNDER", "FREEDOM", "FREIGHT", "FREQUENT", "FRIEND", "FULFILL", "FUNDING", "FURTHER", "GALLERY", "GENERAL", "GENETIC", "GENUINE", "GESTURE", "GLASGOW", "GLIMPSE", "GLOBAL", "GOLDEN", "GOVERNOR", "GRADUATE", "GRAMMAR", "GRAPHIC", "GREATER", "GREATLY", "HANGING", "HAPPEN", "HEADING", "HEALTHY", "HEARING", "HEAVILY", "HELPFUL", "HERSELF", "HIGHWAY", "HIMSELF", "HISTORY", "HOLDING", "HOLIDAY", "HOPEFUL", "HORIZON", "HOUSING", "HOWEVER", "HUNDRED", "HUSBAND", "IDENTITY", "ILLEGAL", "ILLNESS", "IMAGINE", "IMMIGRATION", "IMPACT", "IMPLY", "IMPOSED", "IMPROVE", "INCIDENT", "INCLUDE", "INCOME", "INCREASE", "INDEED", "INDICATE", "INDUSTRY", "INFANT", "INFORMED", "INITIAL", "INQUIRY", "INSIGHT", "INSIST", "INSPIRE", "INSTALL", "INSTANCE", "INSTANT", "INSTEAD", "INTEND", "INTENSE", "INTERIM", "INTERNAL", "INTERVAL", "INVOLVE", "ISLAMIC", "ISOLATE", "JANUARY", "JOINTLY", "JOURNAL", "JOURNEY", "JUSTICE", "JUSTIFY", "KEEPING", "KITCHEN", "KINGDOM", "LANDING", "LARGELY", "LASTING", "LEADING", "LEARNED", "LEATHER", "LEAVING", "LECTURE", "LEISURE", "LENGTH", "LIBERAL", "LIBERTY", "LIBRARY", "LICENSE", "LIFETIME", "LIGHT", "LIMITED", "LISTING", "LITERARY", "LOCATED", "LOGICAL", "LOOKING", "LOYAL", "MACHINE", "MAINTAIN", "MAJORITY", "MANAGER", "MARRIED", "MASSIVE", "MASTER", "MATERIAL", "MAXIMUM", "MEANING", "MEASURE", "MEDICAL", "MEETING", "MENTION", "MESSAGE", "MILLION", "MINERAL", "MINIMAL", "MINIMUM", "MINISTER", "MINISTRY", "MINORITY", "MISSING", "MISSION", "MISTAKE", "MIXTURE", "MODERATE", "MODERN", "MONARCH", "MONITOR", "MORNING", "MOTHER", "MOTIVATE", "MOUNT", "MULTIPLE", "MUSICAL", "MYSTERY", "NARROW", "NATION", "NATURAL", "NEAREST", "NEITHER", "NETWORK", "NEUTRAL", "NOBILITY", "NOBODY", "NORTHERN", "NOTABLE", "NOTHING", "NUCLEAR", "OBVIOUS", "OCCASION", "OCTOBER", "OFFENCE", "OFFENSE", "OFFICER", "ONGOING", "OPENING", "OPERATE", "OPINION", "OPPONENT", "OPPOSITE", "OPTICAL", "ORGANIC", "OUTCOME", "OUTDOOR", "OUTLINE", "OUTSIDE", "OVERALL", "OWNER", "PACKAGE", "PAINTED", "PALACE", "PANEL", "PARALLEL", "PARKING", "PARTIAL", "PARTNER", "PASSAGE", "PASSING", "PASSION", "PASSIVE", "PATIENT", "PATTERN", "PAYMENT", "PEASANT", "PENALTY", "PENSION", "PERCENT", "PERFECT", "PERFORM", "PERHAPS", "PERIOD", "PERMIT", "PERSIST", "PERSONAL", "PHRASE", "PHYSICAL", "PICTURE", "PIONEER", "PLACE", "PLANNING", "PLATFORM", "PLEASANT", "PLEASED", "PLEASURE", "PLENTY", "POCKET", "POINTED", "POLITE", "POLITICAL", "POPULAR", "PORTRAY", "PORTRAIT", "POSITION", "POSITIVE", "POSSIBLE", "POVERTY", "POWERFUL", "PRACTICE", "PRECISE", "PREDICT", "PREFER", "PREMIER", "PREMIUM", "PREPARE", "PRESENCE", "PRESENT", "PRESERVE", "PREVENT", "PREVIOUS", "PRIMARY", "PRIME", "PRINCE", "PRINCIPAL", "PRINCIPLE", "PRINTED", "PRIORITY", "PRISONER", "PRIVACY", "PRIVATE", "PROBLEM", "PROCEED", "PROCESS", "PRODUCE", "PRODUCT", "PROFILE", "PROGRAM", "PROJECT", "PROMISE", "PROMOTE", "PROMPT", "PROPERLY", "PROPERTY", "PROPOSE", "PROSPECT", "PROTECT", "PROTEIN", "PROTEST", "PROVIDE", "PROVINCE", "PUBLISH", "PURPOSE", "PURSUE", "QUALIFY", "QUALITY", "QUARTER", "QUESTION", "RADICAL", "RAILWAY", "RAINBOW", "RAISING", "RANDOM", "RANKING", "RAPIDLY", "RATIONAL", "READILY", "READING", "REALITY", "REALIZE", "REALLY", "RECEIPT", "RECEIVE", "RECENT", "RECORD", "RECOVER", "REDUCED", "REFLECT", "REFORM", "REFUGEE", "REFUSAL", "REFUSE", "REGARD", "REGIME", "REGION", "REGULAR", "REJECT", "RELATED", "RELATIVE", "RELEASE", "RELEVANT", "RELIEF", "RELIGION", "RELY", "REMAIN", "REMARK", "REMOVAL", "REMOVE", "RENEWED", "REPLACE", "REPLY", "REPORT", "REQUEST", "REQUIRE", "RESCUE", "RESEARCH", "RESERVE", "RESIDENT", "RESIGN", "RESIST", "RESOLVE", "RESORT", "RESOURCE", "RESPECT", "RESPOND", "RESTORE", "RESULT", "RETAIN", "RETIRE", "RETREAT", "RETURN", "REVEAL", "REVENUE", "REVERSE", "REVIEW", "REVISED", "REWARD", "ROUTINE", "RUNNING", "SATISFY", "SCENARIO", "SCHEME", "SCHOLAR", "SCIENCE", "SCRATCH", "SCREEN", "SEARCH", "SEASON", "SECOND", "SECRET", "SECTION", "SECTOR", "SECURE", "SEGMENT", "SELECT", "SELLING", "SENIOR", "SENTENCE", "SEPARATE", "SEQUENCE", "SERIOUS", "SERVANT", "SERVICE", "SESSION", "SETTING", "SETTLE", "SEVERAL", "SHELTER", "SHORTLY", "SHOWING", "SILENCE", "SIMILAR", "SITTING", "SIXTEEN", "SKILLED", "SLAVERY", "SLEEPING", "SLIGHTLY", "SMOKING", "SOCIETY", "SOLDIER", "SOMEHOW", "SOMEONE", "SORRY", "SOUTHERN", "SPEAKER", "SPECIAL", "SPECIES", "SPECIFIC", "SPEECH", "SPONSOR", "SPREAD", "STADIUM", "STANDARD", "STANDING", "STATION", "STATUTE", "STAYING", "STORAGE", "STRANGE", "STRANGER", "STRATEGY", "STRETCH", "STRIKE", "STRIKING", "STRONGLY", "STRUCTURE", "STUDENT", "STUDIED", "SUBJECT", "SUCCESS", "SUCCEED", "SUDDEN", "SUGGEST", "SUITABLE", "SUMMARY", "SUMMIT", "SUPPORT", "SUPPOSE", "SUPREME", "SURFACE", "SURGERY", "SURPLUS", "SURPRISE", "SURROUND", "SURVIVAL", "SURVIVE", "SUSPECT", "SUSTAIN", "SYMPATHY", "SYMPTOM", "TALKING", "TEACHER", "TEACHING", "TENSION", "TERRIBLE", "TERRITORY", "TESTING", "THEATER", "THEATRE", "THEOREM", "THERAPY", "THEREBY", "THOUGHT", "THROUGH", "THROW", "TONIGHT", "TOTALLY", "TOUCHED", "TOWARDS", "TRADING", "TRAFFIC", "TRAGEDY", "TRAINING", "TRANSFER", "TRANSPORT", "TRAVEL", "TREATED", "TREATY", "TRIAL", "TRIBUTE", "TRIGGER", "TRIUMPH", "TROUBLE", "TYPICAL", "ULTIMATELY", "UNABLE", "UNIFORM", "UNKNOWN", "UNUSUAL", "UPGRADE", "UPSTAIRS", "UTILITY", "VARIETY", "VARIOUS", "VEHICLE", "VERSION", "VETERAN", "VICTORY", "VILLAGE", "VIOLENT", "VIRTUAL", "VISIBLE", "VISITOR", "VISUAL", "WAITING", "WALKING", "WANTING", "WARNING", "WARRANT", "WARRIOR", "WEALTHY", "WEARING", "WEATHER", "WEBSITE", "WEDDING", "WEEKEND", "WELCOME", "WELFARE", "WESTERN", "WHETHER", "WILLING", "WINDOW", "WINNING", "WITHOUT", "WITNESS", "WORKING", "WORRIED", "WORSHIP", "WRITING", "WRITTEN", "YOUNGER"]
        };

        // Pre-compute valid prefixes for each dictionary
        function buildPrefixSet(words) {
            const prefixes = new Set();
            for (const word of words) {
                for (let i = 1; i <= word.length; i++) {
                    prefixes.add(word.substring(0, i));
                }
            }
            return prefixes;
        }

        const prefixSets = {
            4: buildPrefixSet(wordDictionaries[4]),
            5: buildPrefixSet(wordDictionaries[5]),
            6: buildPrefixSet(wordDictionaries[6]),
            7: buildPrefixSet(wordDictionaries[7])
        };

        // Backtracking algorithm to generate crossword
        function generateCrossword(n) {
            const words = wordDictionaries[n];
            const prefixes = prefixSets[n];
            const grid = [];

            function getColumn(col) {
                let result = "";
                for (let r = 0; r < grid.length; r++) {
                    result += grid[r][col];
                }
                return result;
            }

            function isValidPlacement(word) {
                // Check if all columns formed so far are valid prefixes
                for (let col = 0; col < n; col++) {
                    const columnSoFar = getColumn(col) + word[col];
                    if (!prefixes.has(columnSoFar)) {
                        return false;
                    }
                }
                return true;
            }

            function backtrack(row) {
                if (row === n) {
                    // Check if all columns are valid complete words
                    for (let col = 0; col < n; col++) {
                        const column = getColumn(col);
                        if (!words.includes(column)) {
                            return false;
                        }
                    }
                    return true;
                }

                // Try each word from dictionary
                for (const word of words) {
                    if (isValidPlacement(word)) {
                        grid.push(word);
                        if (backtrack(row + 1)) {
                            return true;
                        }
                        grid.pop();
                    }
                }
                return false;
            }

            backtrack(0);
            return grid;
        }

        // Comprehensive word-to-clue mapping
        const clueDatabase = {
            // Common 4-letter words
            "ABLE": "Having ability", "ACID": "Sour substance", "AGED": "Old or mature", "ALSO": "In addition",
            "AREA": "Region or zone", "ARMY": "Military force", "AWAY": "Not here", "BABY": "Infant",
            "BACK": "Rear side", "BALL": "Round object", "BAND": "Musical group", "BANK": "Money institution",
            "BASE": "Foundation", "BATH": "Washing place", "BEAR": "Large mammal", "BEAT": "Rhythm or defeat",
            "BEEN": "Past participle of be", "BEER": "Alcoholic beverage", "BELL": "Ringing object", "BELT": "Waist strap",
            "BEST": "Finest quality", "BILL": "Invoice or beak", "BIRD": "Flying animal", "BLOW": "Gust of wind",
            "BLUE": "Sky color", "BOAT": "Water vessel", "BODY": "Physical form", "BOMB": "Explosive device",
            "BOND": "Connection", "BONE": "Skeleton part", "BOOK": "Reading material", "BOOM": "Loud sound",
            "BORN": "Came into life", "BOSS": "Manager", "BOTH": "Two together", "BOWL": "Dish or play",
            "BULK": "Large mass", "BURN": "Consume with fire", "BUSH": "Shrub", "BUSY": "Occupied",
            "CALL": "Phone or summon", "CALM": "Peaceful", "CAME": "Arrived", "CAMP": "Outdoor site",
            "CARD": "Playing piece", "CARE": "Concern or tend", "CASE": "Container or instance", "CASH": "Money",
            "CAST": "Throw or actors", "CELL": "Small room", "CHAT": "Informal talk", "CHEF": "Head cook",
            "CHIP": "Small piece", "CITY": "Urban area", "CLUB": "Organization", "COAL": "Black fuel",
            "COAT": "Outer garment", "CODE": "Secret system", "COLD": "Low temperature", "COME": "Approach",
            "COOK": "Prepare food", "COOL": "Slightly cold", "COPE": "Deal with", "COPY": "Duplicate",
            "CORE": "Center", "CORN": "Yellow grain", "COST": "Price", "CREW": "Team",
            "CROP": "Harvest yield", "DARK": "Without light", "DATA": "Information", "DATE": "Day or fruit",
            "DAWN": "Early morning", "DEAD": "No longer alive", "DEAL": "Agreement", "DEAN": "College head",
            "DEAR": "Beloved", "DEBT": "Money owed", "DEEP": "Far down", "DENY": "Refuse",
            "DESK": "Work table", "DIET": "Food regimen", "DISC": "Flat circle", "DISK": "Storage device",
            "DOES": "Performs", "DONE": "Finished", "DOOR": "Entry way", "DOSE": "Measured amount",
            "DOWN": "Lower direction", "DRAG": "Pull along", "DRAW": "Sketch", "DREW": "Past tense of draw",
            "DROP": "Fall", "DRUG": "Medicine", "DRUM": "Percussion instrument", "DUAL": "Two-fold",
            "DUCK": "Water bird", "DUKE": "Noble rank", "DUST": "Fine particles", "DUTY": "Obligation",
            "EACH": "Every one", "EARL": "British noble", "EARN": "Make money", "EASE": "Comfort",
            "EAST": "Sunrise direction", "EASY": "Not difficult", "EDGE": "Border", "ELSE": "Otherwise",
            "EVEN": "Level or equal", "EVER": "At any time", "EVIL": "Wicked", "EXIT": "Way out",
            "FACE": "Front of head", "FACT": "Truth", "FAIL": "Not succeed", "FAIR": "Just or festival",
            "FALL": "Autumn or drop", "FARM": "Agricultural land", "FAST": "Quick", "FATE": "Destiny",
            "FEAR": "Dread", "FEED": "Give food", "FEEL": "Sense or touch", "FEET": "Plural of foot",
            "FELL": "Dropped", "FELT": "Sensed", "FILE": "Document or tool", "FILL": "Make full",
            "FILM": "Movie", "FIND": "Discover", "FINE": "Good or penalty", "FIRE": "Flames",
            "FIRM": "Solid or company", "FISH": "Aquatic animal", "FIVE": "Number 5", "FLAT": "Level surface",
            "FLED": "Ran away", "FLEW": "Past tense of fly", "FLOW": "Move smoothly", "FOLK": "People",
            "FOOD": "Sustenance", "FOOT": "Body part", "FORD": "River crossing", "FORM": "Shape",
            "FORT": "Military structure", "FOUR": "Number 4", "FREE": "Not confined", "FROM": "Starting point",
            "FUEL": "Energy source", "FULL": "Complete", "FUND": "Money pool", "GAIN": "Acquire",
            "GAME": "Sport or play", "GATE": "Entry barrier", "GAVE": "Donated", "GEAR": "Equipment",
            "GENE": "Hereditary unit", "GIFT": "Present", "GIRL": "Young female", "GIVE": "Donate",
            "GLAD": "Happy", "GOAL": "Objective", "GOES": "Travels", "GOLD": "Precious metal",
            "GOLF": "Club sport", "GONE": "Departed", "GOOD": "Positive", "GRAY": "Grey color",
            "GREW": "Developed", "GREY": "Neutral color", "GRIP": "Hold tight", "GROW": "Increase",
            "GULF": "Large bay", "HAIR": "Head covering", "HALF": "50 percent", "HALL": "Corridor",
            "HAND": "Body part", "HANG": "Suspend", "HARD": "Solid", "HARM": "Damage",
            "HATE": "Detest", "HAVE": "Possess", "HEAD": "Top part", "HEAR": "Perceive sound",
            "HEAT": "Warmth", "HELD": "Grasped", "HELL": "Inferno", "HELP": "Assist",
            "HERE": "This place", "HERO": "Brave person", "HIGH": "Elevated", "HILL": "Small mountain",
            "HIRE": "Employ", "HOLD": "Grasp", "HOLE": "Opening", "HOME": "Residence",
            "HOPE": "Wish for", "HOST": "One who entertains", "HOUR": "60 minutes", "HUGE": "Very large",
            "HUNG": "Suspended", "HUNT": "Search for", "HURT": "Injure", "IDEA": "Thought",
            "INCH": "Unit of length", "INTO": "Toward inside", "IRON": "Metal", "ITEM": "Object",
            "JACK": "Device or card", "JANE": "Common name", "JULY": "Summer month", "JUNE": "Spring month",
            "JURY": "Trial panel", "JUST": "Fair or merely", "KEEP": "Retain", "KENT": "English county",
            "KEPT": "Retained", "KICK": "Strike with foot", "KILL": "End life", "KIND": "Type or gentle",
            "KING": "Royal ruler", "KNEE": "Leg joint", "KNEW": "Was aware", "KNOW": "Be aware",
            "LACK": "Absence of", "LADY": "Refined woman", "LAID": "Placed down", "LAKE": "Inland water",
            "LAND": "Ground or country", "LANE": "Narrow road", "LAST": "Final", "LATE": "Not on time",
            "LEAD": "Guide or metal", "LEFT": "Opposite of right", "LESS": "Not as much", "LIFE": "Existence",
            "LIFT": "Raise up", "LIKE": "Enjoy or similar", "LINE": "Mark or queue", "LINK": "Connection",
            "LIST": "Itemized record", "LIVE": "Be alive", "LOAD": "Burden", "LOAN": "Borrowed money",
            "LOCK": "Fasten", "LONG": "Extended", "LOOK": "Gaze", "LORD": "Master",
            "LOSE": "Misplace", "LOSS": "Defeat", "LOST": "Missing", "LOVE": "Deep affection",
            "LUCK": "Fortune", "MADE": "Created", "MAIL": "Postal delivery", "MAIN": "Primary",
            "MAKE": "Create", "MALE": "Man", "MALL": "Shopping center", "MANY": "Numerous",
            "MARK": "Sign or grade", "MASS": "Large amount", "MATE": "Partner", "MATH": "Numbers subject",
            "MEAL": "Food serving", "MEAN": "Average or intend", "MEAT": "Flesh food", "MEET": "Encounter",
            "MENU": "Food list", "MERE": "Only", "MILE": "Distance unit", "MILK": "Dairy drink",
            "MILL": "Grinding factory", "MIND": "Brain", "MINE": "Belonging to me", "MISS": "Fail to hit",
            "MODE": "Method", "MOOD": "Emotional state", "MOON": "Earth's satellite", "MORE": "Additional",
            "MOST": "Greatest amount", "MOVE": "Change position", "MUCH": "Great amount", "MUST": "Have to",
            "NAME": "Title", "NAVY": "Sea military", "NEAR": "Close to", "NECK": "Body part",
            "NEED": "Require", "NEWS": "Current events", "NEXT": "Following", "NICE": "Pleasant",
            "NICK": "Small cut", "NINE": "Number 9", "NONE": "Not any", "NOON": "Midday",
            "NORM": "Standard", "NOSE": "Smelling organ", "NOTE": "Written message", "OATH": "Sworn promise",
            "OBEY": "Follow orders", "ODDS": "Chances", "OKAY": "Alright", "ONCE": "One time",
            "ONLY": "Solely", "ONTO": "Upon", "OPEN": "Not closed", "ORAL": "Spoken",
            "OVER": "Above", "PACE": "Speed", "PACK": "Bundle", "PAGE": "Sheet of paper",
            "PAID": "Compensated", "PAIN": "Hurt", "PAIR": "Two together", "PALE": "Light colored",
            "PALM": "Hand part", "PARK": "Green space", "PART": "Piece", "PASS": "Go by",
            "PAST": "Previous time", "PATH": "Trail", "PEAK": "Summit", "PICK": "Choose",
            "PILE": "Stack", "PILL": "Medicine tablet", "PINE": "Evergreen tree", "PINK": "Light red",
            "PIPE": "Tube", "PLAN": "Scheme", "PLAY": "Enjoy", "PLOT": "Story or land",
            "PLUG": "Stopper", "PLUS": "Add", "POEM": "Verse", "POET": "Verse writer",
            "POLE": "Long stick", "POLL": "Vote", "POND": "Small lake", "POOL": "Water basin",
            "POOR": "Not wealthy", "POPE": "Catholic leader", "PORK": "Pig meat", "PORT": "Harbor",
            "POST": "Mail or pole", "POUR": "Flow out", "PRAY": "Religious appeal", "PREP": "Prepare",
            "PREY": "Hunted animal", "PURE": "Unmixed", "PUSH": "Shove", "RACE": "Competition",
            "RAIL": "Bar", "RAIN": "Precipitation", "RANK": "Position", "RARE": "Uncommon",
            "RATE": "Speed or cost", "READ": "Interpret text", "REAL": "Actual", "REAR": "Back part",
            "RELY": "Depend on", "RENT": "Lease", "REST": "Relax", "RICE": "Grain",
            "RICH": "Wealthy", "RIDE": "Travel on", "RING": "Circle or sound", "RISE": "Go up",
            "RISK": "Danger", "ROAD": "Street", "ROCK": "Stone", "ROLE": "Part played",
            "ROLL": "Turn over", "ROOF": "Top cover", "ROOM": "Space", "ROOT": "Plant base",
            "ROPE": "Thick cord", "ROSE": "Flower", "RULE": "Regulation", "RUSH": "Hurry",
            "RUTH": "Compassion", "SAFE": "Secure", "SAID": "Spoke", "SAKE": "Benefit",
            "SALE": "Selling event", "SALT": "Seasoning", "SAME": "Identical", "SAND": "Beach material",
            "SAVE": "Rescue", "SEAT": "Chair", "SEED": "Plant start", "SEEK": "Search",
            "SEEM": "Appear", "SEEN": "Viewed", "SELF": "One's person", "SELL": "Trade",
            "SEND": "Dispatch", "SENT": "Dispatched", "SEPT": "September", "SHIP": "Large boat",
            "SHOP": "Store", "SHOT": "Fired", "SHOW": "Display", "SHUT": "Close",
            "SICK": "Ill", "SIDE": "Edge", "SIGN": "Symbol", "SILK": "Smooth fabric",
            "SING": "Make music", "SINK": "Basin", "SITE": "Location", "SIZE": "Dimensions",
            "SKIN": "Outer layer", "SLIP": "Slide", "SLOW": "Not fast", "SNOW": "White precipitation",
            "SOFT": "Not hard", "SOIL": "Earth", "SOLD": "Traded", "SOLE": "Only one",
            "SOME": "A few", "SONG": "Musical piece", "SOON": "Shortly", "SORT": "Type",
            "SOUL": "Spirit", "SPOT": "Location", "STAR": "Celestial body", "STAY": "Remain",
            "STEP": "Foot movement", "STOP": "Halt", "SUCH": "Of that kind", "SUIT": "Outfit",
            "SURE": "Certain", "TAKE": "Grasp", "TALE": "Story", "TALK": "Speak",
            "TALL": "High", "TANK": "Container", "TAPE": "Adhesive strip", "TASK": "Job",
            "TEAM": "Group", "TEAR": "Rip or cry", "TECH": "Technology", "TELL": "Inform",
            "TEND": "Look after", "TERM": "Period or word", "TEST": "Exam", "TEXT": "Written words",
            "THAN": "Comparison word", "THAT": "Demonstrative", "THEM": "Those people", "THEN": "At that time",
            "THEY": "Those people", "THIN": "Not thick", "THIS": "Nearby thing", "THUS": "Therefore",
            "TIDE": "Ocean movement", "TIED": "Bound", "TIER": "Layer", "TILL": "Until",
            "TIME": "Duration", "TINY": "Very small", "TIRE": "Wheel covering", "TONE": "Sound quality",
            "TOOK": "Grabbed", "TOOL": "Implement", "TORN": "Ripped", "TOUR": "Journey",
            "TOWN": "Small city", "TREE": "Woody plant", "TRIP": "Journey", "TRUE": "Correct",
            "TUNE": "Melody", "TURN": "Rotate", "TWIN": "Double", "TYPE": "Kind",
            "UNIT": "Single thing", "UPON": "On top of", "USED": "Employed", "USER": "One who uses",
            "VARY": "Change", "VAST": "Huge", "VERY": "Extremely", "VICE": "Bad habit",
            "VIEW": "Sight", "VISA": "Entry permit", "VOTE": "Cast ballot", "WAGE": "Pay",
            "WAIT": "Stay", "WAKE": "Awaken", "WALK": "Move on foot", "WALL": "Barrier",
            "WANT": "Desire", "WARD": "Hospital section", "WARM": "Heated", "WARN": "Alert",
            "WASH": "Clean", "WAVE": "Ocean motion", "WAYS": "Methods", "WEAK": "Not strong",
            "WEAR": "Have on", "WEEK": "Seven days", "WELL": "Good or water source", "WENT": "Traveled",
            "WERE": "Past tense of are", "WEST": "Sunset direction", "WHAT": "Which thing", "WHEN": "At what time",
            "WHOM": "Which person", "WIDE": "Broad", "WIFE": "Married woman", "WILD": "Untamed",
            "WILL": "Future tense", "WIND": "Moving air", "WINE": "Fermented drink", "WING": "Bird's limb",
            "WIRE": "Metal strand", "WISE": "Intelligent", "WISH": "Desire", "WITH": "Accompanied by",
            "WOOD": "Tree material", "WORD": "Language unit", "WORE": "Had on", "WORK": "Labor",
            "WORN": "Used", "YARD": "Outside area", "YEAH": "Yes", "YEAR": "365 days",
            "YOUR": "Belonging to you", "ZERO": "Nothing", "ZONE": "Area"
        };

        // Add common 5, 6, and 7-letter word clues
        Object.assign(clueDatabase, {
            // 5-letter words (common ones)
            "ABOUT": "Concerning", "ABOVE": "Higher than", "ABUSE": "Mistreat", "ADMIT": "Confess",
            "AFTER": "Following", "AGAIN": "Once more", "AGENT": "Representative", "AGREE": "Concur",
            "AHEAD": "In front", "ALARM": "Warning device", "ALBUM": "Photo book", "ALERT": "Watchful",
            "ALIEN": "Extraterrestrial", "ALIKE": "Similar", "ALIVE": "Living", "ALLOW": "Permit",
            "ALONE": "Solo", "ALONG": "Beside", "ALTER": "Change", "ANGEL": "Heavenly being",
            "ANGER": "Rage", "ANGLE": "Corner", "ANGRY": "Mad", "APART": "Separated",
            "APPLE": "Red fruit", "APPLY": "Submit", "ARENA": "Stadium", "ARGUE": "Debate",
            "ARISE": "Get up", "ARRAY": "Collection", "ARROW": "Pointed projectile", "ASIDE": "To the side",
            "ASSET": "Resource", "AUDIO": "Sound", "AVOID": "Evade", "AWARD": "Prize",
            "AWARE": "Conscious", "BADLY": "Poorly", "BAKER": "Bread maker", "BASIC": "Fundamental",
            "BEACH": "Sandy shore", "BEGAN": "Started", "BEGIN": "Start", "BEING": "Existing",
            "BELOW": "Underneath", "BENCH": "Seat", "BIRTH": "Beginning of life", "BLACK": "Dark color",
            "BLADE": "Knife edge", "BLAME": "Fault", "BLANK": "Empty", "BLIND": "Cannot see",
            "BLOCK": "Obstruct", "BLOOD": "Red fluid", "BOARD": "Plank", "BOOST": "Increase",
            "BOUND": "Tied", "BRAIN": "Thinking organ", "BRAND": "Label", "BREAD": "Baked food",
            "BREAK": "Shatter", "BRIEF": "Short", "BRING": "Carry to", "BROAD": "Wide",
            "BROKE": "Penniless", "BROWN": "Earth tone", "BUILD": "Construct", "BUILT": "Constructed",
            "CABLE": "Wire", "CARRY": "Transport", "CATCH": "Grab", "CAUSE": "Reason",
            "CHAIN": "Linked metal", "CHAIR": "Seat", "CHAOS": "Disorder", "CHARM": "Appeal",
            "CHART": "Graph", "CHASE": "Pursue", "CHEAP": "Inexpensive", "CHECK": "Verify",
            "CHEST": "Torso", "CHIEF": "Leader", "CHILD": "Young person", "CHINA": "Asian country",
            "CIVIL": "Polite", "CLAIM": "Assert", "CLASS": "Category", "CLEAN": "Not dirty",
            "CLEAR": "Transparent", "CLIMB": "Ascend", "CLOCK": "Time device", "CLOSE": "Near",
            "COACH": "Trainer", "COAST": "Shore", "COULD": "Was able", "COUNT": "Number",
            "COURT": "Legal venue", "COVER": "Conceal", "CRAFT": "Skill", "CRASH": "Collision",
            "CRAZY": "Insane", "CREAM": "Dairy product", "CRIME": "Illegal act", "CROSS": "Intersect",
            "CROWD": "Large group", "CROWN": "Royal headpiece", "CURVE": "Bend", "CYCLE": "Repeat",
            "DAILY": "Every day", "DANCE": "Move to music", "DEATH": "End of life", "DELAY": "Postpone",
            "DEPTH": "How deep", "DOING": "Performing", "DOUBT": "Uncertainty", "DOZEN": "Twelve",
            "DRAFT": "Preliminary version", "DRAMA": "Theater", "DREAM": "Sleep vision", "DRESS": "Garment",
            "DRINK": "Beverage", "DRIVE": "Operate vehicle", "EAGER": "Enthusiastic", "EARLY": "Before time",
            "EARTH": "Our planet", "EIGHT": "Number 8", "EMPTY": "Nothing inside", "ENEMY": "Foe",
            "ENJOY": "Take pleasure", "ENTER": "Go in", "ENTRY": "Way in", "EQUAL": "Same",
            "ERROR": "Mistake", "EVENT": "Happening", "EVERY": "Each one", "EXACT": "Precise",
            "EXTRA": "Additional", "FAITH": "Belief", "FALSE": "Not true", "FAULT": "Defect",
            "FIELD": "Open land", "FIFTH": "Number 5", "FIFTY": "Number 50", "FIGHT": "Combat",
            "FINAL": "Last", "FIRST": "Number 1", "FIXED": "Repaired", "FLASH": "Brief light",
            "FLOOR": "Ground level", "FOCUS": "Concentrate", "FORCE": "Power", "FORTH": "Forward",
            "FORTY": "Number 40", "FOUND": "Discovered", "FRAME": "Border", "FRANK": "Honest",
            "FRESH": "New", "FRONT": "Forward part", "FRUIT": "Plant product", "FULLY": "Completely",
            "FUNNY": "Humorous", "GIANT": "Huge being", "GIVEN": "Provided", "GLASS": "Transparent material",
            "GRACE": "Elegance", "GRADE": "Level", "GRAND": "Magnificent", "GRANT": "Give",
            "GRASS": "Lawn plant", "GREAT": "Excellent", "GREEN": "Grass color", "GROUP": "Collection",
            "GUARD": "Protect", "GUESS": "Estimate", "GUEST": "Visitor", "GUIDE": "Lead",
            "HAPPY": "Joyful", "HEART": "Organ", "HEAVY": "Weighty", "HORSE": "Animal",
            "HOTEL": "Lodging", "HOUSE": "Home", "HUMAN": "Person", "IDEAL": "Perfect",
            "IMAGE": "Picture", "INDEX": "List", "INNER": "Inside", "INPUT": "Data entry",
            "ISSUE": "Problem", "JOINT": "Connection", "JUDGE": "Decide", "KNOWN": "Familiar",
            "LABEL": "Tag", "LARGE": "Big", "LASER": "Light beam", "LATER": "After",
            "LAUGH": "Chuckle", "LAYER": "Level", "LEARN": "Study", "LEAST": "Smallest",
            "LEAVE": "Depart", "LEGAL": "Lawful", "LEVEL": "Flat", "LIGHT": "Illumination",
            "LIMIT": "Boundary", "LOCAL": "Nearby", "LOGIC": "Reasoning", "LOOSE": "Not tight",
            "LOWER": "Less high", "LUCKY": "Fortunate", "LUNCH": "Midday meal", "MAGIC": "Supernatural",
            "MAJOR": "Important", "MARCH": "Month", "MATCH": "Pair", "MAYBE": "Perhaps",
            "MAYOR": "City leader", "MEANT": "Intended", "MEDIA": "Communication", "METAL": "Element",
            "MIGHT": "Power", "MINOR": "Lesser", "MIXED": "Combined", "MODEL": "Example",
            "MONEY": "Currency", "MONTH": "Time period", "MORAL": "Ethical", "MOTOR": "Engine",
            "MOUNT": "Climb", "MOUSE": "Small rodent", "MOUTH": "Oral opening", "MOVIE": "Film",
            "MUSIC": "Sound art", "NEVER": "Not ever", "NIGHT": "After dark", "NOBLE": "Aristocratic",
            "NOISE": "Sound", "NORTH": "Direction", "NOVEL": "Book", "NURSE": "Medical worker",
            "OCCUR": "Happen", "OCEAN": "Large sea", "OFFER": "Propose", "OFTEN": "Frequently",
            "ORDER": "Arrangement", "OTHER": "Different", "OUGHT": "Should", "PAINT": "Color",
            "PANEL": "Flat board", "PANIC": "Fear", "PAPER": "Writing material", "PARTY": "Gathering",
            "PEACE": "Calm", "PHASE": "Stage", "PHONE": "Telephone", "PHOTO": "Picture",
            "PIANO": "Musical instrument", "PIECE": "Part", "PILOT": "Plane driver", "PITCH": "Throw",
            "PLACE": "Location", "PLAIN": "Simple", "PLANE": "Aircraft", "PLANT": "Flora",
            "PLATE": "Dish", "POINT": "Tip", "POUND": "Weight unit", "POWER": "Energy",
            "PRESS": "Push", "PRICE": "Cost", "PRIDE": "Self-respect", "PRIME": "Main",
            "PRINT": "Publish", "PRIOR": "Before", "PRIZE": "Award", "PROOF": "Evidence",
            "PROUD": "Satisfied", "PROVE": "Demonstrate", "QUEEN": "Female ruler", "QUICK": "Fast",
            "QUIET": "Silent", "QUITE": "Rather", "RADIO": "Receiver", "RAISE": "Lift",
            "RANGE": "Extent", "RAPID": "Swift", "RATIO": "Proportion", "REACH": "Attain",
            "READY": "Prepared", "RIGHT": "Correct", "RIVER": "Waterway", "ROMAN": "From Rome",
            "ROUGH": "Coarse", "ROUND": "Circular", "ROUTE": "Path", "ROYAL": "Kingly",
            "RURAL": "Countryside", "SCALE": "Size", "SCENE": "Setting", "SCOPE": "Range",
            "SCORE": "Points", "SENSE": "Feeling", "SERVE": "Assist", "SEVEN": "Number 7",
            "SHALL": "Will", "SHAPE": "Form", "SHARE": "Divide", "SHARP": "Keen",
            "SHEET": "Paper", "SHELF": "Storage", "SHELL": "Outer covering", "SHIFT": "Change",
            "SHINE": "Glow", "SHIRT": "Garment", "SHOCK": "Surprise", "SHOOT": "Fire",
            "SHORT": "Not long", "SHOWN": "Displayed", "SIGHT": "Vision", "SINCE": "Because",
            "SIXTH": "Number 6", "SKILL": "Ability", "SLEEP": "Rest", "SLIDE": "Glide",
            "SMALL": "Little", "SMART": "Clever", "SMILE": "Grin", "SMOKE": "Fumes",
            "SOLID": "Firm", "SOLVE": "Find answer", "SORRY": "Regretful", "SOUND": "Noise",
            "SOUTH": "Direction", "SPACE": "Area", "SPARE": "Extra", "SPEAK": "Talk",
            "SPEED": "Velocity", "SPEND": "Use money", "SPLIT": "Divide", "SPOKE": "Said",
            "SPORT": "Game", "STAFF": "Employees", "STAGE": "Platform", "STAKE": "Wager",
            "STAND": "Rise", "START": "Begin", "STATE": "Condition", "STEAM": "Water vapor",
            "STEEL": "Strong metal", "STEEP": "Sharp incline", "STICK": "Rod", "STILL": "Motionless",
            "STOCK": "Supply", "STONE": "Rock", "STOOD": "Remained upright", "STORE": "Shop",
            "STORM": "Bad weather", "STORY": "Tale", "STRIP": "Narrow piece", "STUCK": "Lodged",
            "STUDY": "Learn", "STUFF": "Things", "STYLE": "Fashion", "SUGAR": "Sweetener",
            "SUITE": "Room set", "SUPER": "Great", "SWEET": "Sugary", "TABLE": "Furniture",
            "TAKEN": "Grabbed", "TASTE": "Flavor", "TEACH": "Instruct", "TEXAS": "US state",
            "THANK": "Express gratitude", "THEIR": "Belonging to them", "THEME": "Topic", "THERE": "That place",
            "THESE": "Those things", "THICK": "Dense", "THING": "Object", "THINK": "Ponder",
            "THIRD": "Number 3", "THREE": "Number 3", "THREW": "Tossed", "THROW": "Toss",
            "TIGHT": "Snug", "TIMES": "Occasions", "TITLE": "Name", "TODAY": "This day",
            "TOPIC": "Subject", "TOTAL": "Complete sum", "TOUCH": "Feel", "TOUGH": "Hard",
            "TOWER": "Tall structure", "TRACK": "Path", "TRADE": "Exchange", "TRAIL": "Path",
            "TRAIN": "Railway vehicle", "TREAT": "Gift", "TREND": "Pattern", "TRIAL": "Test",
            "TRICK": "Deception", "TRUCK": "Vehicle", "TRULY": "Really", "TRUST": "Believe",
            "TRUTH": "Fact", "TWICE": "Two times", "UNDER": "Below", "UNION": "United group",
            "UNITY": "Oneness", "UNTIL": "Up to", "UPPER": "Higher", "UPSET": "Disturbed",
            "URBAN": "City", "USUAL": "Normal", "VALID": "Acceptable", "VALUE": "Worth",
            "VIDEO": "Moving pictures", "VIRUS": "Infection", "VISIT": "Call on", "VITAL": "Essential",
            "VOICE": "Speech sound", "WASTE": "Discard", "WATCH": "Timepiece", "WATER": "H2O",
            "WHEEL": "Round object", "WHERE": "What place", "WHICH": "What one", "WHILE": "During",
            "WHITE": "Color", "WHOLE": "Complete", "WOMAN": "Female adult", "WORLD": "Earth",
            "WORRY": "Anxiety", "WORSE": "More bad", "WORST": "Most bad", "WORTH": "Value",
            "WOULD": "Conditional", "WOUND": "Injury", "WRITE": "Put on paper", "WRONG": "Incorrect",
            "YOUNG": "Youthful", "YOUTH": "Young person",
            // Add some 6 and 7 letter words
            "ACCEPT": "Receive", "ACCESS": "Entry", "ACTION": "Deed", "ACTUAL": "Real",
            "ADVICE": "Guidance", "AFRAID": "Scared", "AGENCY": "Organization", "ALMOST": "Nearly",
            "ALWAYS": "Forever", "AMOUNT": "Quantity", "ANIMAL": "Living creature", "ANSWER": "Response",
            "APPEAR": "Come into view", "ARTIST": "Creator", "ATTACK": "Assault", "AUGUST": "Month",
            "BATTLE": "Fight", "BEAUTY": "Attractiveness", "BECAME": "Turned into", "BEFORE": "Earlier",
            "BEHALF": "Representing", "BEHIND": "At the back", "BELIEF": "Faith", "BETTER": "Superior",
            "BEYOND": "Further", "BORDER": "Edge", "BOTTLE": "Container", "BRANCH": "Tree limb",
            "BRIGHT": "Shining", "BRIDGE": "Span", "BROKEN": "Damaged", "BUDGET": "Financial plan",
            "BUTTON": "Fastener", "CAMERA": "Photo device", "CANCEL": "Call off", "CANNOT": "Unable to",
            "CARBON": "Element", "CAREER": "Profession", "CASTLE": "Fortress", "CAUGHT": "Captured",
            "CENTER": "Middle", "CENTRE": "Middle", "CHANCE": "Opportunity", "CHANGE": "Alter",
            "CHARGE": "Fee", "CHOICE": "Option", "CHOOSE": "Select", "CHURCH": "Religious building",
            "CIRCLE": "Round shape", "CLIENT": "Customer", "CLOSED": "Shut", "COFFEE": "Beverage",
            "COLUMN": "Pillar", "COMMON": "Usual", "CORNER": "Edge intersection", "COUPLE": "Pair",
            "COURSE": "Path", "CREATE": "Make", "CREDIT": "Trust", "CRISIS": "Emergency",
            "DAMAGE": "Harm", "DANGER": "Risk", "DEBATE": "Discussion", "DECADE": "Ten years",
            "DECIDE": "Choose", "DEFEAT": "Beat", "DEFEND": "Protect", "DEFINE": "Explain",
            "DEGREE": "Level", "DEMAND": "Request", "DEPEND": "Rely on", "DESIGN": "Plan",
            "DESIRE": "Want", "DETAIL": "Specific item", "DETECT": "Discover", "DEVICE": "Gadget",
            "DIFFER": "Vary", "DINNER": "Evening meal", "DIRECT": "Straight", "DOCTOR": "Physician",
            "DOLLAR": "Currency", "DOUBLE": "Twice", "DRIVEN": "Motivated", "DRIVER": "Operator",
            "DURING": "Throughout", "EASILY": "Without difficulty", "EDITOR": "Publisher", "EFFECT": "Result",
            "EFFORT": "Attempt", "EIGHTH": "8th", "EITHER": "One or other", "ENABLE": "Allow",
            "ENERGY": "Power", "ENGAGE": "Involve", "ENGINE": "Motor", "ENOUGH": "Sufficient",
            "ENSURE": "Make certain", "ENTIRE": "Whole", "EQUITY": "Fairness", "ESCAPE": "Get away",
            "ESTATE": "Property", "ETHNIC": "Cultural", "EUROPE": "Continent", "EXCESS": "Too much",
            "EXPAND": "Grow", "EXPECT": "Anticipate", "EXPERT": "Specialist", "EXTEND": "Lengthen",
            "EXTENT": "Range", "FABRIC": "Cloth", "FACTOR": "Element", "FAILED": "Unsuccessful",
            "FAIRLY": "Justly", "FAMILY": "Relatives", "FAMOUS": "Well-known", "FATHER": "Male parent",
            "FELLOW": "Guy", "FEMALE": "Woman", "FIGURE": "Shape", "FINGER": "Hand part",
            "FINISH": "Complete", "FLIGHT": "Flying", "FOLLOW": "Come after", "FORCED": "Compelled",
            "FOREST": "Woods", "FORGET": "Not remember", "FORMAL": "Official", "FORMAT": "Structure",
            "FORMER": "Previous", "FOUGHT": "Battled", "FOURTH": "4th", "FRENCH": "From France",
            "FRIEND": "Pal", "FUTURE": "Time ahead", "GARDEN": "Plant area", "GATHER": "Collect",
            "GENDER": "Male or female", "GERMAN": "From Germany", "GLOBAL": "Worldwide", "GOLDEN": "Gold colored",
            "GROUND": "Earth", "GROWTH": "Development", "HAPPEN": "Occur", "HARDLY": "Barely",
            "HEALTH": "Wellness", "HEAVEN": "Paradise", "HEIGHT": "How tall", "HIDDEN": "Concealed",
            "HIGHLY": "Very", "HONEST": "Truthful", "IMPACT": "Effect", "IMPORT": "Bring in",
            "INCOME": "Earnings", "INDEED": "Truly", "INJURY": "Wound", "INSIDE": "Within",
            "INTEND": "Plan to", "INTENT": "Purpose", "INVEST": "Put money in", "ISLAND": "Land in water",
            "ITSELF": "The thing", "JUNIOR": "Younger", "LABOUR": "Work", "LATEST": "Most recent",
            "LATTER": "Second of two", "LAUNCH": "Start", "LAWYER": "Attorney", "LEADER": "Chief",
            "LEAGUE": "Association", "LENGTH": "How long", "LESSON": "Teaching", "LETTER": "Written message",
            "LIKELY": "Probable", "LINKED": "Connected", "LIQUID": "Fluid", "LISTEN": "Hear",
            "LITTLE": "Small", "LIVING": "Alive", "LOVELY": "Beautiful", "MAINLY": "Mostly",
            "MANAGE": "Control", "MANNER": "Way", "MANUAL": "Handbook", "MARGIN": "Edge",
            "MARINE": "Nautical", "MARKET": "Shopping place", "MASTER": "Expert", "MATTER": "Issue",
            "MEDIUM": "Average", "MEMBER": "Part of group", "MEMORY": "Recall", "MENTAL": "Of mind",
            "MERELY": "Only", "METHOD": "Way", "MIDDLE": "Center", "MINUTE": "60 seconds",
            "MIRROR": "Reflection", "MOBILE": "Movable", "MODERN": "Current", "MODEST": "Humble",
            "MODIFY": "Change", "MOMENT": "Instant", "MOSTLY": "Mainly", "MOTHER": "Female parent",
            "MOTION": "Movement", "MOVING": "Changing position", "MURDER": "Kill", "MUSEUM": "Exhibition hall",
            "MYSELF": "Me", "NARROW": "Thin", "NATION": "Country", "NATIVE": "Indigenous",
            "NATURE": "Natural world", "NEARBY": "Close", "NEARLY": "Almost", "NEEDLE": "Sewing tool",
            "NOTICE": "See", "NOTION": "Idea", "NUMBER": "Numeral", "OBJECT": "Thing",
            "OBTAIN": "Get", "OFFICE": "Workplace", "ONLINE": "On internet", "OPTION": "Choice",
            "ORANGE": "Citrus fruit", "ORIGIN": "Beginning", "OUTPUT": "Result", "PACKED": "Full",
            "PALACE": "Royal building", "PARENT": "Father or mother", "PARTLY": "Somewhat", "PASSED": "Went by",
            "PERIOD": "Time span", "PERMIT": "Allow", "PERSON": "Human", "PHRASE": "Expression",
            "PICKED": "Chosen", "PLANET": "Celestial body", "PLAYER": "Participant", "PLEASE": "Be kind",
            "PLENTY": "Abundance", "POCKET": "Small bag", "POLICE": "Law enforcement", "POLICY": "Rule",
            "PREFER": "Like better", "PRETTY": "Attractive", "PRIEST": "Religious leader", "PRINCE": "Royal son",
            "PRISON": "Jail", "PROFIT": "Gain", "PROPER": "Correct", "PUBLIC": "People",
            "RAISED": "Lifted", "RANDOM": "Chance", "RARELY": "Seldom", "RATHER": "Preferably",
            "RATING": "Score", "READER": "One who reads", "REALLY": "Truly", "REASON": "Cause",
            "RECALL": "Remember", "RECENT": "Latest", "RECORD": "Document", "REDUCE": "Decrease",
            "REFORM": "Improve", "REFUSE": "Decline", "REGARD": "Consider", "REGION": "Area",
            "RELATE": "Connect", "RELIEF": "Ease", "REMAIN": "Stay", "REMARK": "Comment",
            "REMOTE": "Distant", "REMOVE": "Take away", "REPAIR": "Fix", "REPEAT": "Say again",
            "REPORT": "Account", "RESORT": "Vacation spot", "RESULT": "Outcome", "RETAIN": "Keep",
            "RETURN": "Come back", "REVEAL": "Show", "REVIEW": "Examine", "REWARD": "Prize",
            "RISING": "Going up", "SAFETY": "Security", "SALARY": "Pay", "SAMPLE": "Example",
            "SCHEME": "Plan", "SCHOOL": "Learning place", "SCREEN": "Display", "SEARCH": "Look for",
            "SEASON": "Time period", "SECOND": "2nd", "SECRET": "Hidden", "SECTOR": "Area",
            "SECURE": "Safe", "SELECT": "Choose", "SENIOR": "Older", "SERIES": "Sequence",
            "SERVED": "Helped", "SETTLE": "Resolve", "SEVERE": "Serious", "SEXUAL": "Physical attraction",
            "SHOULD": "Ought to", "SIGNAL": "Sign", "SIGNED": "Put name on", "SILENT": "Quiet",
            "SILVER": "Precious metal", "SIMPLE": "Easy", "SIMPLY": "Just", "SINGLE": "One",
            "SISTER": "Female sibling", "SLIGHT": "Small", "SMOOTH": "Even", "SOCIAL": "Community",
            "SOLELY": "Only", "SOURCE": "Origin", "SPEECH": "Talk", "SPIRIT": "Soul",
            "SPOKEN": "Said", "SPREAD": "Distribute", "SPRING": "Season", "SQUARE": "Four-sided shape",
            "STABLE": "Steady", "STATUS": "State", "STEADY": "Stable", "STOLEN": "Taken illegally",
            "STRAIN": "Stress", "STREAM": "Brook", "STREET": "Road", "STRESS": "Pressure",
            "STRICT": "Severe", "STRIKE": "Hit", "STRING": "Cord", "STRONG": "Powerful",
            "STRUCK": "Hit", "STUDIO": "Workshop", "SUBMIT": "Present", "SUDDEN": "Abrupt",
            "SUFFER": "Endure pain", "SUMMER": "Warm season", "SUMMIT": "Peak", "SUPPLY": "Provide",
            "SURELY": "Certainly", "SURVEY": "Study", "SWITCH": "Change", "SYMBOL": "Sign",
            "SYSTEM": "Organization", "TAKING": "Grabbing", "TALENT": "Skill", "TARGET": "Goal",
            "TAUGHT": "Educated", "TEMPLE": "Religious building", "THANKS": "Gratitude", "THEORY": "Idea",
            "THIRTY": "30", "THOUGH": "Although", "THREAT": "Danger", "THROWN": "Tossed",
            "TICKET": "Pass", "TOWARD": "In direction of", "TRAVEL": "Journey", "TREATY": "Agreement",
            "TRYING": "Attempting", "TUNNEL": "Underground passage", "TURNED": "Rotated", "TWELVE": "12",
            "TWENTY": "20", "UNABLE": "Cannot", "UNIQUE": "One of a kind", "UNITED": "Joined",
            "UNLIKE": "Different from", "USEFUL": "Helpful", "VALLEY": "Low area", "VENDOR": "Seller",
            "VERSUS": "Against", "VESSEL": "Ship", "VICTIM": "Sufferer", "VISION": "Sight",
            "VISUAL": "Visible", "VOLUME": "Amount", "WEALTH": "Riches", "WEAPON": "Arm",
            "WEEKLY": "Every week", "WEIGHT": "Heaviness", "WHOLLY": "Completely", "WINDOW": "Glass opening",
            "WINNER": "Victor", "WINTER": "Cold season", "WITHIN": "Inside", "WONDER": "Marvel",
            "WORKER": "Employee", "WORTHY": "Deserving", "WRITER": "Author", "YELLOW": "Bright color",
            // 7-letter words
            "ABILITY": "Skill", "ABSENCE": "Not present", "ACADEMY": "School", "ACCOUNT": "Record",
            "ACHIEVE": "Accomplish", "ACQUIRE": "Obtain", "ADDRESS": "Location", "ADVANCE": "Move forward",
            "AGAINST": "Opposed to", "ALREADY": "By now", "ANALYST": "Examiner", "ANCIENT": "Very old",
            "ANOTHER": "Different one", "ANXIETY": "Worry", "APPLIED": "Used", "APPOINT": "Assign",
            "APPROVE": "Accept", "ARRANGE": "Organize", "ARRIVAL": "Coming", "ARTICLE": "Object",
            "ASSAULT": "Attack", "ASSUMED": "Supposed", "ATTEMPT": "Try", "ATTRACT": "Draw in",
            "AVERAGE": "Typical", "BACKING": "Support", "BALANCE": "Equilibrium", "BANKING": "Finance",
            "BARRIER": "Obstacle", "BATTERY": "Power cell", "BEARING": "Relevance", "BEATING": "Hitting",
            "BECAUSE": "Since", "BEDROOM": "Sleeping room", "BELIEVE": "Have faith", "BENEATH": "Under",
            "BENEFIT": "Advantage", "BESIDES": "Also", "BETWEEN": "In middle", "BILLION": "1000 million",
            "BINDING": "Tying", "BROTHER": "Male sibling", "BROUGHT": "Carried here", "BURNING": "On fire",
            "CABINET": "Storage", "CALLING": "Vocation", "CAPABLE": "Able", "CAPITAL": "Main city",
            "CAPTAIN": "Leader", "CAPTURE": "Catch", "CAREFUL": "Cautious", "CARRIER": "Transporter",
            "CENTRAL": "In middle", "CENTURY": "100 years", "CERTAIN": "Sure", "CHAMBER": "Room",
            "CHANNEL": "Path", "CHAPTER": "Section", "CHARITY": "Giving", "CHARTER": "Document",
            "CHICKEN": "Poultry", "CIRCUIT": "Loop", "CITIZEN": "Resident", "CLASSIC": "Traditional",
            "CLIMATE": "Weather pattern", "CLOSING": "Ending", "CLOSURE": "Ending", "CLOTHES": "Garments",
            "COLLECT": "Gather", "COLLEGE": "School", "COMBINE": "Merge", "COMFORT": "Ease",
            "COMMAND": "Order", "COMMENT": "Remark", "COMMON": "Usual", "COMPANY": "Business",
            "COMPARE": "Contrast", "COMPETE": "Vie", "COMPLEX": "Complicated", "CONCEPT": "Idea",
            "CONCERN": "Worry", "CONCERT": "Performance", "CONDUCT": "Behavior", "CONFIRM": "Verify",
            "CONNECT": "Link", "CONSENT": "Agreement", "CONSIST": "Be made of", "CONTACT": "Touch",
            "CONTAIN": "Hold", "CONTENT": "Satisfied", "CONTEST": "Competition", "CONTEXT": "Setting",
            "CONTROL": "Manage", "CONVERT": "Change", "CORRECT": "Right", "COUNCIL": "Assembly",
            "COUNSEL": "Advice", "COUNTER": "Opposite", "COUNTRY": "Nation", "COURAGE": "Bravery",
            "CRICKET": "Sport", "CRUCIAL": "Important", "CRYSTAL": "Clear mineral", "CULTURE": "Society",
            "CURRENT": "Present", "CUTTING": "Slicing", "DEALING": "Trading", "DECLINE": "Decrease",
            "DEFAULT": "Standard", "DEFENCE": "Protection", "DEFICIT": "Shortage", "DELIVER": "Bring",
            "DENSITY": "Thickness", "DEPOSIT": "Put down", "DESKTOP": "Computer surface", "DESPITE": "Although",
            "DESTROY": "Ruin", "DEVELOP": "Grow", "DIGITAL": "Electronic", "DISEASE": "Illness",
            "DISPLAY": "Show", "DISPUTE": "Argument", "DISTANT": "Far", "DIVORCE": "Split",
            "DRAWING": "Sketch", "DRESSED": "Clothed", "DRIVING": "Operating vehicle", "EASTERN": "From east",
            "ECONOMY": "Financial system", "EDITION": "Version", "ELDERLY": "Old people", "ELEMENT": "Component",
            "EMBRACE": "Hug", "EMERGED": "Appeared", "EMOTION": "Feeling", "EMPEROR": "Ruler",
            "ENGAGED": "Involved", "ENHANCE": "Improve", "EPISODE": "Event", "EQUALLY": "The same",
            "EVENING": "Night start", "EVIDENT": "Clear", "EXACTLY": "Precisely", "EXAMINE": "Inspect",
            "EXAMPLE": "Instance", "EXCITED": "Thrilled", "EXCLUDE": "Leave out", "EXHIBIT": "Display",
            "EXPENSE": "Cost", "EXPLAIN": "Clarify", "EXPLODE": "Burst", "EXPLOIT": "Use",
            "EXPLORE": "Discover", "EXPOSED": "Revealed", "EXPRESS": "State", "EXTREME": "Intense",
            "FACTORY": "Manufacturing plant", "FACULTY": "Teaching staff", "FAILING": "Unsuccessful", "FAILURE": "Defeat",
            "FALLING": "Dropping", "FASHION": "Style", "FEATURE": "Characteristic", "FEDERAL": "National",
            "FEELING": "Emotion", "FICTION": "Made-up story", "FIFTEEN": "15", "FIGHTER": "Warrior",
            "FINANCE": "Money matters", "FINDING": "Discovery", "FITNESS": "Health", "FOREIGN": "From abroad",
            "FOREVER": "Always", "FORMULA": "Recipe", "FORTUNE": "Wealth", "FORWARD": "Ahead",
            "FOUNDER": "Creator", "FREEDOM": "Liberty", "FREIGHT": "Cargo", "GALLERY": "Art space",
            "GENERAL": "Common", "GENETIC": "Hereditary", "GENUINE": "Real", "GESTURE": "Motion",
            "GLIMPSE": "Quick look", "GRAMMAR": "Language rules", "GRAPHIC": "Visual", "GREATER": "More",
            "GREATLY": "Very much", "HANGING": "Suspended", "HEADING": "Title", "HEALTHY": "Well",
            "HEARING": "Listening", "HEAVILY": "With weight", "HELPFUL": "Useful", "HERSELF": "She",
            "HIGHWAY": "Road", "HIMSELF": "He", "HISTORY": "Past events", "HOLDING": "Gripping",
            "HOLIDAY": "Vacation", "HOPEFUL": "Optimistic", "HORIZON": "Skyline", "HOUSING": "Shelter",
            "HOWEVER": "But", "HUNDRED": "100", "HUSBAND": "Male spouse", "ILLEGAL": "Against law",
            "ILLNESS": "Sickness", "IMAGINE": "Picture mentally", "IMPROVE": "Better", "INCLUDE": "Contain",
            "INITIAL": "First", "INQUIRY": "Question", "INSIGHT": "Understanding", "INSPIRE": "Motivate",
            "INSTALL": "Set up", "INSTANT": "Moment", "INSTEAD": "Rather", "INTENSE": "Strong",
            "INTERIM": "Meanwhile", "INVOLVE": "Include", "ISLAMIC": "Muslim", "JANUARY": "Month",
            "JOINTLY": "Together", "JOURNAL": "Diary", "JOURNEY": "Trip", "JUSTICE": "Fairness",
            "JUSTIFY": "Explain", "KEEPING": "Retaining", "KITCHEN": "Cooking room", "KINGDOM": "Realm",
            "LANDING": "Arriving", "LARGELY": "Mostly", "LASTING": "Enduring", "LEADING": "Guiding",
            "LEARNED": "Educated", "LEATHER": "Treated hide", "LEAVING": "Departing", "LECTURE": "Talk",
            "LEISURE": "Free time", "LIBERAL": "Progressive", "LIBERTY": "Freedom", "LIBRARY": "Book collection",
            "LICENSE": "Permit", "LIMITED": "Restricted", "LISTING": "List", "LOCATED": "Situated",
            "LOGICAL": "Rational", "LOOKING": "Searching", "MACHINE": "Device", "MANAGER": "Boss",
            "MARRIED": "Wed", "MASSIVE": "Huge", "MASTER": "Expert", "MAXIMUM": "Most",
            "MEANING": "Sense", "MEASURE": "Quantify", "MEDICAL": "Health-related", "MEETING": "Gathering",
            "MENTION": "Say", "MESSAGE": "Communication", "MILLION": "1000 thousand", "MINERAL": "Earth substance",
            "MINIMAL": "Least", "MINIMUM": "Smallest", "MISSING": "Lost", "MISSION": "Task",
            "MISTAKE": "Error", "MIXTURE": "Blend", "MODERN": "Current", "MONARCH": "King or queen",
            "MONITOR": "Watch", "MORNING": "Early day", "MUSICAL": "Melodic", "MYSTERY": "Puzzle",
            "NATURAL": "Of nature", "NEAREST": "Closest", "NEITHER": "Not either", "NETWORK": "System",
            "NEUTRAL": "Impartial", "NOBODY": "No one", "NOTHING": "Zero", "NUCLEAR": "Atomic",
            "OBVIOUS": "Clear", "OCTOBER": "Month", "OFFENCE": "Crime", "OFFENSE": "Wrongdoing",
            "OFFICER": "Official", "ONGOING": "Continuing", "OPENING": "Start", "OPERATE": "Run",
            "OPINION": "View", "OUTCOME": "Result", "OUTDOOR": "Outside", "OUTLINE": "Summary",
            "OUTSIDE": "Exterior", "OVERALL": "Total", "PACKAGE": "Parcel", "PAINTED": "Colored",
            "PARKING": "Vehicle storage", "PARTIAL": "Incomplete", "PARTNER": "Associate", "PASSAGE": "Path",
            "PASSING": "Going by", "PASSION": "Strong feeling", "PASSIVE": "Inactive", "PATIENT": "Sick person",
            "PATTERN": "Design", "PAYMENT": "Compensation", "PENALTY": "Punishment", "PENSION": "Retirement pay",
            "PERCENT": "Per hundred", "PERFECT": "Flawless", "PERFORM": "Execute", "PERHAPS": "Maybe",
            "PERSIST": "Continue", "PICTURE": "Image", "PLANNED": "Organized", "PLASTIC": "Synthetic",
            "PLEASED": "Happy", "PLEASURE": "Delight", "POINTED": "Sharp", "POPULAR": "Well-liked",
            "POSSESS": "Own", "POVERTY": "Poor state", "POWERFUL": "Strong", "PRACTICE": "Rehearse",
            "PRECISE": "Exact", "PREDICT": "Forecast", "PREMIER": "First", "PREMIUM": "Extra cost",
            "PREPARE": "Get ready", "PRESENT": "Now or gift", "PREVENT": "Stop", "PREVIOUS": "Earlier",
            "PRIMARY": "Main", "PRINCE": "Royal son", "PRINTED": "Published", "PRIVACY": "Secrecy",
            "PRIVATE": "Personal", "PROBLEM": "Issue", "PROCEED": "Continue", "PROCESS": "Procedure",
            "PRODUCE": "Make", "PRODUCT": "Item", "PROFILE": "Description", "PROGRAM": "Show or plan",
            "PROJECT": "Task", "PROMISE": "Vow", "PROMOTE": "Advance", "PROTECT": "Guard",
            "PROTEIN": "Nutrient", "PROTEST": "Object", "PROVIDE": "Supply", "PUBLISH": "Print",
            "PURPOSE": "Goal", "QUALIFY": "Meet standard", "QUALITY": "Grade", "QUARTER": "25 cents",
            "RADICAL": "Extreme", "RAILWAY": "Train track", "RAINBOW": "Colored arc", "RAISING": "Lifting",
            "RANKING": "Order", "RAPIDLY": "Quickly", "READILY": "Easily", "READING": "Perusing",
            "REALITY": "Truth", "REALIZE": "Understand", "RECEIPT": "Proof of purchase", "RECEIVE": "Get",
            "RECOVER": "Get better", "REDUCED": "Lessened", "REFLECT": "Mirror", "REFUGEE": "Displaced person",
            "REFUSAL": "No", "REGULAR": "Normal", "RELATED": "Connected", "RELEASE": "Free",
            "RELEVANT": "Pertinent", "RELIEF": "Ease", "REMAIN": "Stay", "REMOVAL": "Taking away",
            "REPLACE": "Substitute", "REQUEST": "Ask for", "REQUIRE": "Need", "RESCUE": "Save",
            "RESERVE": "Keep", "RESIDENT": "Inhabitant", "RESPECT": "Regard", "RESPOND": "Reply",
            "RESTORE": "Return", "RETIRED": "Not working", "RETREAT": "Withdraw", "REVENUE": "Income",
            "REVERSE": "Opposite", "REVISED": "Updated", "ROUTINE": "Regular", "RUNNING": "Moving fast",
            "SATISFY": "Please", "SCHOLAR": "Student", "SCIENCE": "Study of nature", "SCRATCH": "Mark",
            "SECTION": "Part", "SEGMENT": "Portion", "SELLING": "Trading", "SERIOUS": "Grave",
            "SERVANT": "Helper", "SERVICE": "Help", "SESSION": "Meeting", "SETTING": "Scene",
            "SEVERAL": "Some", "SHELTER": "Protection", "SHORTLY": "Soon", "SHOWING": "Displaying",
            "SILENCE": "Quiet", "SIMILAR": "Alike", "SITTING": "Seated", "SIXTEEN": "16",
            "SKILLED": "Expert", "SLAVERY": "Bondage", "SLIGHTLY": "A bit", "SMOKING": "Using tobacco",
            "SOCIETY": "Community", "SOLDIER": "Fighter", "SOMEHOW": "In some way", "SOMEONE": "A person",
            "SOUTHERN": "From south", "SPEAKER": "Talker", "SPECIAL": "Unique", "SPECIES": "Type",
            "SPEECH": "Talk", "SPONSOR": "Backer", "STADIUM": "Arena", "STATION": "Stop",
            "STATUTE": "Law", "STORAGE": "Keeping place", "STRANGE": "Odd", "STRETCH": "Extend",
            "STRIKE": "Hit", "STUDENT": "Learner", "STUDIED": "Learned", "SUBJECT": "Topic",
            "SUCCESS": "Victory", "SUCCEED": "Win", "SUGGEST": "Propose", "SUMMARY": "Brief version",
            "SUPPORT": "Help", "SUPPOSE": "Assume", "SUPREME": "Highest", "SURFACE": "Top",
            "SURGERY": "Operation", "SURPLUS": "Extra", "SURPRISE": "Shock", "SURROUND": "Encircle",
            "SURVIVE": "Live through", "SUSPECT": "Doubt", "SUSTAIN": "Maintain", "TALKING": "Speaking",
            "TEACHER": "Educator", "TENSION": "Stress", "TESTING": "Trying", "THEATRE": "Drama house",
            "THERAPY": "Treatment", "THEREBY": "By that", "THOUGHT": "Idea", "THROUGH": "Via",
            "TONIGHT": "This evening", "TOTALLY": "Completely", "TOUCHED": "Felt", "TOWARDS": "To",
            "TRADING": "Exchanging", "TRAFFIC": "Vehicle flow", "TRAGEDY": "Disaster", "TRAINED": "Taught",
            "TRANSIT": "Travel", "TREATED": "Handled", "TRIUMPH": "Victory", "TROUBLE": "Problem",
            "TYPICAL": "Normal", "UNIFORM": "Same", "UNKNOWN": "Not known", "UNUSUAL": "Rare",
            "UPGRADE": "Improve", "UTILITY": "Usefulness", "VARIETY": "Different types", "VARIOUS": "Different",
            "VEHICLE": "Transport", "VERSION": "Form", "VETERAN": "Experienced", "VICTORY": "Win",
            "VILLAGE": "Small town", "VIOLENT": "Forceful", "VIRTUAL": "Almost", "VISIBLE": "Can be seen",
            "VISITOR": "Guest", "WAITING": "Expecting", "WALKING": "Moving on foot", "WANTING": "Desiring",
            "WARNING": "Alert", "WARRIOR": "Fighter", "WEALTHY": "Rich", "WEARING": "Having on",
            "WEATHER": "Climate", "WEBSITE": "Internet site", "WEDDING": "Marriage ceremony", "WEEKEND": "Saturday and Sunday",
            "WELCOME": "Greet", "WELFARE": "Well-being", "WESTERN": "From west", "WHETHER": "If",
            "WILLING": "Ready", "WINNING": "Victorious", "WITHOUT": "Lacking", "WITNESS": "Observer",
            "WORKING": "Laboring", "WORRIED": "Anxious", "WORSHIP": "Adore", "WRITING": "Inscribing",
            "WRITTEN": "Put in text", "YOUNGER": "Less old"
        });

        function getClue(word) {
            return clueDatabase[word] || `Clue for ${word}`;
        }

        // Generate puzzles for all sizes
        console.log("Generating crossword puzzles...");
        const generatedPuzzles = {};
        for (const size of [4, 5, 6, 7]) {
            console.log(`Generating ${size}x${size}...`);
            const grid = generateCrossword(size);
            if (grid.length === size) {
                generatedPuzzles[size] = grid;
                console.log(`Success! ${size}x${size} grid:`, grid);
            } else {
                console.error(`Failed to generate ${size}x${size}`);
            }
        }

        // Convert generated grids to puzzle format
        function createPuzzleData(size, grid) {
            const puzzle = {
                width: size,
                height: size,
                grid: [],
                numbers: {},
                words: { across: {}, down: {} }
            };

            // Create grid (all 1s - no black boxes)
            for (let i = 0; i < size; i++) {
                puzzle.grid.push(new Array(size).fill(1));
            }

            // Add numbers
            for (let i = 0; i < size; i++) {
                puzzle.numbers[`${i},0`] = i + 1; // Across numbers
                puzzle.numbers[`0,${i}`] = size + i + 1; // Down numbers
            }

            // Add across words
            for (let row = 0; row < size; row++) {
                puzzle.words.across[row + 1] = {
                    clue: getClue(grid[row]),
                    answer: grid[row],
                    row: row,
                    col: 0
                };
            }

            // Add down words
            for (let col = 0; col < size; col++) {
                let downWord = "";
                for (let row = 0; row < size; row++) {
                    downWord += grid[row][col];
                }
                puzzle.words.down[size + col + 1] = {
                    clue: getClue(downWord),
                    answer: downWord,
                    row: 0,
                    col: col
                };
            }

            return puzzle;
        }

        // --- PUZZLE DATA (Multiple Sizes) ---
        // Generated using backtracking algorithm with real dictionary words

        const puzzleLibrary = generatedPuzzles[4] ? {
            4: createPuzzleData(4, generatedPuzzles[4]),
            5: createPuzzleData(5, generatedPuzzles[5]),
            6: createPuzzleData(6, generatedPuzzles[6]),
            7: createPuzzleData(7, generatedPuzzles[7])
        } : {
            // Fallback if generation fails
            4: {
                width: 4,
                height: 4,
                grid: [
                    [1,1,1,1], // CROP
                    [1,1,1,1], // LOVE
                    [1,1,1,1], // AMEN
                    [1,1,1,1]  // PENS
                ],
                numbers: {
                    "0,0": 1, "1,0": 2, "2,0": 3, "3,0": 4,
                    "0,1": 5, "0,2": 6, "0,3": 7
                },
                words: {
                    across: {
                        1: { clue: "Harvest yield", answer: "CROP", row: 0, col: 0 },
                        2: { clue: "Deep affection", answer: "LOVE", row: 1, col: 0 },
                        3: { clue: "Prayer ending", answer: "AMEN", row: 2, col: 0 },
                        4: { clue: "Writing tools", answer: "PENS", row: 3, col: 0 }
                    },
                    down: {
                        1: { clue: "Hand gesture", answer: "CLAP", row: 0, col: 0 },
                        5: { clue: "Italian capital", answer: "ROME", row: 0, col: 1 },
                        6: { clue: "Cooking appliance", answer: "OVEN", row: 0, col: 2 },
                        7: { clue: "Plural of pen", answer: "PENS", row: 0, col: 3 }
                    }
                }
            },
            5: {
                width: 5,
                height: 5,
                grid: [
                    [1,1,1,1,1], // HEART
                    [1,1,1,1,1], // EMBER
                    [1,1,1,1,1], // ABUSE
                    [1,1,1,1,1], // RESET
                    [1,1,1,1,1]  // TRESS
                ],
                numbers: {
                    "0,0": 1, "1,0": 2, "2,0": 3, "3,0": 4, "4,0": 5,
                    "0,1": 6, "0,2": 7, "0,3": 8, "0,4": 9
                },
                words: {
                    across: {
                        1: { clue: "Organ that pumps blood", answer: "HEART", row: 0, col: 0 },
                        2: { clue: "Glowing coal", answer: "EMBER", row: 1, col: 0 },
                        3: { clue: "Mistreat or harm", answer: "ABUSE", row: 2, col: 0 },
                        4: { clue: "Restart or reboot", answer: "RESET", row: 3, col: 0 },
                        5: { clue: "Lock of hair", answer: "TRESS", row: 4, col: 0 }
                    },
                    down: {
                        1: { clue: "Warm temperature", answer: "HEART", row: 0, col: 0 },
                        6: { clue: "Glowing remains", answer: "EMBER", row: 0, col: 1 },
                        7: { clue: "Wrong treatment", answer: "ABUSE", row: 0, col: 2 },
                        8: { clue: "Start again", answer: "RESET", row: 0, col: 3 },
                        9: { clue: "Strand of hair", answer: "TRESS", row: 0, col: 4 }
                    }
                }
            },
            6: {
                width: 6,
                height: 6,
                grid: [
                    [1,1,1,1,1,1], // PLANTS
                    [1,1,1,1,1,1], // LADIES
                    [1,1,1,1,1,1], // AVOIDS
                    [1,1,1,1,1,1], // NEATEN
                    [1,1,1,1,1,1], // TESTIS
                    [1,1,1,1,1,1]  // SELVES
                ],
                numbers: {
                    "0,0": 1, "1,0": 2, "2,0": 3, "3,0": 4, "4,0": 5, "5,0": 6,
                    "0,1": 7, "0,2": 8, "0,3": 9, "0,4": 10, "0,5": 11
                },
                words: {
                    across: {
                        1: { clue: "Garden greenery", answer: "PLANTS", row: 0, col: 0 },
                        2: { clue: "Women or girls", answer: "LADIES", row: 1, col: 0 },
                        3: { clue: "Stays away from", answer: "AVOIDS", row: 2, col: 0 },
                        4: { clue: "Make tidy", answer: "NEATEN", row: 3, col: 0 },
                        5: { clue: "Examines or tries", answer: "TESTIS", row: 4, col: 0 },
                        6: { clue: "Ourselves", answer: "SELVES", row: 5, col: 0 }
                    },
                    down: {
                        1: { clue: "Level surfaces", answer: "PLANTS", row: 0, col: 0 },
                        7: { clue: "Nobles or aristocrats", answer: "LADIES", row: 0, col: 1 },
                        8: { clue: "Unoccupied", answer: "AVOIDS", row: 0, col: 2 },
                        9: { clue: "Intelligent", answer: "NEATEN", row: 0, col: 3 },
                        10: { clue: "Male organs", answer: "TESTIS", row: 0, col: 4 },
                        11: { clue: "Our own persons", answer: "SELVES", row: 0, col: 5 }
                    }
                }
            },
            7: {
                width: 7,
                height: 7,
                grid: [
                    [1,1,1,1,1,1,1], // STOPPED
                    [1,1,1,1,1,1,1], // TRANSIT
                    [1,1,1,1,1,1,1], // ONESELF
                    [1,1,1,1,1,1,1], // PLANNED
                    [1,1,1,1,1,1,1], // PLASTER
                    [1,1,1,1,1,1,1], // EFFECTS
                    [1,1,1,1,1,1,1]  // DELETED
                ],
                numbers: {
                    "0,0": 1, "1,0": 2, "2,0": 3, "3,0": 4, "4,0": 5, "5,0": 6, "6,0": 7,
                    "0,1": 8, "0,2": 9, "0,3": 10, "0,4": 11, "0,5": 12, "0,6": 13
                },
                words: {
                    across: {
                        1: { clue: "Came to a halt", answer: "STOPPED", row: 0, col: 0 },
                        2: { clue: "Public transportation", answer: "TRANSIT", row: 1, col: 0 },
                        3: { clue: "Your own person", answer: "ONESELF", row: 2, col: 0 },
                        4: { clue: "Organized ahead", answer: "PLANNED", row: 3, col: 0 },
                        5: { clue: "Wall covering", answer: "PLASTER", row: 4, col: 0 },
                        6: { clue: "Results or outcomes", answer: "EFFECTS", row: 5, col: 0 },
                        7: { clue: "Erased or removed", answer: "DELETED", row: 6, col: 0 }
                    },
                    down: {
                        1: { clue: "Ceased movement", answer: "STOPPED", row: 0, col: 0 },
                        8: { clue: "Travel system", answer: "TRANSIT", row: 0, col: 1 },
                        9: { clue: "Individual identity", answer: "ONESELF", row: 0, col: 2 },
                        10: { clue: "Scheduled", answer: "PLANNED", row: 0, col: 3 },
                        11: { clue: "Building material", answer: "PLASTER", row: 0, col: 4 },
                        12: { clue: "Consequences", answer: "EFFECTS", row: 0, col: 5 },
                        13: { clue: "Taken away", answer: "DELETED", row: 0, col: 6 }
                    }
                }
            }
        };

        let puzzleData = puzzleLibrary[5]; // Default to 5x5
        let selectedPuzzleSize = 5;


        // --- STATE ---
        let selectedMode = 'race';
        let multiplayer = null;
        let isHost = false;
        let playerNames = { p1: 'Player 1', p2: 'Player 2' };
        
        let gridState = {};
        let timer = 0;
        let timerInterval;
        let hintsRemaining = 3;
        
        let selectedCell = null;
        let currentDirection = 'across';

        // --- SETUP ---
        const urlParams = new URLSearchParams(window.location.search);
        const modeParam = urlParams.get('mode') || 'local';
        initModeToggle(modeParam);

        if (modeParam === 'online') {
            document.querySelector('.start-screen').classList.remove('active');
            document.querySelector('.online-lobby-screen').classList.add('active');
            document.getElementById('modeDescription').textContent = "Online: Sync up or Race!";
            multiplayer = new MultiplayerSession('crossword-clash');
        }

        // --- UI FUNCTIONS ---
        window.selectPuzzleSize = (size, btn) => {
            selectedPuzzleSize = size;
            puzzleData = puzzleLibrary[size];
            const sizeButtons = btn.parentElement.querySelectorAll('.mode-btn-game');
            sizeButtons.forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
        };

        window.selectGameMode = (mode, btn) => {
            selectedMode = mode;
            const modeButtons = btn.parentElement.querySelectorAll('.mode-btn-game');
            modeButtons.forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
            const desc = document.getElementById('modeDescription');
            if (modeParam === 'local') {
                desc.textContent = "Local: Play solo against the clock.";
            } else {
                desc.textContent = mode === 'race' ? "Online: Race to finish first!" : "Online: Solve the same board together.";
            }
        };

        window.showScreen = (selector) => {
            document.querySelectorAll('.start-screen, .game-screen, .end-screen, .lobby-screen').forEach(el => el.classList.remove('active'));
            document.querySelector(selector).classList.add('active');
        };

        // --- LOBBY LOGIC ---
        window.showCreateGame = () => window.showScreen('.create-game-screen');
        window.showJoinGame = () => window.showScreen('.join-game-screen');
        window.backToLobby = () => window.showScreen('.online-lobby-screen');

        window.createGameSession = async () => {
            const name = document.getElementById('p1Name').value || 'Host';
            playerNames.p1 = name;
            isHost = true;
            const res = await multiplayerSession.createSession(name);
            if (res.success) {
                document.getElementById('codeDisplay').textContent = res.sessionId;
                window.showScreen('.waiting-screen');
                multiplayerSession.on('onPlayerJoined', (p2) => {
                    playerNames.p2 = p2;
                    document.getElementById('partnerName').textContent = p2;
                    window.showScreen('.connecting-screen');
                    setTimeout(() => window.showScreen('.start-screen'), 1500);
                });
            }
        };

        window.joinGameSession = async () => {
            const name = document.getElementById('p2Name').value || 'Guest';
            const code = document.getElementById('joinCode').value;
            playerNames.p2 = name;
            const res = await multiplayerSession.joinSession(code, name);
            if (res.success) {
                playerNames.p1 = res.opponentName;
                document.getElementById('partnerName').textContent = res.opponentName;
                window.showScreen('.connecting-screen');
                multiplayerSession.on('onGameStateChange', (state) => {
                    if (state.status === 'playing') {
                        selectedMode = state.mode;
                        startGameLogic();
                    }
                });
            }
        };

        // --- GAME START ---
        window.startGame = async () => {
            if (modeParam === 'online' && isHost) {
                await multiplayerSession.updateGameState({
                    status: 'playing',
                    mode: selectedMode,
                    startTime: Date.now()
                });
            }
            startGameLogic();
        };

        function startGameLogic() {
            window.showScreen('.game-screen');
            hintsRemaining = 3;
            updateHintButton();
            
            renderGrid();
            renderClues();
            selectCell(0, 0); // Start at first cell

            if (modeParam === 'online') {
                if (selectedMode === 'coop') {
                    document.getElementById('gameStatus').textContent = "Co-op Mode: Solving Together";
                    multiplayerSession.on('onGameStateChange', (state) => {
                        if (state.gridUpdates) {
                            Object.keys(state.gridUpdates).forEach(key => {
                                updateCellUI(key, state.gridUpdates[key]);
                                gridState[key] = state.gridUpdates[key];
                                validateAllWords(); // Check green highlight on sync
                            });
                        }
                    });
                } else {
                    document.getElementById('gameStatus').textContent = "Race Mode: Go!";
                    document.getElementById('opponentStatBox').style.display = 'block';
                    multiplayerSession.on('onGameStateChange', (state) => {
                        const opponentNum = multiplayerSession.playerNumber === 1 ? 2 : 1;
                        const prog = state[`p${opponentNum}Progress`];
                        if (prog) document.getElementById('opponentProgress').textContent = prog + '%';
                        if (state[`p${opponentNum}Finished`]) alert(`${playerNames[`p${opponentNum}`]} finished!`);
                    });
                }
            }

            const startT = Date.now();
            timerInterval = setInterval(() => {
                const delta = Math.floor((Date.now() - startT) / 1000);
                const m = Math.floor(delta / 60).toString().padStart(2, '0');
                const s = (delta % 60).toString().padStart(2, '0');
                document.getElementById('timerDisplay').textContent = `${m}:${s}`;
            }, 1000);
        }

        // --- RENDERERS ---
        function renderGrid() {
            const container = document.getElementById('gridContainer');
            container.style.gridTemplateColumns = `repeat(${puzzleData.width}, 1fr)`;
            container.innerHTML = '';

            for(let r=0; r<puzzleData.height; r++) {
                for(let c=0; c<puzzleData.width; c++) {
                    const cell = document.createElement('div');
                    cell.className = 'cw-cell';
                    cell.dataset.row = r;
                    cell.dataset.col = c;
                    
                    if (puzzleData.grid[r][c] === 0) {
                        cell.classList.add('black');
                        // No inputs for black boxes
                    } else {
                        // Number
                        const key = `${r},${c}`;
                        if (puzzleData.numbers[key]) {
                            const numSpan = document.createElement('span');
                            numSpan.className = 'cw-number';
                            numSpan.textContent = puzzleData.numbers[key];
                            cell.appendChild(numSpan);
                        }
                        
                        // Input
                        const input = document.createElement('input');
                        input.className = 'cw-input';
                        input.maxLength = 1;
                        input.dataset.row = r;
                        input.dataset.col = c;
                        
                        input.addEventListener('focus', () => selectCell(r, c));
                        input.addEventListener('input', (e) => handleInput(e, r, c));
                        input.addEventListener('keydown', (e) => handleKey(e, r, c));
                        input.addEventListener('click', () => {
                            if (selectedCell && selectedCell.r === r && selectedCell.c === c) {
                                currentDirection = currentDirection === 'across' ? 'down' : 'across';
                                highlightActiveWord();
                            }
                        });

                        cell.appendChild(input);
                    }
                    container.appendChild(cell);
                }
            }
        }

        function renderClues() {
            const aList = document.getElementById('acrossClues');
            const dList = document.getElementById('downClues');
            aList.innerHTML = '';
            dList.innerHTML = '';

            Object.entries(puzzleData.words.across).forEach(([num, data]) => {
                const li = document.createElement('li');
                li.className = 'clue-item';
                li.id = `clue-across-${num}`;
                li.innerHTML = `<strong>${num}</strong> ${data.clue}`;
                li.onclick = () => jumpToWord('across', data);
                aList.appendChild(li);
            });

            Object.entries(puzzleData.words.down).forEach(([num, data]) => {
                const li = document.createElement('li');
                li.className = 'clue-item';
                li.id = `clue-down-${num}`;
                li.innerHTML = `<strong>${num}</strong> ${data.clue}`;
                li.onclick = () => jumpToWord('down', data);
                dList.appendChild(li);
            });
        }

        // --- NAVIGATION & INPUT ---
        function selectCell(r, c) {
            selectedCell = { r, c };
            document.querySelectorAll('.cw-cell').forEach(el => el.classList.remove('selected'));
            const cell = document.querySelector(`.cw-cell[data-row="${r}"][data-col="${c}"]`);
            if (cell) cell.classList.add('selected');
            highlightActiveWord();
        }

        function highlightActiveWord() {
            document.querySelectorAll('.cw-cell').forEach(el => el.classList.remove('active-word'));
            document.querySelectorAll('.clue-item').forEach(el => el.classList.remove('active'));

            if (!selectedCell) return;
            const wordObj = getWordAt(selectedCell.r, selectedCell.c, currentDirection);
            
            if (wordObj) {
                // Highlight clue
                const clueKey = Object.keys(puzzleData.words[currentDirection]).find(k => puzzleData.words[currentDirection][k] === wordObj);
                if (clueKey) {
                    const el = document.getElementById(`clue-${currentDirection}-${clueKey}`);
                    if (el) {
                        el.classList.add('active');
                        el.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                    }
                }

                // Highlight grid
                let r = wordObj.row, c = wordObj.col;
                for(let i=0; i<wordObj.answer.length; i++) {
                    const cell = document.querySelector(`.cw-cell[data-row="${r}"][data-col="${c}"]`);
                    if(cell) cell.classList.add('active-word');
                    if(currentDirection === 'across') c++; else r++;
                }
            }
        }

        function getWordAt(r, c, dir) {
            const words = puzzleData.words[dir];
            for (const key in words) {
                const w = words[key];
                if (dir === 'across') {
                    if (r === w.row && c >= w.col && c < w.col + w.answer.length) return w;
                } else {
                    if (c === w.col && r >= w.row && r < w.row + w.answer.length) return w;
                }
            }
            return null;
        }

        function jumpToWord(dir, data) {
            currentDirection = dir;
            const input = document.querySelector(`.cw-input[data-row="${data.row}"][data-col="${data.col}"]`);
            if (input) {
                input.focus();
                selectCell(data.row, data.col);
            }
        }

        async function handleInput(e, r, c) {
            const val = e.target.value.toUpperCase();
            e.target.value = val;
            gridState[`${r},${c}`] = val;

            if (modeParam === 'online' && selectedMode === 'coop') {
                await multiplayerSession.updateGameState({ gridUpdates: { [`${r},${c}`]: val } });
            }

            validateAllWords();
            checkProgress();

            if (val) moveFocus(r, c, 1);
        }

        function handleKey(e, r, c) {
            if (e.key === 'Backspace' && !e.target.value) moveFocus(r, c, -1);
        }

        function moveFocus(r, c, delta) {
            let nr = r, nc = c;
            
            // Loop a few times to skip black boxes
            for(let i=0; i<8; i++) { 
                if (currentDirection === 'across') nc += delta; else nr += delta;
                
                const nextCell = document.querySelector(`.cw-cell[data-row="${nr}"][data-col="${nc}"]`);
                if (!nextCell) break; // End of grid
                
                if (!nextCell.classList.contains('black')) {
                    const nextInput = nextCell.querySelector('input');
                    if(nextInput) nextInput.focus();
                    break;
                }
            }
        }

        function updateCellUI(key, val) {
            const [r, c] = key.split(',');
            const input = document.querySelector(`.cw-input[data-row="${r}"][data-col="${c}"]`);
            if (input && input.value !== val) input.value = val;
        }

        // --- VALIDATION & HINTS ---
        function validateAllWords() {
            Object.values(puzzleData.words.across).forEach(w => checkWord(w, 'across'));
            Object.values(puzzleData.words.down).forEach(w => checkWord(w, 'down'));
        }

        function checkWord(word, dir) {
            let r = word.row, c = word.col;
            let currentStr = "";
            let cells = [];

            for(let i=0; i<word.answer.length; i++) {
                const input = document.querySelector(`.cw-input[data-row="${r}"][data-col="${c}"]`);
                const cell = document.querySelector(`.cw-cell[data-row="${r}"][data-col="${c}"]`);
                if (input) {
                    currentStr += input.value || " ";
                    cells.push(cell);
                }
                if (dir === 'across') c++; else r++;
            }

            if (currentStr === word.answer) {
                cells.forEach(cell => cell.classList.add('correct'));
                // Mark clue
                const k = Object.keys(puzzleData.words[dir]).find(key => puzzleData.words[dir][key] === word);
                const clueEl = document.getElementById(`clue-${dir}-${k}`);
                if(clueEl) clueEl.classList.add('correct-clue');
            }
        }

        window.useHint = () => {
            if (hintsRemaining <= 0 || !selectedCell) return;
            
            let correctChar = null;
            let w = getWordAt(selectedCell.r, selectedCell.c, 'across');
            if (w) correctChar = w.answer[selectedCell.c - w.col];
            else {
                w = getWordAt(selectedCell.r, selectedCell.c, 'down');
                if (w) correctChar = w.answer[selectedCell.r - w.row];
            }

            if (correctChar) {
                const input = document.querySelector(`.cw-input[data-row="${selectedCell.r}"][data-col="${selectedCell.c}"]`);
                input.value = correctChar;
                handleInput({ target: input }, selectedCell.r, selectedCell.c);
                hintsRemaining--;
                updateHintButton();
            }
        };

        function updateHintButton() {
            const btn = document.getElementById('hintBtn');
            btn.textContent = `üí° Hint (${hintsRemaining} left)`;
            if (hintsRemaining <= 0) btn.disabled = true;
        }

        function checkProgress() {
            let total = 0, filled = 0;
            for(let r=0; r<puzzleData.height; r++) {
                for(let c=0; c<puzzleData.width; c++) {
                    if (puzzleData.grid[r][c] === 1) {
                        total++;
                        const input = document.querySelector(`.cw-input[data-row="${r}"][data-col="${c}"]`);
                        if (input && input.value) filled++;
                    }
                }
            }
            const pct = Math.floor((filled / total) * 100);
            document.getElementById('progressDisplay').textContent = pct + '%';
            
            if (modeParam === 'online' && selectedMode === 'race') {
                multiplayerSession.updateGameState({ [`p${multiplayerSession.playerNumber}Progress`]: pct });
            }
        }

        window.checkPuzzle = async () => {
            let allCorrect = true;
            // Check every single letter against expected
            // Since we have overlapping, check by words is safer
            let allWordsCorrect = true;
            
            Object.values(puzzleData.words.across).forEach(w => {
                 if(!isWordCompleteAndCorrect(w, 'across')) allWordsCorrect = false;
            });
            Object.values(puzzleData.words.down).forEach(w => {
                 if(!isWordCompleteAndCorrect(w, 'down')) allWordsCorrect = false;
            });

            if (allWordsCorrect) {
                clearInterval(timerInterval);
                document.getElementById('finalTime').textContent = document.getElementById('timerDisplay').textContent;
                
                if (modeParam === 'online' && selectedMode === 'race') {
                    await multiplayerSession.updateGameState({ [`p${multiplayerSession.playerNumber}Finished`]: true });
                    document.getElementById('winnerText').textContent = "You Finished First!";
                } else {
                    document.getElementById('winnerText').textContent = "Puzzle Solved!";
                }
                window.showScreen('.end-screen');
            } else {
                alert("Not quite done! Look for non-green boxes.");
            }
        };
        
        function isWordCompleteAndCorrect(word, dir) {
            let r = word.row, c = word.col;
            for(let i=0; i<word.answer.length; i++) {
                const input = document.querySelector(`.cw-input[data-row="${r}"][data-col="${c}"]`);
                if(!input || input.value !== word.answer[i]) return false;
                if(dir==='across') c++; else r++;
            }
            return true;
        }

        window.leaveGame = () => location.reload();
    </script>
</body>
</html>
