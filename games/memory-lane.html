<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Memory Lane Adventure - Couples Game Hub</title>
    <link rel="stylesheet" href="../css/style.css">
    <style>
        .player-indicator {
            text-align: center;
            font-size: 1.5em;
            font-weight: bold;
            color: #764ba2;
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9ff;
            border-radius: 10px;
        }

        .mode-selection {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .mode-card {
            background: #f8f9ff;
            padding: 25px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s;
            border: 3px solid transparent;
            text-align: center;
        }

        .mode-card:hover {
            transform: translateY(-5px);
            border-color: #667eea;
        }

        .mode-card.selected {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #764ba2;
        }

        .mode-card h3 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 1.5em;
        }

        .mode-card.selected h3 {
            color: white;
        }

        .mode-card p {
            color: #666;
            line-height: 1.5;
        }

        .mode-card.selected p {
            color: rgba(255,255,255,0.95);
        }

        .upload-section {
            background: #f8f9ff;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 25px;
        }

        .upload-area {
            border: 3px dashed #667eea;
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: white;
        }

        .upload-area:hover {
            background: #f8f9ff;
            border-color: #764ba2;
        }

        .upload-area.dragover {
            background: #e8eaff;
            border-color: #764ba2;
        }

        .photo-preview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .photo-preview {
            position: relative;
            aspect-ratio: 1;
            border-radius: 10px;
            overflow: hidden;
            border: 3px solid #667eea;
        }

        .photo-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .photo-preview .remove-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background: #f44336;
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            cursor: pointer;
            font-weight: bold;
            padding: 0;
            margin: 0;
        }

        .memory-setup {
            background: #f8f9ff;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .memory-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .memory-photo {
            width: 100%;
            max-height: 400px;
            object-fit: contain;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 3px solid #667eea;
        }

        .question-label {
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .answer-input, .clue-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
            margin-bottom: 15px;
        }

        .answer-input:focus, .clue-input:focus {
            outline: none;
            border-color: #667eea;
        }

        textarea.answer-input, textarea.clue-input {
            min-height: 80px;
            resize: vertical;
            font-family: inherit;
        }

        .instructions {
            background: #f8f9ff;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .instructions h3 {
            color: #667eea;
            margin-bottom: 10px;
        }

        button {
            width: 100%;
            padding: 15px;
            font-size: 1.2em;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: transform 0.2s;
            font-weight: bold;
            margin-top: 10px;
        }

        button:hover {
            transform: translateY(-2px);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .start-screen, .upload-screen, .setup-screen, .game-screen, .end-screen {
            display: none;
        }

        .start-screen.active, .upload-screen.active, .setup-screen.active, .game-screen.active, .end-screen.active {
            display: block;
        }

        .progress-indicator {
            text-align: center;
            color: #764ba2;
            font-weight: bold;
            margin-bottom: 20px;
            font-size: 1.2em;
        }

        .score-display {
            text-align: center;
            font-size: 3em;
            color: #667eea;
            margin: 30px 0;
            font-weight: bold;
        }

        .results-summary {
            background: #f8f9ff;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .result-item {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            border-left: 4px solid #667eea;
        }

        .result-item.correct {
            border-left-color: #4caf50;
            background: #e8f5e9;
        }

        .result-item.incorrect {
            border-left-color: #f44336;
            background: #ffebee;
        }

        .stats {
            display: flex;
            justify-content: space-around;
            margin-bottom: 30px;
            gap: 15px;
        }

        .stat-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            text-align: center;
            flex: 1;
        }

        .stat-label {
            font-size: 0.9em;
            opacity: 0.9;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
        }

        .guess-options {
            display: grid;
            gap: 10px;
            margin-top: 15px;
        }

        .guess-btn {
            padding: 15px;
            background: white;
            border: 3px solid #ddd;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: left;
            font-size: 1.1em;
            width: 100%;
            margin: 0;
        }

        .guess-btn:hover {
            border-color: #667eea;
            transform: translateX(5px);
        }

        .guess-btn.correct {
            background: #c8e6c9;
            border-color: #4caf50;
        }

        .guess-btn.incorrect {
            background: #ffcdd2;
            border-color: #f44336;
        }

        .guess-btn:disabled {
            cursor: not-allowed;
            opacity: 0.6;
        }

        @media (max-width: 768px) {
            .mode-selection {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <a href="../index.html" class="back-link">‚Üê Back to Games</a>
        <h1 class="game-title">üíï Memory Lane Adventure</h1>
        <p class="game-subtitle">Relive your favorite moments together</p>

        <!-- Start Screen -->
        <div class="start-screen active">
            <div class="instructions">
                <h3>Welcome to Memory Lane!</h3>
                <p>A special game to celebrate your relationship through photos and memories.</p>
            </div>

            <div class="mode-selection">
                <div class="mode-card" onclick="selectMode('story')">
                    <h3>üìñ Story Mode</h3>
                    <p>Walk through memories together and answer sweet questions about each moment. Collaborative and heartwarming!</p>
                </div>
                <div class="mode-card" onclick="selectMode('quiz')">
                    <h3>üéØ Quiz Mode</h3>
                    <p>One person creates memory clues, the other guesses! Test how well you remember your special moments.</p>
                </div>
            </div>

            <button id="startBtn" disabled onclick="goToUpload()">Select a Mode to Continue</button>
        </div>

        <!-- Upload Screen -->
        <div class="upload-screen">
            <div class="player-indicator" id="uploadIndicator">Upload Your Memories</div>

            <div class="upload-section">
                <h3 style="color: #667eea; margin-bottom: 15px;">Add 3-5 Photos</h3>
                <div class="upload-area" id="uploadArea">
                    <p style="font-size: 3em; margin-bottom: 10px;">üì∏</p>
                    <p style="font-size: 1.2em; color: #667eea; font-weight: bold;">Click to upload photos</p>
                    <p style="color: #666; margin-top: 10px;">or drag and drop here</p>
                    <input type="file" id="fileInput" accept="image/*" multiple style="display: none;">
                </div>
                <div class="photo-preview-grid" id="photoPreviewGrid"></div>
            </div>

            <button id="continueSetupBtn" disabled onclick="goToSetup()">Continue to Setup</button>
        </div>

        <!-- Setup Screen -->
        <div class="setup-screen">
            <div class="player-indicator" id="setupIndicator">Add Details to Your Memories</div>

            <div id="memorySetupContainer"></div>

            <button onclick="startGame()">Start the Adventure!</button>
        </div>

        <!-- Game Screen -->
        <div class="game-screen">
            <div class="player-indicator" id="gameIndicator">Memory 1 of 3</div>

            <div class="stats" id="statsDisplay" style="display: none;">
                <div class="stat-box">
                    <div class="stat-label">Score</div>
                    <div class="stat-value" id="score">0</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Memory</div>
                    <div class="stat-value" id="memoryNum">1</div>
                </div>
            </div>

            <div id="gameContent"></div>

            <button id="nextMemoryBtn" onclick="nextMemory()" style="display: none;">Next Memory</button>
            <button id="finishBtn" onclick="showResults()" style="display: none;">See Results</button>
        </div>

        <!-- End Screen -->
        <div class="end-screen">
            <div class="score-display" id="finalScore">Beautiful Memories! üíï</div>

            <div class="results-summary" id="resultsContainer"></div>

            <button onclick="location.reload()">Create New Memories</button>
        </div>
    </div>

    <script>
        let gameMode = null;
        let uploadedPhotos = [];
        let memories = [];
        let currentMemoryIndex = 0;
        let score = 0;
        let quizAnswers = [];

        const storyQuestions = [
            "What was the funniest moment from this memory?",
            "What did you love most about this moment?",
            "If you could relive this moment, what would you do differently?",
            "What song reminds you of this memory?",
            "What was the best part of this day?",
            "What made this moment special?",
            "What did we eat or drink here?",
            "What was the weather like?",
            "Who else was there with you?",
            "What were you celebrating?"
        ];

        function selectMode(mode) {
            gameMode = mode;
            document.querySelectorAll('.mode-card').forEach(card => {
                card.classList.remove('selected');
            });
            event.target.closest('.mode-card').classList.add('selected');

            document.getElementById('startBtn').disabled = false;
            document.getElementById('startBtn').textContent = `Start ${mode === 'story' ? 'Story' : 'Quiz'} Mode`;
        }

        function goToUpload() {
            document.querySelector('.start-screen').classList.remove('active');
            document.querySelector('.upload-screen').classList.add('active');

            if (gameMode === 'story') {
                document.getElementById('uploadIndicator').textContent = 'Upload Your Shared Memories';
            } else {
                document.getElementById('uploadIndicator').textContent = 'Player 1: Upload Memory Photos';
            }

            setupUploadHandlers();
        }

        function setupUploadHandlers() {
            const uploadArea = document.getElementById('uploadArea');
            const fileInput = document.getElementById('fileInput');

            uploadArea.addEventListener('click', () => fileInput.click());

            fileInput.addEventListener('change', handleFiles);

            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });

            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });

            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                handleFiles({ target: { files: e.dataTransfer.files } });
            });
        }

        function handleFiles(e) {
            const files = Array.from(e.target.files);

            files.forEach(file => {
                if (uploadedPhotos.length >= 5) {
                    alert('Maximum 5 photos allowed!');
                    return;
                }

                if (!file.type.startsWith('image/')) {
                    alert('Please upload only image files!');
                    return;
                }

                const reader = new FileReader();
                reader.onload = (event) => {
                    uploadedPhotos.push(event.target.result);
                    renderPhotoPreview();
                    updateContinueButton();
                };
                reader.readAsDataURL(file);
            });
        }

        function renderPhotoPreview() {
            const grid = document.getElementById('photoPreviewGrid');
            grid.innerHTML = '';

            uploadedPhotos.forEach((photo, index) => {
                const div = document.createElement('div');
                div.className = 'photo-preview';
                div.innerHTML = `
                    <img src="${photo}" alt="Memory ${index + 1}">
                    <button class="remove-btn" onclick="removePhoto(${index})">√ó</button>
                `;
                grid.appendChild(div);
            });
        }

        function removePhoto(index) {
            uploadedPhotos.splice(index, 1);
            renderPhotoPreview();
            updateContinueButton();
        }

        function updateContinueButton() {
            const btn = document.getElementById('continueSetupBtn');
            btn.disabled = uploadedPhotos.length < 3;
            btn.textContent = uploadedPhotos.length < 3
                ? `Add ${3 - uploadedPhotos.length} more photo(s)`
                : 'Continue to Setup';
        }

        function goToSetup() {
            document.querySelector('.upload-screen').classList.remove('active');
            document.querySelector('.setup-screen').classList.add('active');

            if (gameMode === 'story') {
                document.getElementById('setupIndicator').textContent = 'Add context to your memories';
                renderStorySetup();
            } else {
                document.getElementById('setupIndicator').textContent = 'Player 1: Create Memory Clues';
                renderQuizSetup();
            }
        }

        function renderStorySetup() {
            const container = document.getElementById('memorySetupContainer');
            container.innerHTML = '<div class="instructions"><p>Give each photo a title or short description. You\'ll answer fun questions about each memory during the game!</p></div>';

            uploadedPhotos.forEach((photo, index) => {
                const div = document.createElement('div');
                div.className = 'memory-card';
                div.innerHTML = `
                    <img src="${photo}" class="memory-photo">
                    <div class="question-label">Memory Title:</div>
                    <input type="text" class="answer-input" id="title${index}" placeholder="e.g., Our First Date, Beach Trip 2023...">
                `;
                container.appendChild(div);
            });
        }

        function renderQuizSetup() {
            const container = document.getElementById('memorySetupContainer');
            container.innerHTML = '<div class="instructions"><p>For each photo, write a clue and the correct answer. Player 2 will try to guess!</p></div>';

            uploadedPhotos.forEach((photo, index) => {
                const div = document.createElement('div');
                div.className = 'memory-card';
                div.innerHTML = `
                    <img src="${photo}" class="memory-photo">
                    <div class="question-label">Clue for Player 2:</div>
                    <textarea class="clue-input" id="clue${index}" placeholder="e.g., 'This was our first adventure together' or 'Where we tried sushi for the first time'"></textarea>
                    <div class="question-label">Correct Answer:</div>
                    <input type="text" class="answer-input" id="answer${index}" placeholder="e.g., First Date, Italy Vacation, Christmas 2023...">
                    <div class="question-label">Wrong Answer Options (for multiple choice):</div>
                    <input type="text" class="answer-input" id="wrong1_${index}" placeholder="Wrong option 1">
                    <input type="text" class="answer-input" id="wrong2_${index}" placeholder="Wrong option 2">
                `;
                container.appendChild(div);
            });
        }

        function startGame() {
            // Collect all the setup data
            uploadedPhotos.forEach((photo, index) => {
                if (gameMode === 'story') {
                    const title = document.getElementById(`title${index}`).value || `Memory ${index + 1}`;
                    const question = storyQuestions[Math.floor(Math.random() * storyQuestions.length)];
                    memories.push({ photo, title, question, answer: '' });
                } else {
                    const clue = document.getElementById(`clue${index}`).value || 'Guess this memory!';
                    const correctAnswer = document.getElementById(`answer${index}`).value || 'Mystery Memory';
                    const wrong1 = document.getElementById(`wrong1_${index}`).value || 'Option A';
                    const wrong2 = document.getElementById(`wrong2_${index}`).value || 'Option B';

                    // Shuffle options
                    const options = [correctAnswer, wrong1, wrong2].sort(() => Math.random() - 0.5);

                    memories.push({
                        photo,
                        clue,
                        correctAnswer,
                        options,
                        userAnswer: null
                    });
                }
            });

            document.querySelector('.setup-screen').classList.remove('active');
            document.querySelector('.game-screen').classList.add('active');

            if (gameMode === 'quiz') {
                document.getElementById('statsDisplay').style.display = 'flex';
                document.getElementById('gameIndicator').textContent = 'Player 2: Guess the Memories!';
            } else {
                document.getElementById('gameIndicator').textContent = 'Share Your Stories!';
            }

            currentMemoryIndex = 0;
            loadMemory();
        }

        function loadMemory() {
            const memory = memories[currentMemoryIndex];
            const content = document.getElementById('gameContent');

            document.getElementById('memoryNum').textContent = currentMemoryIndex + 1;

            if (gameMode === 'story') {
                content.innerHTML = `
                    <div class="memory-card">
                        <img src="${memory.photo}" class="memory-photo">
                        <h2 style="color: #667eea; margin-bottom: 20px;">${memory.title}</h2>
                        <div class="question-label">${memory.question}</div>
                        <textarea class="answer-input" id="storyAnswer" placeholder="Share your thoughts..."></textarea>
                    </div>
                `;
            } else {
                content.innerHTML = `
                    <div class="memory-card">
                        <img src="${memory.photo}" class="memory-photo">
                        <div class="question-label">Memory Clue:</div>
                        <p style="font-size: 1.2em; color: #333; margin-bottom: 20px; font-style: italic;">"${memory.clue}"</p>
                        <div class="question-label">Where is this memory from?</div>
                        <div class="guess-options" id="guessOptions"></div>
                    </div>
                `;

                const optionsContainer = document.getElementById('guessOptions');
                memory.options.forEach(option => {
                    const btn = document.createElement('button');
                    btn.className = 'guess-btn';
                    btn.textContent = option;
                    btn.onclick = () => selectAnswer(option);
                    optionsContainer.appendChild(btn);
                });
            }

            document.getElementById('nextMemoryBtn').style.display = 'none';
            document.getElementById('finishBtn').style.display = 'none';
        }

        function selectAnswer(answer) {
            const memory = memories[currentMemoryIndex];
            memory.userAnswer = answer;

            const buttons = document.querySelectorAll('.guess-btn');
            buttons.forEach(btn => {
                btn.disabled = true;
                if (btn.textContent === memory.correctAnswer) {
                    btn.classList.add('correct');
                } else if (btn.textContent === answer && answer !== memory.correctAnswer) {
                    btn.classList.add('incorrect');
                }
            });

            if (answer === memory.correctAnswer) {
                score += 10;
                document.getElementById('score').textContent = score;
            }

            if (currentMemoryIndex < memories.length - 1) {
                document.getElementById('nextMemoryBtn').style.display = 'block';
            } else {
                document.getElementById('finishBtn').style.display = 'block';
            }
        }

        function nextMemory() {
            if (gameMode === 'story') {
                const answer = document.getElementById('storyAnswer').value;
                memories[currentMemoryIndex].answer = answer;
            }

            currentMemoryIndex++;

            if (currentMemoryIndex < memories.length) {
                loadMemory();
            }
        }

        function showResults() {
            if (gameMode === 'story') {
                const answer = document.getElementById('storyAnswer').value;
                memories[currentMemoryIndex].answer = answer;
            }

            document.querySelector('.game-screen').classList.remove('active');
            document.querySelector('.end-screen').classList.add('active');

            const resultsContainer = document.getElementById('resultsContainer');

            if (gameMode === 'story') {
                document.getElementById('finalScore').textContent = 'Your Beautiful Story üíï';

                let html = '<h3 style="color: #667eea; margin-bottom: 20px;">Your Memory Lane Journey:</h3>';
                memories.forEach((memory, index) => {
                    html += `
                        <div class="result-item">
                            <h4 style="color: #667eea; margin-bottom: 10px;">${memory.title}</h4>
                            <p style="margin-bottom: 8px;"><strong>Q:</strong> ${memory.question}</p>
                            <p><strong>A:</strong> ${memory.answer || '(No answer provided)'}</p>
                        </div>
                    `;
                });
                resultsContainer.innerHTML = html;
            } else {
                const correctCount = memories.filter(m => m.userAnswer === m.correctAnswer).length;
                const percentage = Math.round((correctCount / memories.length) * 100);

                let resultText = '';
                if (percentage === 100) {
                    resultText = 'üèÜ Perfect Memory! üíØ';
                } else if (percentage >= 66) {
                    resultText = 'üåü Great Job! ' + correctCount + '/' + memories.length;
                } else if (percentage >= 33) {
                    resultText = 'üíï Not Bad! ' + correctCount + '/' + memories.length;
                } else {
                    resultText = '‚ù§Ô∏è Keep Making Memories! ' + correctCount + '/' + memories.length;
                }

                document.getElementById('finalScore').textContent = resultText;

                let html = '<h3 style="color: #667eea; margin-bottom: 20px;">Quiz Results:</h3>';
                html += `<div style="text-align: center; margin-bottom: 25px;"><p style="font-size: 1.5em; color: #764ba2; font-weight: bold;">Score: ${score} points</p></div>`;

                memories.forEach((memory, index) => {
                    const isCorrect = memory.userAnswer === memory.correctAnswer;
                    html += `
                        <div class="result-item ${isCorrect ? 'correct' : 'incorrect'}">
                            <p style="margin-bottom: 8px;"><strong>Clue:</strong> "${memory.clue}"</p>
                            <p style="margin-bottom: 8px;"><strong>Your answer:</strong> ${memory.userAnswer}</p>
                            ${!isCorrect ? `<p><strong>Correct answer:</strong> ${memory.correctAnswer}</p>` : '<p style="color: #4caf50; font-weight: bold;">‚úì Correct!</p>'}
                        </div>
                    `;
                });
                resultsContainer.innerHTML = html;
            }
        }
    </script>
</body>
</html>
