<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Cinco - Card Game</title>
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/cinco.css">
</head>
<body>
    <div class="cinco-game">
        <!-- Mode Selection Screen -->
        <div class="cinco-screen active" id="modeScreen">
            <div class="cinco-mode-selection">
                <a href="../index.html" class="back-link">â† Back to Games</a>
                <h1 class="cinco-title">ğŸ´ CINCO</h1>
                <p class="cinco-subtitle">Match colors, play power-ups, win!</p>

                <div class="cinco-mode-buttons">
                    <button class="cinco-mode-btn" id="aiModeBtn">
                        <span style="font-size: 1.5em;">ğŸ¤–</span><br>
                        Play vs AI
                    </button>
                    <button class="cinco-mode-btn" id="localModeBtn">
                        <span style="font-size: 1.5em;">ğŸ‘¥</span><br>
                        Pass & Play
                    </button>
                    <button class="cinco-mode-btn" id="onlineModeBtn">
                        <span style="font-size: 1.5em;">ğŸŒ</span><br>
                        Play Online
                    </button>
                </div>
            </div>
        </div>

        <!-- Loading Screen -->
        <div class="cinco-screen" id="loadingScreen">
            <div class="cinco-loading">
                <div class="cinco-loading-spinner"></div>
                <div class="cinco-loading-text">Connecting...</div>
            </div>
        </div>

        <!-- Game Screen -->
        <div class="cinco-screen" id="gameScreen">
            <!-- Turn Indicator -->
            <div class="cinco-turn-indicator" id="turnIndicator">Waiting...</div>

            <!-- Action Banner -->
            <div class="cinco-action-banner" id="actionBanner">
                <div class="banner-icon" id="bannerIcon"></div>
                <div class="banner-title" id="bannerTitle"></div>
                <div class="banner-description" id="bannerDescription"></div>
            </div>

            <!-- Cinco Board -->
            <div class="cinco-board">
                <!-- Opponent Area -->
                <div class="cinco-opponent-area">
                    <div class="cinco-opponent-info">
                        <span id="opponentName">Opponent</span>
                        <span>(<span id="opponentCardCount">7</span> cards)</span>
                    </div>
                    <div class="cinco-opponent-hand" id="opponentHand"></div>
                </div>

                <!-- Center Play Area -->
                <div class="cinco-center-area">
                    <div class="cinco-deck-area">
                        <div class="cinco-pile">
                            <div class="cinco-draw-pile" id="drawPile">ğŸ´</div>
                            <div class="cinco-pile-label">Draw (<span id="deckCount">108</span>)</div>
                        </div>

                        <div class="cinco-pile">
                            <div class="cinco-discard-pile" id="discardPile"></div>
                            <div class="cinco-pile-label">Discard</div>
                        </div>
                    </div>

                    <!-- Active Effects -->
                    <div class="cinco-effects" id="activeEffects"></div>
                </div>

                <!-- Player Area -->
                <div class="cinco-player-area">
                    <div class="cinco-player-info">
                        <div>
                            <span id="playerName">You</span>
                            <span>(<span id="playerCardCount">7</span> cards)</span>
                        </div>
                        <div style="font-size: 0.9em; color: rgba(255,255,255,0.8);" id="colorIndicator"></div>
                    </div>

                    <div class="cinco-hand-container">
                        <div class="cinco-player-hand" id="playerHand"></div>
                    </div>
                </div>
            </div>

            <!-- Cinco Button -->
            <button class="cinco-btn" id="cincoBtn">CINCO!</button>
        </div>

        <!-- Game Over Screen -->
        <div class="cinco-screen" id="gameOverScreen">
            <div class="cinco-game-over">
                <div class="cinco-result-emoji" id="resultEmoji">ğŸ†</div>
                <div class="cinco-result-message" id="resultMessage">You Win!</div>
                <div class="cinco-result-details" id="resultDetails"></div>

                <div class="cinco-result-actions">
                    <button class="cinco-mode-btn" id="playAgainBtn">Play Again</button>
                    <button class="cinco-mode-btn" style="background: var(--color-primary-dark);" onclick="location.href='../index.html'">
                        Back to Games
                    </button>
                </div>
            </div>
        </div>

        <!-- Color Picker Modal -->
        <div class="cinco-color-picker" id="colorPicker">
            <div class="cinco-color-picker-content">
                <h3>Choose a Color</h3>
                <div class="cinco-color-options">
                    <div class="cinco-color-option red" data-color="red"></div>
                    <div class="cinco-color-option blue" data-color="blue"></div>
                    <div class="cinco-color-option green" data-color="green"></div>
                    <div class="cinco-color-option yellow" data-color="yellow"></div>
                </div>
            </div>
        </div>

        <!-- Particles Container -->
        <div class="cinco-particles" id="particles"></div>
    </div>

    <script type="module">
        import authManager from '../js/auth/auth-manager.js';
        import profileManager from '../js/auth/profile-manager.js';
        import { showNotification } from '../js/auth/auth-ui.js';
        import CincoGame from '../js/cinco-game.js';
        import CincoOnline from '../js/cinco-online.js';
        import multiplayer from '../js/multiplayer.js';

        // Global state
        let currentUser = null;
        let gameMode = null;
        let game = null;
        let onlineGame = null;
        let gameStartTime = null;
        let colorSelectionCallback = null;
        let longPressTimer = null;

        // Auth state
        authManager.onAuthStateChanged((user) => {
            currentUser = user;
        });

        // UI Elements
        const screens = {
            mode: document.getElementById('modeScreen'),
            loading: document.getElementById('loadingScreen'),
            game: document.getElementById('gameScreen'),
            gameOver: document.getElementById('gameOverScreen')
        };

        // Screen navigation
        function showScreen(screenName) {
            Object.values(screens).forEach(s => s.classList.remove('active'));
            screens[screenName]?.classList.add('active');
        }

        // Mode selection
        document.getElementById('aiModeBtn').addEventListener('click', () => startGame('ai'));
        document.getElementById('localModeBtn').addEventListener('click', () => startGame('local'));
        document.getElementById('onlineModeBtn').addEventListener('click', () => startOnlineMode());
        document.getElementById('playAgainBtn').addEventListener('click', () => {
            showScreen('mode');
            game = null;
            onlineGame = null;
        });

        // Start game
        async function startGame(mode) {
            gameMode = mode;
            gameStartTime = Date.now();

            // Create game instance
            game = new CincoGame(mode, {
                onStateChange: updateUI,
                requestColorSelection: requestColorSelection,
                playAnimation: playAnimation,
                showNotification: showNotification,
                gameOver: handleGameOver
            });

            game.startGame();
            showScreen('game');

            // Update opponent name
            if (mode === 'ai') {
                document.getElementById('opponentName').textContent = 'ğŸ¤– AI';
            } else if (mode === 'local') {
                document.getElementById('opponentName').textContent = 'Player 2';
            }
        }

        // Start online mode
        async function startOnlineMode() {
            showScreen('loading');

            try {
                // Create or join session
                const session = await multiplayer.createSession({
                    gameType: 'cinco',
                    playerName: currentUser?.displayName || 'Player'
                });

                const playerRole = session.isHost ? 'player1' : 'player2';

                // Create online game wrapper
                onlineGame = new CincoOnline(session, playerRole, {
                    onStateUpdate: handleOnlineStateUpdate,
                    onOpponentAction: handleOpponentAction,
                    onGameOver: handleGameOver,
                    onHandUpdate: handleHandUpdate
                });

                // Create game instance
                game = new CincoGame('online', {
                    onStateChange: handleOnlineStateChange,
                    requestColorSelection: requestColorSelection,
                    playAnimation: playAnimation,
                    showNotification: showNotification,
                    gameOver: handleGameOver
                });

                if (session.isHost) {
                    game.startGame();
                    await onlineGame.initializeGame(game.getState());
                }

                showScreen('game');
            } catch (error) {
                console.error('Online mode error:', error);
                showNotification('error', 'Failed to connect to online game');
                showScreen('mode');
            }
        }

        // Handle online state change (send to Firebase)
        async function handleOnlineStateChange(state) {
            updateUI(state);
            // State updates are handled by individual actions (playCard, drawCard, etc.)
        }

        // Handle online state update (from Firebase)
        function handleOnlineStateUpdate(state) {
            // Update UI with synced state
            updateUIFromOnlineState(state);
        }

        // Handle opponent action
        function handleOpponentAction(action) {
            if (action.type === 'play_card') {
                playAnimation(action.card.value, 'opponent');
            } else if (action.type === 'say_cinco') {
                showNotification('warning', 'ğŸŒ Opponent said CINCO!');
            }
        }

        // Handle hand update
        function handleHandUpdate(hand) {
            if (game) {
                game.playerHand = hand;
                updateUI(game.getState());
            }
        }

        // Update UI
        function updateUI(state) {
            // Update deck count
            document.getElementById('deckCount').textContent = state.deckCount || state.deck?.length || 0;

            // Update card counts
            document.getElementById('playerCardCount').textContent = state.playerCardCount || state.playerHand?.length || 0;
            document.getElementById('opponentCardCount').textContent = state.opponentCardCount || state.opponentHand?.length || 0;

            // Update turn indicator
            const turnIndicator = document.getElementById('turnIndicator');
            if (state.currentTurn === 'player') {
                turnIndicator.textContent = 'ğŸ¯ Your Turn';
                turnIndicator.classList.add('your-turn');
            } else {
                turnIndicator.textContent = state.aiThinking ? 'ğŸ¤– AI Thinking...' : 'â³ Opponent\'s Turn';
                turnIndicator.classList.remove('your-turn');
            }

            // Update color indicator
            if (state.currentColor) {
                const colorEmojis = { red: 'ğŸ”´', blue: 'ğŸ”µ', green: 'ğŸŸ¢', yellow: 'ğŸŸ¡' };
                document.getElementById('colorIndicator').textContent = `Current: ${colorEmojis[state.currentColor] || ''}`;
            }

            // Render player hand
            renderPlayerHand(state.playerHand || [], state.currentTurn === 'player', state.selectedCardIndex);

            // Render opponent hand
            renderOpponentHand(state.opponentCardCount || state.opponentHand?.length || 0);

            // Render discard pile
            if (state.discardPile && state.discardPile.length > 0) {
                const topCard = state.discardPile[state.discardPile.length - 1];
                renderDiscardPile(topCard);
            }

            // Update active effects
            renderActiveEffects(state.activeEffects);

            // Show/hide Cinco button
            const cincoBtn = document.getElementById('cincoBtn');
            if ((state.playerCardCount === 1 || state.playerHand?.length === 1) && !state.playerSaidCinco) {
                cincoBtn.classList.add('available');
            } else {
                cincoBtn.classList.remove('available');
            }
        }

        // Update UI from online state
        function updateUIFromOnlineState(state) {
            document.getElementById('deckCount').textContent = state.deckCount || 0;
            document.getElementById('playerCardCount').textContent = state.playerCardCount || 0;
            document.getElementById('opponentCardCount').textContent = state.opponentCardCount || 0;

            const turnIndicator = document.getElementById('turnIndicator');
            const myRole = onlineGame?.playerRole || 'player1';
            const isMyTurn = state.currentTurn === (myRole === 'player1' ? 'player' : 'opponent');

            if (isMyTurn) {
                turnIndicator.textContent = 'ğŸ¯ Your Turn';
                turnIndicator.classList.add('your-turn');
            } else {
                turnIndicator.textContent = 'â³ Opponent\'s Turn';
                turnIndicator.classList.remove('your-turn');
            }

            if (state.currentColor) {
                const colorEmojis = { red: 'ğŸ”´', blue: 'ğŸ”µ', green: 'ğŸŸ¢', yellow: 'ğŸŸ¡' };
                document.getElementById('colorIndicator').textContent = `Current: ${colorEmojis[state.currentColor] || ''}`;
            }

            renderOpponentHand(state.opponentCardCount);
            if (state.discardPile && state.discardPile.length > 0) {
                renderDiscardPile(state.discardPile[state.discardPile.length - 1]);
            }
            renderActiveEffects(state.activeEffects);

            const cincoBtn = document.getElementById('cincoBtn');
            if (state.playerCardCount === 1 && !state.playerSaidCinco) {
                cincoBtn.classList.add('available');
            } else {
                cincoBtn.classList.remove('available');
            }
        }

        // Render player hand
        function renderPlayerHand(hand, canPlay, selectedIndex) {
            const container = document.getElementById('playerHand');
            container.innerHTML = hand.map((card, index) => {
                const playable = canPlay && game?.isCardPlayable(card);
                const selected = index === selectedIndex;
                return `
                    <div class="cinco-card ${card.color} ${playable ? 'playable' : 'disabled'} ${selected ? 'selected' : ''}"
                         data-index="${index}"
                         data-value="${card.value}">
                        <div class="cinco-card-corner top-left">${CincoGame.getCardDisplay(card.value)}</div>
                        <div style="font-size: 1em;">${CincoGame.getCardDisplay(card.value)}</div>
                        <div class="cinco-card-corner bottom-right">${CincoGame.getCardDisplay(card.value)}</div>
                    </div>
                `;
            }).join('');

            // Add touch event listeners
            container.querySelectorAll('.cinco-card').forEach(card => {
                const index = parseInt(card.dataset.index);

                // Tap to select/play
                card.addEventListener('click', (e) => {
                    e.preventDefault();
                    handleCardTap(index);
                });

                // Long press for description
                card.addEventListener('touchstart', (e) => {
                    longPressTimer = setTimeout(() => {
                        showCardDescription(card.dataset.value, e.touches[0].clientX, e.touches[0].clientY);
                    }, 500);
                });

                card.addEventListener('touchend', () => {
                    if (longPressTimer) {
                        clearTimeout(longPressTimer);
                        longPressTimer = null;
                    }
                    hideCardDescription();
                });
            });
        }

        // Render opponent hand
        function renderOpponentHand(count) {
            const container = document.getElementById('opponentHand');
            container.innerHTML = Array(count).fill(0).map((_, i) => {
                const rotation = (i - count / 2) * 3;
                return `<div class="cinco-card-back" style="--rotation: ${rotation}deg;">ğŸ´</div>`;
            }).join('');
        }

        // Render discard pile
        function renderDiscardPile(card) {
            const container = document.getElementById('discardPile');
            container.innerHTML = `
                <div class="cinco-card ${card.color}" style="width: 80px; height: 112px;">
                    <div class="cinco-card-corner top-left">${CincoGame.getCardDisplay(card.value)}</div>
                    <div>${CincoGame.getCardDisplay(card.value)}</div>
                    <div class="cinco-card-corner bottom-right">${CincoGame.getCardDisplay(card.value)}</div>
                </div>
            `;
        }

        // Render active effects
        function renderActiveEffects(effects) {
            const container = document.getElementById('activeEffects');
            const badges = [];

            if (effects?.shield?.player) {
                badges.push('<div class="cinco-effect-badge shield">ğŸ›¡ï¸ Your Shield</div>');
            }
            if (effects?.shield?.opponent) {
                badges.push('<div class="cinco-effect-badge shield">ğŸ›¡ï¸ Opponent Shield</div>');
            }
            if (effects?.colorLock?.roundsLeft > 0) {
                const colorEmojis = { red: 'ğŸ”´', blue: 'ğŸ”µ', green: 'ğŸŸ¢', yellow: 'ğŸŸ¡' };
                badges.push(`<div class="cinco-effect-badge color-lock">ğŸ”’ ${colorEmojis[effects.colorLock.color]} (${effects.colorLock.roundsLeft})</div>`);
            }

            container.innerHTML = badges.join('');
        }

        // Handle card tap
        async function handleCardTap(index) {
            if (!game || gameMode === 'online') return;

            const success = game.selectCard(index);
            if (success && gameMode === 'online' && onlineGame) {
                await onlineGame.playCard(game.discardPile[game.discardPile.length - 1], game.getState());
            }
        }

        // Draw pile click
        document.getElementById('drawPile').addEventListener('click', async () => {
            if (!game) return;

            const success = game.drawCard();
            if (success && gameMode === 'online' && onlineGame) {
                await onlineGame.drawCard(game.getState());
            }
        });

        // Cinco button click
        document.getElementById('cincoBtn').addEventListener('click', async () => {
            if (!game) return;

            const success = game.sayCinco();
            if (success && gameMode === 'online' && onlineGame) {
                await onlineGame.sayCinco();
            }
        });

        // Request color selection
        function requestColorSelection(callback) {
            colorSelectionCallback = callback;
            document.getElementById('colorPicker').classList.add('active');
        }

        // Color picker
        document.querySelectorAll('.cinco-color-option').forEach(option => {
            option.addEventListener('click', () => {
                const color = option.dataset.color;
                document.getElementById('colorPicker').classList.remove('active');
                if (colorSelectionCallback) {
                    colorSelectionCallback(color);
                    colorSelectionCallback = null;
                }
            });
        });

        // Show card description
        function showCardDescription(value, x, y) {
            const desc = CincoGame.getCardDescription(value);
            if (!desc) return;

            const tooltip = document.createElement('div');
            tooltip.className = 'cinco-card-tooltip visible';
            tooltip.textContent = desc;
            tooltip.style.left = x + 'px';
            tooltip.style.top = (y - 50) + 'px';
            tooltip.id = 'cardTooltip';
            document.body.appendChild(tooltip);
        }

        function hideCardDescription() {
            const tooltip = document.getElementById('cardTooltip');
            if (tooltip) tooltip.remove();
        }

        // Play animation
        function playAnimation(type, playedBy = 'player') {
            createParticles(type);
            showActionBanner(type, playedBy);
        }

        // Show action banner
        function showActionBanner(cardType, playedBy) {
            const banner = document.getElementById('actionBanner');
            const icon = document.getElementById('bannerIcon');
            const title = document.getElementById('bannerTitle');
            const description = document.getElementById('bannerDescription');

            const playerName = playedBy === 'player' ? 'You' :
                              (gameMode === 'ai' ? 'AI' : 'Opponent');

            const announcements = {
                'skip': {
                    icon: 'ğŸš«',
                    title: `${playerName} played Skip`,
                    description: 'Next player loses their turn',
                    type: 'special'
                },
                'reverse': {
                    icon: 'ğŸ”„',
                    title: `${playerName} played Reverse`,
                    description: 'Direction of play reversed',
                    type: 'special'
                },
                'draw2': {
                    icon: 'â•2ï¸âƒ£',
                    title: `${playerName} played +2 Draw`,
                    description: 'Opponent draws 2 cards',
                    type: 'attack'
                },
                'cascade': {
                    icon: 'â•3ï¸âƒ£',
                    title: `${playerName} played +3 Cascade`,
                    description: 'Opponent draws 3 cards!',
                    type: 'attack'
                },
                'wilddraw4': {
                    icon: 'ğŸŒˆ+4',
                    title: `${playerName} played Wild +4`,
                    description: 'Opponent draws 4 cards + color changed',
                    type: 'attack'
                },
                'handbomb': {
                    icon: 'ğŸ’£',
                    title: `${playerName} played Hand Bomb`,
                    description: 'Opponent discards hand & draws 5 new cards',
                    type: 'attack'
                },
                'shield': {
                    icon: 'ğŸ›¡ï¸',
                    title: `${playerName} activated Shield`,
                    description: 'Protected from next attack card',
                    type: 'defense'
                },
                'wild': {
                    icon: 'ğŸŒˆ',
                    title: `${playerName} played Wild`,
                    description: 'Color changed',
                    type: 'wild'
                },
                'wildchaos': {
                    icon: 'ğŸŒ€',
                    title: `${playerName} played Wild Chaos`,
                    description: 'Color changed + 2 cards swapped between players',
                    type: 'wild'
                },
                'timewarp': {
                    icon: 'â°',
                    title: `${playerName} played Time Warp`,
                    description: 'Takes another turn immediately',
                    type: 'special'
                },
                'colorlock': {
                    icon: 'ğŸ”’',
                    title: `${playerName} played Color Lock`,
                    description: 'Current color locked for next 2 rounds',
                    type: 'special'
                },
                'doppelganger': {
                    icon: 'ğŸ‘¥',
                    title: `${playerName} played Doppelganger`,
                    description: 'Copies the effect of last power-up played',
                    type: 'wild'
                },
                'shield_block': {
                    icon: 'ğŸ›¡ï¸ğŸ’¥',
                    title: 'Shield Blocked Attack!',
                    description: 'Shield absorbed the attack',
                    type: 'defense'
                }
            };

            const announcement = announcements[cardType];
            if (!announcement) return;

            // Update banner content
            icon.textContent = announcement.icon;
            title.textContent = announcement.title;
            description.textContent = announcement.description;

            // Remove old type classes
            banner.classList.remove('attack', 'defense', 'wild', 'special');
            // Add new type class
            banner.classList.add(announcement.type);

            // Show banner
            banner.classList.add('show');

            // Hide after 3 seconds
            setTimeout(() => {
                banner.classList.remove('show');
            }, 3000);
        }

        // Create particles
        function createParticles(type) {
            const container = document.getElementById('particles');
            const emojis = {
                'skip': ['ğŸš«', 'â›”', 'ğŸ›‘'],
                'reverse': ['ğŸ”„', 'â†©ï¸', 'â¤´ï¸'],
                'draw2': ['â•2ï¸âƒ£', 'ğŸ“¤', 'ğŸ´'],
                'cascade': ['â•3ï¸âƒ£', 'ğŸŒŠ', 'ğŸ´'],
                'wilddraw4': ['ğŸŒˆ', 'âœ¨', 'â­', 'ğŸ’«', '+4'],
                'handbomb': ['ğŸ’£', 'ğŸ’¥', 'ğŸ”¥'],
                'shield': ['ğŸ›¡ï¸', 'âœ¨', 'ğŸ’™'],
                'wild': ['ğŸŒˆ', 'ğŸ¨', 'âœ¨'],
                'wildchaos': ['ğŸŒ€', 'ğŸ”€', 'ğŸ’«', 'ğŸ­'],
                'timewarp': ['â°', 'â³', 'ğŸ•', 'ğŸ’«'],
                'colorlock': ['ğŸ”’', 'ğŸ”', 'ğŸ—ï¸'],
                'doppelganger': ['ğŸ‘¥', 'ğŸª', 'âœ¨'],
                'cinco': ['ğŸ‰', 'ğŸŠ', 'ğŸ¥³', 'ğŸˆ', 'âœ¨', 'â­'],
                'shield_block': ['ğŸ›¡ï¸', 'ğŸ’¥', 'âš¡']
            };

            const particleEmojis = emojis[type] || ['âœ¨'];

            for (let i = 0; i < 15; i++) {
                const particle = document.createElement('div');
                particle.className = 'cinco-particle';
                particle.textContent = particleEmojis[Math.floor(Math.random() * particleEmojis.length)];
                particle.style.left = Math.random() * window.innerWidth + 'px';
                particle.style.top = '0px';
                container.appendChild(particle);

                setTimeout(() => particle.remove(), 2000);
            }
        }

        // Handle game over
        async function handleGameOver(winner, result) {
            const isWin = (winner === 'player' && gameMode !== 'online') ||
                          (winner === onlineGame?.playerRole);

            document.getElementById('resultEmoji').textContent = isWin ? 'ğŸ†' : 'ğŸ˜”';
            document.getElementById('resultMessage').textContent = isWin ? 'You Win!' : 'You Lose!';
            document.getElementById('resultDetails').textContent = isWin ?
                'Congratulations! You played all your cards!' :
                'Better luck next time!';

            showScreen('gameOver');
            createParticles(isWin ? 'cinco' : 'shield');

            // Save game results
            await saveGameResults(result);
        }

        // Save game results
        async function saveGameResults(result) {
            if (!currentUser) return;

            try {
                const gameDuration = Math.floor((Date.now() - gameStartTime) / 1000);

                if (!currentUser.isAnonymous) {
                    await profileManager.addGameToHistory(currentUser.uid, {
                        gameName: 'cinco',
                        score: 0,
                        result: result,
                        opponentId: null,
                        playedAt: Date.now(),
                        duration: gameDuration,
                        details: { mode: gameMode }
                    });

                    await profileManager.updateGameStats(currentUser.uid, 'cinco', { result });
                    await profileManager.incrementStreak(currentUser.uid);

                    showNotification('success', 'Game saved to your profile!');
                }

                if (currentUser.isAnonymous) {
                    setTimeout(() => {
                        if (confirm('ğŸ¯ Create a free account to save your progress!\n\nWould you like to create an account now?')) {
                            window.location.href = '../index.html#upgrade';
                        }
                    }, 1500);
                }
            } catch (error) {
                console.error('Failed to save game:', error);
            }
        }

        // Lock orientation to portrait
        if (screen.orientation && screen.orientation.lock) {
            screen.orientation.lock('portrait').catch(() => {
                // Orientation lock not supported
            });
        }
    </script>
</body>
</html>
