<style>
        /* 1. Global Reset to prevent spacing errors */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            overflow-x: hidden;
            width: 100%;
            font-family: sans-serif; /* Added generic font safety */
        }

        /* 2. Container handles the safe area, Grid fills the container */
        .game-container {
            width: 100%;
            max-width: 800px; /* Prevent it from getting too wide on desktop */
            margin: 0 auto;
            padding: 15px; /* Safe spacing from edges */
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .back-link {
            align-self: flex-start;
            margin-bottom: 10px;
            text-decoration: none;
            color: #667eea;
            font-weight: bold;
        }

        .game-title {
            text-align: center;
            font-size: 2em;
            margin: 10px 0;
        }

        .game-subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 20px;
        }

        .player-indicator {
            text-align: center;
            font-size: 1.5em;
            font-weight: bold;
            color: #764ba2;
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9ff;
            border-radius: 10px;
            width: 100%;
        }

        .stats {
            display: flex;
            justify-content: space-around;
            margin-bottom: 20px;
            gap: 10px;
            width: 100%;
        }

        .stat-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 10px;
            border-radius: 10px;
            text-align: center;
            flex: 1;
        }

        .stat-label {
            font-size: 0.8em;
            opacity: 0.9;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 1.5em;
            font-weight: bold;
        }

        /* Head to Head Stats */
        .stats-h2h {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 10px;
            margin-bottom: 20px;
            align-items: center;
            width: 100%;
        }

        .player-stats-box {
            background: #f8f9ff;
            padding: 10px;
            border-radius: 10px;
            border: 2px solid transparent;
            transition: all 0.3s;
        }

        .player-stats-box.active-turn {
            border-color: #667eea;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
        }

        .player-stats-box h4 {
            color: #667eea;
            margin-bottom: 5px;
            font-size: 1em;
            text-align: center;
        }

        .h2h-stat-row {
            display: flex;
            justify-content: space-between;
            margin: 4px 0;
            font-size: 0.9em;
        }

        .vs-separator {
            font-weight: bold;
            color: #764ba2;
        }

        /* 3. The Grid Fix: Use 100% width and gap logic */
        .memory-grid {
            display: grid;
            gap: 8px;
            width: 100%; /* Fill the container, don't overflow viewport */
            margin: 0 auto 30px auto;
        }

        /* Grid Layouts */
        .memory-grid.grid-2x4 { grid-template-columns: repeat(4, 1fr); }
        .memory-grid.grid-3x4 { grid-template-columns: repeat(4, 1fr); }
        .memory-grid.grid-4x4 { grid-template-columns: repeat(4, 1fr); }
        .memory-grid.grid-4x5 { grid-template-columns: repeat(4, 1fr); }
        .memory-grid.grid-5x6 { grid-template-columns: repeat(4, 1fr); }
        .memory-grid.grid-6x6 { grid-template-columns: repeat(4, 1fr); }

        /* Tablet/Desktop overrides for larger grids */
        @media (min-width: 600px) {
            .memory-grid.grid-4x5 { grid-template-columns: repeat(5, 1fr); }
            .memory-grid.grid-5x6 { grid-template-columns: repeat(6, 1fr); }
            .memory-grid.grid-6x6 { grid-template-columns: repeat(6, 1fr); }
        }

        /* 4. Card Aspect Ratio */
        .memory-card {
            aspect-ratio: 1 / 1; /* Keeps it perfectly square */
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: clamp(1.2em, 4vw, 2.5em); /* Responsive font size */
            position: relative;
            width: 100%;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        .memory-card.flipped,
        .memory-card.matched {
            background: white;
            border: 2px solid #667eea;
            transform: scale(1);
        }

        .memory-card .card-front { display: none; width: 100%; height: 100%; }
        .memory-card.flipped .card-front,
        .memory-card.matched .card-front { 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            padding: 4px;
        }

        .memory-card .card-front img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 4px;
            display: block;
        }

        /* Screens */
        .start-screen, .game-screen, .end-screen, .settings-screen,
        .online-lobby-screen, .create-game-screen, .join-game-screen,
        .waiting-room-screen, .connecting-screen, .opponent-playing-screen {
            display: none;
            width: 100%;
        }

        .active { display: block; }

        /* UI Elements */
        .difficulty-buttons, .theme-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 20px;
        }

        button {
            width: 100%;
            padding: 12px;
            font-size: 1.1em;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 10px;
        }

        button.selected {
            background: white;
            color: #764ba2;
            border: 2px solid #764ba2;
        }

        /* Online Lobby Specifics */
        .lobby-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        .lobby-card {
            background: #f8f9ff;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
        }
        .lobby-icon { font-size: 2.5em; margin-bottom: 10px; }
        .name-input-container input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px; /* Prevents iOS zoom */
        }

        /* 5. Mobile Specific Fixes */
        @media (max-width: 480px) {
            .game-container {
                padding: 10px; /* Reduce container padding on small screens */
            }

            .memory-grid {
                gap: 5px; /* Tighter gap for mobile */
            }

            .stat-value { font-size: 1.2em; }
            .player-indicator { padding: 10px; font-size: 1.2em; }
            
            /* Stack lobby options on mobile */
            .lobby-options { grid-template-columns: 1fr; }
            
            /* Make inputs tap-friendly */
            input, button { min-height: 48px; }
        }

        /* Extra small screens (like Galaxy Fold or small iPhones) */
        @media (max-width: 350px) {
            .memory-grid { gap: 3px; }
            .game-title { font-size: 1.5em; }
        }
    </style>
